var V=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var a in t)V(e,a,{get:t[a],enumerable:!0})},Y=(e,t,a,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of N(t))!Q.call(e,n)&&n!==a&&V(e,n,{get:()=>t[n],enumerable:!(l=K(t,n))||l.enumerable});return e};var Z=e=>Y(V({},"__esModule",{value:!0}),e);var ee={};X(ee,{createObserverDeserializer:()=>H,createObserverSerializer:()=>q,createSnapshotDeserializer:()=>G,createSnapshotSerializer:()=>L,createSoADeserializer:()=>I,createSoASerializer:()=>U,f32:()=>M,f64:()=>j,i16:()=>W,i32:()=>F,i8:()=>$,u16:()=>B,u32:()=>P,u8:()=>T});module.exports=Z(ee);var D=Symbol("u8"),w=Symbol("i8"),z=Symbol("u16"),C=Symbol("i16"),R=Symbol("u32"),S=Symbol("i32"),h=Symbol("f32"),A=Symbol("f64"),b=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),T=b(D),$=b(w),B=b(z),W=b(C),P=b(R),F=b(S),M=b(h),j=b(A),x={[D]:(e,t,a)=>(e.setUint8(t,a),1),[w]:(e,t,a)=>(e.setInt8(t,a),1),[z]:(e,t,a)=>(e.setUint16(t,a),2),[C]:(e,t,a)=>(e.setInt16(t,a),2),[R]:(e,t,a)=>(e.setUint32(t,a),4),[S]:(e,t,a)=>(e.setInt32(t,a),4),[h]:(e,t,a)=>(e.setFloat32(t,a),4),[A]:(e,t,a)=>(e.setFloat64(t,a),8)},O={[D]:(e,t)=>({value:e.getUint8(t),size:1}),[w]:(e,t)=>({value:e.getInt8(t),size:1}),[z]:(e,t)=>({value:e.getUint16(t),size:2}),[C]:(e,t)=>({value:e.getInt16(t),size:2}),[R]:(e,t)=>({value:e.getUint32(t),size:4}),[S]:(e,t)=>({value:e.getInt32(t),size:4}),[h]:(e,t)=>({value:e.getFloat32(t),size:4}),[A]:(e,t)=>({value:e.getFloat64(t),size:8})},_=e=>{let t=Object.keys(e),l=t.map(n=>{let i=e[n];for(let r of[D,w,z,C,R,S,h,A])if(r in i)return r;return A}).map(n=>x[n]||(()=>{throw new Error("Unsupported or unannotated type")}));return(n,i,r)=>{let p=0;p+=x[R](n,i+p,r);for(let o=0;o<t.length;o++)p+=l[o](n,i+p,e[t[o]][r]);return p}},k=e=>{let t=Object.keys(e),l=t.map(n=>{let i=e[n];for(let r of[D,w,z,C,R,S,h,A])if(r in i)return r;return A}).map(n=>O[n]||(()=>{throw new Error("Unsupported or unannotated type")}));return(n,i,r)=>{let p=0,{value:o,size:f}=O[R](n,i+p);p+=f;let s=r?r.get(o)??o:o;for(let y=0;y<t.length;y++){let{value:u,size:c}=l[y](n,i+p);e[t[y]][s]=u,p+=c}return p}},U=(e,t=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(t),l=e.map(_);return n=>{let i=0;for(let r=0;r<n.length;r++){let p=n[r];for(let o=0;o<l.length;o++)i+=l[o](a,i,p)}return t.slice(0,i)}},I=e=>{let t=e.map(k);return(a,l)=>{let n=new DataView(a),i=0;for(;i<a.byteLength;)for(let r=0;r<t.length;r++)i+=t[r](n,i,l)}};var d=require("bitecs"),L=(e,t,a=new ArrayBuffer(1024*1024*100))=>{let l=new DataView(a),n=0,i=p=>{let o=p.length;l.setUint32(n,o),n+=4;for(let f=0;f<o;f++){let s=p[f],y=0;l.setUint32(n,s),n+=4;let u=n;n+=1;for(let c=0;c<t.length;c++){let g=t[c];if((0,d.isRelation)(g)){let v=(0,d.getRelationTargets)(e,s,g);for(let E of v)l.setUint8(n,c),n+=1,l.setUint32(n,E),n+=4,y++}else(0,d.hasComponent)(e,s,g)&&(l.setUint8(n,c),n+=1,y++)}l.setUint8(u,y)}},r=p=>{let f=U(t,a.slice(n))(p);new Uint8Array(a).set(new Uint8Array(f),n),n+=f.byteLength};return()=>{n=0;let p=(0,d.getAllEntities)(e);return i(p),r(p),a.slice(0,n)}},G=(e,t)=>{let a=I(t);return l=>{let n=new DataView(l),i=0,r=new Map,p=n.getUint32(i);i+=4;for(let o=0;o<p;o++){let f=n.getUint32(i);i+=4;let s=(0,d.addEntity)(e);r.set(f,s);let y=n.getUint8(i);i+=1;for(let u=0;u<y;u++){let c=n.getUint8(i);i+=1;let g=t[c];if((0,d.isRelation)(g)){let v=n.getUint32(i);if(i+=4,!r.has(v)){let J=(0,d.addEntity)(e);r.set(v,J)}let E=r.get(v);(0,d.addComponent)(e,s,g(E))}else(0,d.addComponent)(e,s,g)}}return a(l.slice(i),r),r}};var m=require("bitecs");var q=(e,t,a,l=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(l),i=0,r=[],p=new Map;return(0,m.observe)(e,(0,m.onAdd)(t),o=>{r.push([o,0,-1])}),(0,m.observe)(e,(0,m.onRemove)(t),o=>{r.push([o,1,-1]),p.delete(o)}),a.forEach((o,f)=>{(0,m.isRelation)(o)?((0,m.observe)(e,(0,m.onAdd)(t,o(m.Wildcard)),s=>{let y=(0,m.getRelationTargets)(e,s,o);for(let u of y)p.has(s)||p.set(s,new Map),p.get(s).set(f,u),r.push([s,4,f,u])}),(0,m.observe)(e,(0,m.onRemove)(t,o(m.Wildcard)),s=>{let y=p.get(s);if(y){let u=y.get(f);u!==void 0&&(r.push([s,5,f,u]),y.delete(f),y.size===0&&p.delete(s))}})):((0,m.observe)(e,(0,m.onAdd)(t,o),s=>{r.push([s,2,f])}),(0,m.observe)(e,(0,m.onRemove)(t,o),s=>{r.push([s,3,f])}))}),()=>{i=0;for(let o=0;o<r.length;o++){let[f,s,y,u]=r[o];n.setUint32(i,f),i+=4,n.setUint8(i,s),i+=1,(s===2||s===3||s===4||s===5)&&(n.setUint8(i,y),i+=1,(s===4||s===5)&&(n.setUint32(i,u),i+=4))}return r.length=0,l.slice(0,i)}},H=(e,t,a,l=new Map)=>n=>{let i=new DataView(n),r=0;for(;r<n.byteLength;){let p=i.getUint32(r);r+=4;let o=i.getUint8(r);r+=1;let f=-1,s=-1;(o===2||o===3||o===4||o===5)&&(f=i.getUint8(r),r+=1,(o===4||o===5)&&(s=i.getUint32(r),r+=4));let y=a[f],u=l.get(p);if(o===0)if(u===void 0)u=(0,m.addEntity)(e),l.set(p,u),(0,m.addComponent)(e,u,t);else throw new Error(`Entity with ID ${p} already exists in the mapping.`);else if(u!==void 0&&(0,m.entityExists)(e,u)){if(o===1)(0,m.removeEntity)(e,u);else if(o===2)(0,m.addComponent)(e,u,y);else if(o===3)(0,m.removeComponent)(e,u,y);else if(o===4){let c=l.get(s);c!==void 0&&(0,m.addComponent)(e,u,y(c))}else if(o===5){let c=l.get(s);c!==void 0&&(0,m.removeComponent)(e,u,y(c))}}}return l};
//# sourceMappingURL=index.min.cjs.map
