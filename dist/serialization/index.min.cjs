var P=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var ee=(e,r)=>{for(var i in r)P(e,i,{get:r[i],enumerable:!0})},te=(e,r,i,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Z(r))!_.call(e,o)&&o!==i&&P(e,o,{get:()=>r[o],enumerable:!(n=Y(r,o))||n.enumerable});return e};var ne=e=>te(P({},"__esModule",{value:!0}),e);var ue={};ee(ue,{createObserverDeserializer:()=>X,createObserverSerializer:()=>Q,createSnapshotDeserializer:()=>N,createSnapshotSerializer:()=>K,createSoADeserializer:()=>M,createSoASerializer:()=>F,f32:()=>H,f64:()=>J,i16:()=>V,i32:()=>G,i8:()=>w,u16:()=>L,u32:()=>q,u8:()=>W});module.exports=ne(ue);var R=Symbol.for("bitecs-u8"),U=Symbol.for("bitecs-i8"),d=Symbol.for("bitecs-u16"),v=Symbol.for("bitecs-i16"),g=Symbol.for("bitecs-u32"),D=Symbol.for("bitecs-i32"),z=Symbol.for("bitecs-f32"),T=Symbol.for("bitecs-f64"),h=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),W=h(R),w=h(U),L=h(d),V=h(v),q=h(g),G=h(D),H=h(z),J=h(T),E={[R]:(e,r,i)=>(e.setUint8(r,i),1),[U]:(e,r,i)=>(e.setInt8(r,i),1),[d]:(e,r,i)=>(e.setUint16(r,i),2),[v]:(e,r,i)=>(e.setInt16(r,i),2),[g]:(e,r,i)=>(e.setUint32(r,i),4),[D]:(e,r,i)=>(e.setInt32(r,i),4),[z]:(e,r,i)=>(e.setFloat32(r,i),4),[T]:(e,r,i)=>(e.setFloat64(r,i),8)},O={[R]:(e,r)=>({value:e.getUint8(r),size:1}),[U]:(e,r)=>({value:e.getInt8(r),size:1}),[d]:(e,r)=>({value:e.getUint16(r),size:2}),[v]:(e,r)=>({value:e.getInt16(r),size:2}),[g]:(e,r)=>({value:e.getUint32(r),size:4}),[D]:(e,r)=>({value:e.getInt32(r),size:4}),[z]:(e,r)=>({value:e.getFloat32(r),size:4}),[T]:(e,r)=>({value:e.getFloat64(r),size:8})};function x(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function B(e){for(let r of[R,U,d,v,g,D,z,T])if(r in e)return r;return e instanceof Int8Array?U:e instanceof Uint8Array?R:e instanceof Int16Array?v:e instanceof Uint16Array?d:e instanceof Int32Array?D:e instanceof Uint32Array?g:e instanceof Float32Array?z:T}var re=e=>{if(x(e)){let o=B(e),y=E[o];return(t,a,u)=>{let s=0;return s+=E[g](t,a,u),s+=y(t,a+s,e[u]),s}}let r=Object.keys(e),n=r.map(o=>{let y=e[o];if(!x(y))throw new Error(`Invalid array type for property ${o}`);return B(y)}).map(o=>E[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,y,t)=>{let a=0;a+=E[g](o,y+a,t);for(let u=0;u<r.length;u++)a+=n[u](o,y+a,e[r[u]][t]);return a}},ie=e=>{if(x(e)){let o=B(e),y=O[o];return(t,a,u)=>{let s=0,{value:l,size:c}=O[g](t,a);s+=c;let b=u?u.get(l)??l:l,{value:m,size:I}=y(t,a+s);return e[b]=m,s+I}}let r=Object.keys(e),n=r.map(o=>{let y=e[o];if(!x(y))throw new Error(`Invalid array type for property ${o}`);return B(y)}).map(o=>O[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,y,t)=>{let a=0,{value:u,size:s}=O[g](o,y+a);a+=s;let l=t?t.get(u)??u:u;for(let c=0;c<r.length;c++){let{value:b,size:m}=n[c](o,y+a);e[r[c]][l]=b,a+=m}return a}},F=(e,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),n=e.map(re);return o=>{let y=0;for(let t=0;t<o.length;t++){let a=o[t];for(let u=0;u<n.length;u++)y+=n[u](i,y,a)}return r.slice(0,y)}},M=e=>{let r=e.map(ie);return(i,n)=>{let o=new DataView(i),y=0;for(;y<i.byteLength;)for(let t=0;t<r.length;t++)y+=r[t](o,y,n)}};var f=require("bitecs");function oe(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let o=e[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y],a=t[r];a!==void 0&&(t instanceof Int8Array||U in t?(i.setInt8(n,a),n+=1):t instanceof Uint8Array||R in t?(i.setUint8(n,a),n+=1):t instanceof Int16Array||v in t?(i.setInt16(n,a),n+=2):t instanceof Uint16Array||d in t?(i.setUint16(n,a),n+=2):t instanceof Int32Array||D in t?(i.setInt32(n,a),n+=4):t instanceof Uint32Array||g in t?(i.setUint32(n,a),n+=4):t instanceof Float32Array||z in t?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function ae(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y];t instanceof Int8Array||U in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||R in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||v in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||d in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||D in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||g in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||z in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var K=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),o=0,y=a=>{let u=a.length;n.setUint32(o,u),o+=4;for(let s=0;s<u;s++){let l=a[s],c=0;n.setUint32(o,l),o+=4;let b=o;o+=1;for(let m=0;m<r.length;m++){let I=r[m];if((0,f.isRelation)(I)){let A=(0,f.getRelationTargets)(e,l,I);for(let C of A){n.setUint8(o,m),o+=1,n.setUint32(o,C),o+=4;let S=I(C);o=oe(S,l,n,o),c++}}else(0,f.hasComponent)(e,l,I)&&(n.setUint8(o,m),o+=1,c++)}n.setUint8(b,c)}},t=a=>{let s=F(r,i.slice(o))(a);new Uint8Array(i).set(new Uint8Array(s),o),o+=s.byteLength};return()=>{o=0;let a=(0,f.getAllEntities)(e);return y(a),t(a),i.slice(0,o)}},N=(e,r,i)=>{let n=i||new Map,o=M(r);return(y,t)=>{let a=t||n,u=new DataView(y),s=0,l=u.getUint32(s);s+=4;for(let c=0;c<l;c++){let b=u.getUint32(s);s+=4;let m=a.get(b);m===void 0&&(m=(0,f.addEntity)(e),a.set(b,m));let I=u.getUint8(s);s+=1;for(let A=0;A<I;A++){let C=u.getUint8(s);s+=1;let S=r[C];if((0,f.isRelation)(S)){let j=u.getUint32(s);s+=4;let $=a.get(j);$===void 0&&($=(0,f.addEntity)(e),a.set(j,$));let k=S($);(0,f.addComponent)(e,m,k),s=ae(k,m,u,s)}else(0,f.addComponent)(e,m,S)}}return o(y.slice(s),a),a}};var p=require("bitecs");function se(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let o=e[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y],a=t[r];a!==void 0&&(t instanceof Int8Array||U in t?(i.setInt8(n,a),n+=1):t instanceof Uint8Array||R in t?(i.setUint8(n,a),n+=1):t instanceof Int16Array||v in t?(i.setInt16(n,a),n+=2):t instanceof Uint16Array||d in t?(i.setUint16(n,a),n+=2):t instanceof Int32Array||D in t?(i.setInt32(n,a),n+=4):t instanceof Uint32Array||g in t?(i.setUint32(n,a),n+=4):t instanceof Float32Array||z in t?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function ye(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y];t instanceof Int8Array||U in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||R in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||v in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||d in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||D in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||g in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||z in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var Q=(e,r,i,n=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(n),y=0,t=[],a=new Map;return(0,p.observe)(e,(0,p.onAdd)(r),u=>{t.push([u,0,-1])}),(0,p.observe)(e,(0,p.onRemove)(r),u=>{t.push([u,1,-1]),a.delete(u)}),i.forEach((u,s)=>{(0,p.isRelation)(u)?((0,p.observe)(e,(0,p.onAdd)(r,u(p.Wildcard)),l=>{let c=(0,p.getRelationTargets)(e,l,u);for(let b of c){a.has(l)||a.set(l,new Map),a.get(l).set(s,b);let m=u(b);t.push([l,4,s,b,m])}}),(0,p.observe)(e,(0,p.onRemove)(r,u(p.Wildcard)),l=>{let c=a.get(l);if(c){let b=c.get(s);b!==void 0&&(t.push([l,5,s,b]),c.delete(s),c.size===0&&a.delete(l))}})):((0,p.observe)(e,(0,p.onAdd)(r,u),l=>{t.push([l,2,s])}),(0,p.observe)(e,(0,p.onRemove)(r,u),l=>{t.push([l,3,s])}))}),()=>{y=0;for(let u=0;u<t.length;u++){let[s,l,c,b,m]=t[u];o.setUint32(y,s),y+=4,o.setUint8(y,l),y+=1,(l===2||l===3||l===4||l===5)&&(o.setUint8(y,c),y+=1,(l===4||l===5)&&(o.setUint32(y,b),y+=4,l===4&&m&&(y=se(m,s,o,y))))}return t.length=0,n.slice(0,y)}},X=(e,r,i,n)=>{let o=n||new Map;return(y,t)=>{let a=t||o,u=new DataView(y),s=0;for(;s<y.byteLength;){let l=u.getUint32(s);s+=4;let c=u.getUint8(s);s+=1;let b=-1,m=-1;(c===2||c===3||c===4||c===5)&&(b=u.getUint8(s),s+=1,(c===4||c===5)&&(m=u.getUint32(s),s+=4));let I=i[b],A=a.get(l);if(c===0)A===void 0&&(A=(0,p.addEntity)(e),a.set(l,A),(0,p.addComponent)(e,A,r));else if(A!==void 0&&(0,p.entityExists)(e,A)){if(c===1)(0,p.removeEntity)(e,A);else if(c===2)(0,p.addComponent)(e,A,I);else if(c===3)(0,p.removeComponent)(e,A,I);else if(c===4){let C=a.get(m);if(C!==void 0){let S=I(C);(0,p.addComponent)(e,A,S),s=ye(S,A,u,s)}}else if(c===5){let C=a.get(m);C!==void 0&&(0,p.removeComponent)(e,A,I(C))}}}return a}};
//# sourceMappingURL=index.min.cjs.map
