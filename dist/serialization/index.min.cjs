var U=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var H=(t,e)=>{for(var i in e)U(t,i,{get:e[i],enumerable:!0})},J=(t,e,i,u)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of k(e))!q.call(t,r)&&r!==i&&U(t,r,{get:()=>e[r],enumerable:!(u=G(e,r))||u.enumerable});return t};var K=t=>J(U({},"__esModule",{value:!0}),t);var X={};H(X,{createObserverDeserializer:()=>L,createObserverSerializer:()=>T,createSnapshotDeserializer:()=>M,createSnapshotSerializer:()=>j,createSoADeserializer:()=>h,createSoASerializer:()=>V,f32:()=>F,f64:()=>W,i16:()=>$,i32:()=>P,i8:()=>x,u16:()=>B,u32:()=>O,u8:()=>R});module.exports=K(X);var z=Symbol("u8"),A=Symbol("i8"),S=Symbol("u16"),v=Symbol("i16"),d=Symbol("u32"),g=Symbol("i32"),C=Symbol("f32"),w=Symbol("f64"),c=t=>(e=[])=>Object.defineProperty(e,t,{value:!0,enumerable:!1,writable:!1,configurable:!1}),R=c(z),x=c(A),B=c(S),$=c(v),O=c(d),P=c(g),F=c(C),W=c(w),E={[z]:(t,e,i)=>(t.setUint8(e,i),1),[A]:(t,e,i)=>(t.setInt8(e,i),1),[S]:(t,e,i)=>(t.setUint16(e,i),2),[v]:(t,e,i)=>(t.setInt16(e,i),2),[d]:(t,e,i)=>(t.setUint32(e,i),4),[g]:(t,e,i)=>(t.setInt32(e,i),4),[C]:(t,e,i)=>(t.setFloat32(e,i),4),[w]:(t,e,i)=>(t.setFloat64(e,i),8)},I={[z]:(t,e)=>({value:t.getUint8(e),size:1}),[A]:(t,e)=>({value:t.getInt8(e),size:1}),[S]:(t,e)=>({value:t.getUint16(e),size:2}),[v]:(t,e)=>({value:t.getInt16(e),size:2}),[d]:(t,e)=>({value:t.getUint32(e),size:4}),[g]:(t,e)=>({value:t.getInt32(e),size:4}),[C]:(t,e)=>({value:t.getFloat32(e),size:4}),[w]:(t,e)=>({value:t.getFloat64(e),size:8})},N=t=>{let e=Object.keys(t),u=e.map(r=>{let n=t[r];for(let o of[z,A,S,v,d,g,C,w])if(o in n)return o;return w}).map(r=>E[r]||(()=>{throw new Error("Unsupported or unannotated type")}));return(r,n,o)=>{let a=0;a+=E[d](r,n+a,o);for(let s=0;s<e.length;s++)a+=u[s](r,n+a,t[e[s]][o]);return a}},Q=t=>{let e=Object.keys(t),u=e.map(r=>{let n=t[r];for(let o of[z,A,S,v,d,g,C,w])if(o in n)return o;return w}).map(r=>I[r]||(()=>{throw new Error("Unsupported or unannotated type")}));return(r,n,o)=>{let a=0,{value:s,size:p}=I[d](r,n+a);a+=p;let y=o?o.get(s)??s:s;for(let l=0;l<e.length;l++){let{value:D,size:f}=u[l](r,n+a);t[e[l]][y]=D,a+=f}return a}},V=(t,e=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(e),u=t.map(N);return r=>{let n=0;for(let o=0;o<r.length;o++){let a=r[o];for(let s=0;s<u.length;s++)n+=u[s](i,n,a)}return e.slice(0,n)}},h=t=>{let e=t.map(Q);return(i,u)=>{let r=new DataView(i),n=0;for(;n<i.byteLength;)for(let o=0;o<e.length;o++)n+=e[o](r,n,u)}};var b=require("../core"),j=(t,e,i=new ArrayBuffer(1024*1024*100))=>{let u=new DataView(i),r=0,n=a=>{let s=a.length;u.setUint32(r,s),r+=4;for(let p=0;p<s;p++){let y=a[p],l=0;u.setUint32(r,y),r+=4;let D=r;r+=1;for(let f=0;f<e.length;f++)(0,b.hasComponent)(t,y,e[f])&&(u.setUint8(r,f),r+=1,l++);u.setUint8(D,l)}},o=a=>{let p=V(e,i.slice(r))(a);new Uint8Array(i).set(new Uint8Array(p),r),r+=p.byteLength};return()=>{r=0;let a=(0,b.getAllEntities)(t);return n(a),o(a),i.slice(0,r)}},M=(t,e)=>{let i=h(e);return u=>{let r=new DataView(u),n=0,o=new Map,a=r.getUint32(n);n+=4;for(let s=0;s<a;s++){let p=r.getUint32(n);n+=4;let y=(0,b.addEntity)(t);o.set(p,y);let l=r.getUint8(n);n+=1;for(let D=0;D<l;D++){let f=r.getUint8(n);n+=1,(0,b.addComponent)(t,y,e[f])}}return i(u.slice(n),o),o}};var m=require("../core");var T=(t,e,i,u=new ArrayBuffer(1024*1024*100))=>{let r=new DataView(u),n=0,o=[];return(0,m.observe)(t,(0,m.onAdd)(e),a=>{o.push([a,0,-1])}),(0,m.observe)(t,(0,m.onRemove)(e),a=>{o.push([a,1,-1])}),i.forEach((a,s)=>{(0,m.observe)(t,(0,m.onAdd)(e,a),p=>{o.push([p,2,s])}),(0,m.observe)(t,(0,m.onRemove)(e,a),p=>{o.push([p,3,s])})}),()=>{n=0;for(let a=0;a<o.length;a++){let[s,p,y]=o[a];r.setUint32(n,s),n+=4,r.setUint8(n,p),n+=1,r.setUint8(n,y),n+=1}return o.length=0,u.slice(0,n)}},L=(t,e,i)=>(u,r=new Map)=>{let n=new DataView(u),o=0;for(;o<u.byteLength;){let a=n.getUint32(o);o+=4;let s=n.getUint8(o);o+=1;let p=n.getUint8(o);o+=1;let y=i[p],l=r.get(a);l===void 0&&(l=(0,m.addEntity)(t),r.set(a,l)),s===0?(0,m.addComponent)(t,l,e):s===1?(0,m.removeEntity)(t,l):s===2?(0,m.addComponent)(t,l,y):s===3&&(0,m.removeComponent)(t,l,y)}return r};
//# sourceMappingURL=index.min.cjs.map
