var F=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(t,r)=>{for(var i in r)F(t,i,{get:r[i],enumerable:!0})},_=(t,r,i,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of X(r))!Y.call(t,o)&&o!==i&&F(t,o,{get:()=>r[o],enumerable:!(n=V(r,o))||n.enumerable});return t};var ee=t=>_(F({},"__esModule",{value:!0}),t);var se={};Z(se,{createObserverDeserializer:()=>Q,createObserverSerializer:()=>N,createSnapshotDeserializer:()=>K,createSnapshotSerializer:()=>J,createSoADeserializer:()=>x,createSoASerializer:()=>O,f32:()=>q,f64:()=>H,i16:()=>w,i32:()=>G,i8:()=>W,u16:()=>P,u32:()=>L,u8:()=>k});module.exports=ee(se);var R=Symbol("u8"),U=Symbol("i8"),D=Symbol("u16"),v=Symbol("i16"),I=Symbol("u32"),z=Symbol("i32"),C=Symbol("f32"),$=Symbol("f64"),h=t=>(r=[])=>Object.defineProperty(r,t,{value:!0,enumerable:!1,writable:!1,configurable:!1}),k=h(R),W=h(U),P=h(D),w=h(v),L=h(I),G=h(z),q=h(C),H=h($),M={[R]:(t,r,i)=>(t.setUint8(r,i),1),[U]:(t,r,i)=>(t.setInt8(r,i),1),[D]:(t,r,i)=>(t.setUint16(r,i),2),[v]:(t,r,i)=>(t.setInt16(r,i),2),[I]:(t,r,i)=>(t.setUint32(r,i),4),[z]:(t,r,i)=>(t.setInt32(r,i),4),[C]:(t,r,i)=>(t.setFloat32(r,i),4),[$]:(t,r,i)=>(t.setFloat64(r,i),8)},j={[R]:(t,r)=>({value:t.getUint8(r),size:1}),[U]:(t,r)=>({value:t.getInt8(r),size:1}),[D]:(t,r)=>({value:t.getUint16(r),size:2}),[v]:(t,r)=>({value:t.getInt16(r),size:2}),[I]:(t,r)=>({value:t.getUint32(r),size:4}),[z]:(t,r)=>({value:t.getInt32(r),size:4}),[C]:(t,r)=>({value:t.getFloat32(r),size:4}),[$]:(t,r)=>({value:t.getFloat64(r),size:8})},ne=t=>{let r=Object.keys(t),n=r.map(o=>{let s=t[o];for(let e of[R,U,D,v,I,z,C,$])if(e in s)return e;return $}).map(o=>M[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0;a+=M[I](o,s+a,e);for(let l=0;l<r.length;l++)a+=n[l](o,s+a,t[r[l]][e]);return a}},te=t=>{let r=Object.keys(t),n=r.map(o=>{let s=t[o];for(let e of[R,U,D,v,I,z,C,$])if(e in s)return e;return $}).map(o=>j[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0,{value:l,size:u}=j[I](o,s+a);a+=u;let y=e?e.get(l)??l:l;for(let m=0;m<r.length;m++){let{value:b,size:c}=n[m](o,s+a);t[r[m]][y]=b,a+=c}return a}},O=(t,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),n=t.map(ne);return o=>{let s=0;for(let e=0;e<o.length;e++){let a=o[e];for(let l=0;l<n.length;l++)s+=n[l](i,s,a)}return r.slice(0,s)}},x=t=>{let r=t.map(te);return(i,n)=>{let o=new DataView(i),s=0;for(;s<i.byteLength;)for(let e=0;e<r.length;e++)s+=r[e](o,s,n)}};var g=require("bitecs");function re(t,r,i,n){if(!t)return n;if(Array.isArray(t)){let o=t[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s],a=e[r];a!==void 0&&(e instanceof Int8Array||U in e?(i.setInt8(n,a),n+=1):e instanceof Uint8Array||R in e?(i.setUint8(n,a),n+=1):e instanceof Int16Array||v in e?(i.setInt16(n,a),n+=2):e instanceof Uint16Array||D in e?(i.setUint16(n,a),n+=2):e instanceof Int32Array||z in e?(i.setInt32(n,a),n+=4):e instanceof Uint32Array||I in e?(i.setUint32(n,a),n+=4):e instanceof Float32Array||C in e?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function ie(t,r,i,n){if(!t)return n;if(Array.isArray(t))return t[r]=i.getFloat64(n),n+8;if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s];e instanceof Int8Array||U in e?(e[r]=i.getInt8(n),n+=1):e instanceof Uint8Array||R in e?(e[r]=i.getUint8(n),n+=1):e instanceof Int16Array||v in e?(e[r]=i.getInt16(n),n+=2):e instanceof Uint16Array||D in e?(e[r]=i.getUint16(n),n+=2):e instanceof Int32Array||z in e?(e[r]=i.getInt32(n),n+=4):e instanceof Uint32Array||I in e?(e[r]=i.getUint32(n),n+=4):e instanceof Float32Array||C in e?(e[r]=i.getFloat32(n),n+=4):(e[r]=i.getFloat64(n),n+=8)}}return n}var J=(t,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),o=0,s=a=>{let l=a.length;n.setUint32(o,l),o+=4;for(let u=0;u<l;u++){let y=a[u],m=0;n.setUint32(o,y),o+=4;let b=o;o+=1;for(let c=0;c<r.length;c++){let f=r[c];if((0,g.isRelation)(f)){let A=(0,g.getRelationTargets)(t,y,f);for(let S of A){n.setUint8(o,c),o+=1,n.setUint32(o,S),o+=4;let d=f(S);o=re(d,y,n,o),m++}}else(0,g.hasComponent)(t,y,f)&&(n.setUint8(o,c),o+=1,m++)}n.setUint8(b,m)}},e=a=>{let u=O(r,i.slice(o))(a);new Uint8Array(i).set(new Uint8Array(u),o),o+=u.byteLength};return()=>{o=0;let a=(0,g.getAllEntities)(t);return s(a),e(a),i.slice(0,o)}},K=(t,r,i)=>{let n=i||new Map,o=x(r);return(s,e)=>{let a=e||n,l=new DataView(s),u=0,y=l.getUint32(u);u+=4;for(let m=0;m<y;m++){let b=l.getUint32(u);u+=4;let c=a.get(b);c===void 0&&(c=(0,g.addEntity)(t),a.set(b,c));let f=l.getUint8(u);u+=1;for(let A=0;A<f;A++){let S=l.getUint8(u);u+=1;let d=r[S];if((0,g.isRelation)(d)){let T=l.getUint32(u);u+=4;let E=a.get(T);E===void 0&&(E=(0,g.addEntity)(t),a.set(T,E));let B=d(E);(0,g.addComponent)(t,c,B),u=ie(B,c,l,u)}else(0,g.addComponent)(t,c,d)}}return o(s.slice(u),a),a}};var p=require("bitecs");function oe(t,r,i,n){if(!t)return n;if(Array.isArray(t)){let o=t[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s],a=e[r];a!==void 0&&(e instanceof Int8Array||U in e?(i.setInt8(n,a),n+=1):e instanceof Uint8Array||R in e?(i.setUint8(n,a),n+=1):e instanceof Int16Array||v in e?(i.setInt16(n,a),n+=2):e instanceof Uint16Array||D in e?(i.setUint16(n,a),n+=2):e instanceof Int32Array||z in e?(i.setInt32(n,a),n+=4):e instanceof Uint32Array||I in e?(i.setUint32(n,a),n+=4):e instanceof Float32Array||C in e?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function ae(t,r,i,n){if(!t)return n;if(Array.isArray(t))return t[r]=i.getFloat64(n),n+8;if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s];e instanceof Int8Array||U in e?(e[r]=i.getInt8(n),n+=1):e instanceof Uint8Array||R in e?(e[r]=i.getUint8(n),n+=1):e instanceof Int16Array||v in e?(e[r]=i.getInt16(n),n+=2):e instanceof Uint16Array||D in e?(e[r]=i.getUint16(n),n+=2):e instanceof Int32Array||z in e?(e[r]=i.getInt32(n),n+=4):e instanceof Uint32Array||I in e?(e[r]=i.getUint32(n),n+=4):e instanceof Float32Array||C in e?(e[r]=i.getFloat32(n),n+=4):(e[r]=i.getFloat64(n),n+=8)}}return n}var N=(t,r,i,n=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(n),s=0,e=[],a=new Map;return(0,p.observe)(t,(0,p.onAdd)(r),l=>{e.push([l,0,-1])}),(0,p.observe)(t,(0,p.onRemove)(r),l=>{e.push([l,1,-1]),a.delete(l)}),i.forEach((l,u)=>{(0,p.isRelation)(l)?((0,p.observe)(t,(0,p.onAdd)(r,l(p.Wildcard)),y=>{let m=(0,p.getRelationTargets)(t,y,l);for(let b of m){a.has(y)||a.set(y,new Map),a.get(y).set(u,b);let c=l(b);e.push([y,4,u,b,c])}}),(0,p.observe)(t,(0,p.onRemove)(r,l(p.Wildcard)),y=>{let m=a.get(y);if(m){let b=m.get(u);b!==void 0&&(e.push([y,5,u,b]),m.delete(u),m.size===0&&a.delete(y))}})):((0,p.observe)(t,(0,p.onAdd)(r,l),y=>{e.push([y,2,u])}),(0,p.observe)(t,(0,p.onRemove)(r,l),y=>{e.push([y,3,u])}))}),()=>{s=0;for(let l=0;l<e.length;l++){let[u,y,m,b,c]=e[l];o.setUint32(s,u),s+=4,o.setUint8(s,y),s+=1,(y===2||y===3||y===4||y===5)&&(o.setUint8(s,m),s+=1,(y===4||y===5)&&(o.setUint32(s,b),s+=4,y===4&&c&&(s=oe(c,u,o,s))))}return e.length=0,n.slice(0,s)}},Q=(t,r,i,n)=>{let o=n||new Map;return(s,e)=>{let a=e||o,l=new DataView(s),u=0;for(;u<s.byteLength;){let y=l.getUint32(u);u+=4;let m=l.getUint8(u);u+=1;let b=-1,c=-1;(m===2||m===3||m===4||m===5)&&(b=l.getUint8(u),u+=1,(m===4||m===5)&&(c=l.getUint32(u),u+=4));let f=i[b],A=a.get(y);if(m===0)if(A===void 0)A=(0,p.addEntity)(t),a.set(y,A),(0,p.addComponent)(t,A,r);else throw new Error(`Entity with ID ${y} already exists in the mapping.`);else if(A!==void 0&&(0,p.entityExists)(t,A)){if(m===1)(0,p.removeEntity)(t,A);else if(m===2)(0,p.addComponent)(t,A,f);else if(m===3)(0,p.removeComponent)(t,A,f);else if(m===4){let S=a.get(c);if(S!==void 0){let d=f(S);(0,p.addComponent)(t,A,d),u=ae(d,A,l,u)}}else if(m===5){let S=a.get(c);S!==void 0&&(0,p.removeComponent)(t,A,f(S))}}}return a}};
//# sourceMappingURL=index.min.cjs.map
