var Z=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var Ee=Object.prototype.hasOwnProperty;var Oe=(e,t)=>{for(var o in t)Z(e,o,{get:t[o],enumerable:!0})},Se=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ae(t))!Ee.call(e,i)&&i!==o&&Z(e,i,{get:()=>t[i],enumerable:!(n=he(t,i))||n.enumerable});return e};var We=e=>Se(Z({},"__esModule",{value:!0}),e);var Ne={};Oe(Ne,{createObserverDeserializer:()=>Ce,createObserverSerializer:()=>Te,createSnapshotDeserializer:()=>Ie,createSnapshotSerializer:()=>xe,createSoADeserializer:()=>K,createSoASerializer:()=>G,f32:()=>ye,f64:()=>fe,i16:()=>le,i32:()=>me,i8:()=>pe,u16:()=>ce,u32:()=>ue,u8:()=>ae});module.exports=We(Ne);var x=Symbol.for("bitecs-u8"),I=Symbol.for("bitecs-i8"),T=Symbol.for("bitecs-u16"),C=Symbol.for("bitecs-i16"),R=Symbol.for("bitecs-u32"),h=Symbol.for("bitecs-i32"),A=Symbol.for("bitecs-f32"),Q=Symbol.for("bitecs-f64"),W=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),ae=W(x),pe=W(I),ce=W(T),le=W(C),ue=W(R),me=W(h),ye=W(A),fe=W(Q),ie={[x]:(e,t,o)=>(e.setUint8(t,o),1),[I]:(e,t,o)=>(e.setInt8(t,o),1),[T]:(e,t,o)=>(e.setUint16(t,o),2),[C]:(e,t,o)=>(e.setInt16(t,o),2),[R]:(e,t,o)=>(e.setUint32(t,o),4),[h]:(e,t,o)=>(e.setInt32(t,o),4),[A]:(e,t,o)=>(e.setFloat32(t,o),4),[Q]:(e,t,o)=>(e.setFloat64(t,o),8)},se={[x]:(e,t)=>({value:e.getUint8(t),size:1}),[I]:(e,t)=>({value:e.getInt8(t),size:1}),[T]:(e,t)=>({value:e.getUint16(t),size:2}),[C]:(e,t)=>({value:e.getInt16(t),size:2}),[R]:(e,t)=>({value:e.getUint32(t),size:4}),[h]:(e,t)=>({value:e.getInt32(t),size:4}),[A]:(e,t)=>({value:e.getFloat32(t),size:4}),[Q]:(e,t)=>({value:e.getFloat64(t),size:8})},Me=e=>{let t=Object.keys(e),n=t.map(i=>{let s=e[i];for(let r of[x,I,T,C,R,h,A,Q])if(r in s)return r;return Q}).map(i=>ie[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,s,r)=>{let a=0;a+=ie[R](i,s+a,r);for(let c=0;c<t.length;c++)a+=n[c](i,s+a,e[t[c]][r]);return a}},De=e=>{let t=Object.keys(e),n=t.map(i=>{let s=e[i];for(let r of[x,I,T,C,R,h,A,Q])if(r in s)return r;return Q}).map(i=>se[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,s,r)=>{let a=0,{value:c,size:p}=se[R](i,s+a);a+=p;let u=r?r.get(c)??c:c;for(let l=0;l<t.length;l++){let{value:y,size:f}=n[l](i,s+a);e[t[l]][u]=y,a+=f}return a}},G=(e,t=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(t),n=e.map(Me);return i=>{let s=0;for(let r=0;r<i.length;r++){let a=i[r];for(let c=0;c<n.length;c++)s+=n[c](o,s,a)}return t.slice(0,s)}},K=e=>{let t=e.map(De);return(o,n)=>{let i=new DataView(o),s=0;for(;s<o.byteLength;)for(let r=0;r<t.length;r++)s+=t[r](i,s,n)}};var $=(e,t,o)=>Object.defineProperty(e,t,{value:o,enumerable:!1,writable:!0,configurable:!0});var de=(e,t)=>t&e.entityMask;var be=e=>{if(e.aliveCount<e.dense.length){let o=e.dense[e.aliveCount],n=o;return e.sparse[n]=e.aliveCount,e.aliveCount++,o}let t=++e.maxId;return e.dense.push(t),e.sparse[t]=e.aliveCount,e.aliveCount++,t};var ee=(e,t)=>{let o=de(e,t),n=e.sparse[o];return n!==void 0&&n<e.aliveCount&&e.dense[n]===t};var g=Symbol.for("bitecs_internal");var te=e=>e[g].entityIndex.dense.slice(0);var _=()=>{let e=new Set;return{subscribe:n=>(e.add(n),()=>{e.delete(n)}),notify:(n,...i)=>Array.from(e).reduce((s,r)=>{let a=r(n,...i);return a&&typeof a=="object"?{...s,...a}:s},{})}};var ct=Symbol.for("bitecs-opType"),lt=Symbol.for("bitecs-opTerms");function B(e,t,o){let n=e[g],{masks:i,notMasks:s,orMasks:r,generations:a}=t;for(let c=0;c<a.length;c++){let p=a[c],u=i[p],l=s[p],y=r[p],f=n.entityMasks[p][o];if(l&&f&l||u&&(f&u)!==u||y&&!(f&y))return!1}return!0}var P=(e,t)=>{e.toRemove.remove(t),e.addObservable.notify(t),e.add(t)};var J=(e,t,o)=>{let n=e[g];!t.has(o)||t.toRemove.has(o)||(t.toRemove.add(o),n.dirtyQueries.add(t),t.removeObservable.notify(o))};var j=Symbol.for("bitecs-relation"),D=Symbol.for("bitecs-pairTarget"),F=Symbol.for("bitecs-isPairComponent"),w=Symbol.for("bitecs-relationData"),ge=()=>{let e={pairsMap:new Map,initStore:void 0,exclusiveRelation:!1,autoRemoveSubject:!1,onTargetRemoved:void 0},t=o=>{if(o===void 0)throw Error("Relation target is undefined");let n=o==="*"?v:o;if(!e.pairsMap.has(n)){let i=e.initStore?e.initStore():{};$(i,j,t),$(i,D,n),$(i,F,!0),e.pairsMap.set(n,i)}return e.pairsMap.get(n)};return $(t,w,e),t};var k=(e,t)=>{if(e===void 0)throw Error("Relation is undefined");return e(t)},U=(e,t,o)=>{let n=N(e,t),i=[];for(let s of n)s[j]===o&&s[D]!==v&&!H(s[D])&&i.push(s[D]);return i};var Ue=Symbol.for("bitecs-wildcard");function Qe(){let e=ge();return Object.defineProperty(e,Ue,{value:!0,enumerable:!1,writable:!1,configurable:!1}),e}function $e(){let e=Symbol.for("bitecs-global-wildcard");return globalThis[e]||(globalThis[e]=Qe()),globalThis[e]}var v=$e();function je(){return ge()}function ze(){let e=Symbol.for("bitecs-global-isa");return globalThis[e]||(globalThis[e]=je()),globalThis[e]}var z=ze();function H(e){return e?Object.getOwnPropertySymbols(e).includes(w):!1}var ne=(e,t)=>{if(!t)throw new Error("bitECS - Cannot register null or undefined component");let o=e[g],n=new Set,i={id:o.componentCount++,generationId:o.entityMasks.length-1,bitflag:o.bitflag,ref:t,queries:n,setObservable:_(),getObservable:_()};return o.componentMap.set(t,i),o.bitflag*=2,o.bitflag>=2**31&&(o.bitflag=1,o.entityMasks.push([])),i};var M=(e,t,o)=>{let n=e[g],i=n.componentMap.get(o);if(!i)return!1;let{generationId:s,bitflag:r}=i;return(n.entityMasks[s][t]&r)===r},Re=(e,t,o)=>{let i=e[g].componentMap.get(o);if(i&&M(e,t,o))return i.getObservable.notify(t)};var ve=(e,t,o,n=!0)=>{let i=e[g];O(e,t,z(o));for(let s of N(e,o))if(s!==q&&(O(e,t,s),n)){let r=i.componentMap.get(s);if(r?.setObservable){let a=Re(e,o,s);r.setObservable.notify(t,a)}}for(let s of U(e,o,z))ve(e,t,s,!1)},O=(e,t,...o)=>{if(!X(e,t))throw new Error(`Cannot add component - entity ${t} does not exist in the world.`);let n=e[g];o.forEach(i=>{let s="component"in i?i.component:i,r="data"in i?i.data:void 0;n.componentMap.has(s)||ne(e,s);let a=n.componentMap.get(s);if(r!==void 0&&a.setObservable.notify(t,r),M(e,t,s))return;let{generationId:c,bitflag:p,queries:u}=a;if(n.entityMasks[c][t]|=p,M(e,t,q)||u.forEach(l=>{l.toRemove.remove(t),B(e,l,t)?P(l,t):J(e,l,t)}),n.entityComponents.get(t).add(s),s[F]){let l=s[j],y=s[D];if(O(e,t,k(l,v)),O(e,t,k(v,y)),typeof y=="number"&&(O(e,y,k(v,l)),n.entitiesWithRelations.add(y)),n.entitiesWithRelations.add(y),l[w].exclusiveRelation===!0&&y!==v){let b=U(e,t,l)[0];b!=null&&b!==y&&V(e,t,l(b))}if(l===z){let b=U(e,t,z);for(let d of b)ve(e,t,d)}}})};var V=(e,t,...o)=>{let n=e[g];if(!X(e,t))throw new Error(`Cannot remove component - entity ${t} does not exist in the world.`);o.forEach(i=>{if(!M(e,t,i))return;let s=n.componentMap.get(i),{generationId:r,bitflag:a,queries:c}=s;if(n.entityMasks[r][t]&=~a,c.forEach(p=>{p.toRemove.remove(t),B(e,p,t)?P(p,t):J(e,p,t)}),n.entityComponents.get(t).delete(i),i[F]){let p=i[D];V(e,t,k(v,p));let u=i[j];U(e,t,u).length===0&&V(e,t,k(u,v))}})};var q={};var Y=e=>{let t=e[g],o=be(t.entityIndex);return t.notQueries.forEach(n=>{B(e,n,o)&&P(n,o)}),t.entityComponents.set(o,new Set),o};var N=(e,t)=>{let o=e[g];if(t===void 0)throw new Error("getEntityComponents: entity id is undefined.");if(!ee(o.entityIndex,t))throw new Error(`getEntityComponents: entity ${t} does not exist in the world.`);return Array.from(o.entityComponents.get(t))},X=(e,t)=>ee(e[g].entityIndex,t);function qe(e,t,o,n){if(!e)return n;if(Array.isArray(e)){let i=e[t];return i!==void 0?(o.setFloat64(n,i),n+8):n}if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let r=e[s],a=r[t];a!==void 0&&(r instanceof Int8Array||I in r?(o.setInt8(n,a),n+=1):r instanceof Uint8Array||x in r?(o.setUint8(n,a),n+=1):r instanceof Int16Array||C in r?(o.setInt16(n,a),n+=2):r instanceof Uint16Array||T in r?(o.setUint16(n,a),n+=2):r instanceof Int32Array||h in r?(o.setInt32(n,a),n+=4):r instanceof Uint32Array||R in r?(o.setUint32(n,a),n+=4):r instanceof Float32Array||A in r?(o.setFloat32(n,a),n+=4):(o.setFloat64(n,a),n+=8))}}return n}function Fe(e,t,o,n){if(!e)return n;if(Array.isArray(e))return e[t]=o.getFloat64(n),n+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let r=e[s];r instanceof Int8Array||I in r?(r[t]=o.getInt8(n),n+=1):r instanceof Uint8Array||x in r?(r[t]=o.getUint8(n),n+=1):r instanceof Int16Array||C in r?(r[t]=o.getInt16(n),n+=2):r instanceof Uint16Array||T in r?(r[t]=o.getUint16(n),n+=2):r instanceof Int32Array||h in r?(r[t]=o.getInt32(n),n+=4):r instanceof Uint32Array||R in r?(r[t]=o.getUint32(n),n+=4):r instanceof Float32Array||A in r?(r[t]=o.getFloat32(n),n+=4):(r[t]=o.getFloat64(n),n+=8)}}return n}var xe=(e,t,o=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(o),i=0,s=a=>{let c=a.length;n.setUint32(i,c),i+=4;for(let p=0;p<c;p++){let u=a[p],l=0;n.setUint32(i,u),i+=4;let y=i;i+=1;for(let f=0;f<t.length;f++){let b=t[f];if(H(b)){let d=U(e,u,b);for(let E of d){n.setUint8(i,f),i+=1,n.setUint32(i,E),i+=4;let S=b(E);i=qe(S,u,n,i),l++}}else M(e,u,b)&&(n.setUint8(i,f),i+=1,l++)}n.setUint8(y,l)}},r=a=>{let p=G(t,o.slice(i))(a);new Uint8Array(o).set(new Uint8Array(p),i),i+=p.byteLength};return()=>{i=0;let a=te(e);return s(a),r(a),o.slice(0,i)}},Ie=(e,t,o)=>{let n=o||new Map,i=K(t);return(s,r)=>{let a=r||n,c=new DataView(s),p=0,u=c.getUint32(p);p+=4;for(let l=0;l<u;l++){let y=c.getUint32(p);p+=4;let f=a.get(y);f===void 0&&(f=Y(e),a.set(y,f));let b=c.getUint8(p);p+=1;for(let d=0;d<b;d++){let E=c.getUint8(p);p+=1;let S=t[E];if(H(S)){let oe=c.getUint32(p);p+=4;let L=a.get(oe);L===void 0&&(L=Y(e),a.set(oe,L));let re=S(L);O(e,f,re),p=Fe(re,f,c,p)}else O(e,f,S)}}return i(s.slice(p),a),a}};var m=require("bitecs");function we(e,t,o,n){if(!e)return n;if(Array.isArray(e)){let i=e[t];return i!==void 0?(o.setFloat64(n,i),n+8):n}if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let r=e[s],a=r[t];a!==void 0&&(r instanceof Int8Array||I in r?(o.setInt8(n,a),n+=1):r instanceof Uint8Array||x in r?(o.setUint8(n,a),n+=1):r instanceof Int16Array||C in r?(o.setInt16(n,a),n+=2):r instanceof Uint16Array||T in r?(o.setUint16(n,a),n+=2):r instanceof Int32Array||h in r?(o.setInt32(n,a),n+=4):r instanceof Uint32Array||R in r?(o.setUint32(n,a),n+=4):r instanceof Float32Array||A in r?(o.setFloat32(n,a),n+=4):(o.setFloat64(n,a),n+=8))}}return n}function He(e,t,o,n){if(!e)return n;if(Array.isArray(e))return e[t]=o.getFloat64(n),n+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let r=e[s];r instanceof Int8Array||I in r?(r[t]=o.getInt8(n),n+=1):r instanceof Uint8Array||x in r?(r[t]=o.getUint8(n),n+=1):r instanceof Int16Array||C in r?(r[t]=o.getInt16(n),n+=2):r instanceof Uint16Array||T in r?(r[t]=o.getUint16(n),n+=2):r instanceof Int32Array||h in r?(r[t]=o.getInt32(n),n+=4):r instanceof Uint32Array||R in r?(r[t]=o.getUint32(n),n+=4):r instanceof Float32Array||A in r?(r[t]=o.getFloat32(n),n+=4):(r[t]=o.getFloat64(n),n+=8)}}return n}var Te=(e,t,o,n=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(n),s=0,r=[],a=new Map;return(0,m.observe)(e,(0,m.onAdd)(t),c=>{r.push([c,0,-1])}),(0,m.observe)(e,(0,m.onRemove)(t),c=>{r.push([c,1,-1]),a.delete(c)}),o.forEach((c,p)=>{(0,m.isRelation)(c)?((0,m.observe)(e,(0,m.onAdd)(t,c(m.Wildcard)),u=>{let l=(0,m.getRelationTargets)(e,u,c);for(let y of l){a.has(u)||a.set(u,new Map),a.get(u).set(p,y);let f=c(y);r.push([u,4,p,y,f])}}),(0,m.observe)(e,(0,m.onRemove)(t,c(m.Wildcard)),u=>{let l=a.get(u);if(l){let y=l.get(p);y!==void 0&&(r.push([u,5,p,y]),l.delete(p),l.size===0&&a.delete(u))}})):((0,m.observe)(e,(0,m.onAdd)(t,c),u=>{r.push([u,2,p])}),(0,m.observe)(e,(0,m.onRemove)(t,c),u=>{r.push([u,3,p])}))}),()=>{s=0;for(let c=0;c<r.length;c++){let[p,u,l,y,f]=r[c];i.setUint32(s,p),s+=4,i.setUint8(s,u),s+=1,(u===2||u===3||u===4||u===5)&&(i.setUint8(s,l),s+=1,(u===4||u===5)&&(i.setUint32(s,y),s+=4,u===4&&f&&(s=we(f,p,i,s))))}return r.length=0,n.slice(0,s)}},Ce=(e,t,o,n)=>{let i=n||new Map;return(s,r)=>{let a=r||i,c=new DataView(s),p=0;for(;p<s.byteLength;){let u=c.getUint32(p);p+=4;let l=c.getUint8(p);p+=1;let y=-1,f=-1;(l===2||l===3||l===4||l===5)&&(y=c.getUint8(p),p+=1,(l===4||l===5)&&(f=c.getUint32(p),p+=4));let b=o[y],d=a.get(u);if(l===0)if(d===void 0)d=(0,m.addEntity)(e),a.set(u,d),(0,m.addComponent)(e,d,t);else throw new Error(`Entity with ID ${u} already exists in the mapping.`);else if(d!==void 0&&(0,m.entityExists)(e,d)){if(l===1)(0,m.removeEntity)(e,d);else if(l===2)(0,m.addComponent)(e,d,b);else if(l===3)(0,m.removeComponent)(e,d,b);else if(l===4){let E=a.get(f);if(E!==void 0){let S=b(E);(0,m.addComponent)(e,d,S),p=He(S,d,c,p)}}else if(l===5){let E=a.get(f);E!==void 0&&(0,m.removeComponent)(e,d,b(E))}}}return a}};
//# sourceMappingURL=index.min.cjs.map
