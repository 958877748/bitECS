var V=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var oe=Object.prototype.hasOwnProperty;var ye=(e,r)=>{for(var a in r)V(e,a,{get:r[a],enumerable:!0})},se=(e,r,a,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ae(r))!oe.call(e,i)&&i!==a&&V(e,i,{get:()=>r[i],enumerable:!(n=ie(r,i))||n.enumerable});return e};var ue=e=>se(V({},"__esModule",{value:!0}),e);var ge={};ye(ge,{$f32:()=>I,$f64:()=>$,$i16:()=>z,$i32:()=>D,$i8:()=>R,$u16:()=>U,$u32:()=>A,$u8:()=>d,array:()=>Y,createObserverDeserializer:()=>re,createObserverSerializer:()=>te,createSnapshotDeserializer:()=>ne,createSnapshotSerializer:()=>ee,createSoADeserializer:()=>W,createSoASerializer:()=>w,f32:()=>P,f64:()=>N,i16:()=>H,i32:()=>K,i8:()=>q,u16:()=>G,u32:()=>J,u8:()=>L});module.exports=ue(ge);var d=Symbol.for("bitecs-u8"),R=Symbol.for("bitecs-i8"),U=Symbol.for("bitecs-u16"),z=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),D=Symbol.for("bitecs-i32"),I=Symbol.for("bitecs-f32"),$=Symbol.for("bitecs-f64"),x=Symbol.for("bitecs-arr"),h=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),L=h(d),q=h(R),G=h(U),H=h(z),J=h(A),K=h(D),P=h(I),N=h($),le=new Map([[L,d],[q,R],[G,U],[H,z],[J,A],[K,D],[P,I],[N,$]]),C={[d]:(e,r,a)=>(e.setUint8(r,a),1),[R]:(e,r,a)=>(e.setInt8(r,a),1),[U]:(e,r,a)=>(e.setUint16(r,a),2),[z]:(e,r,a)=>(e.setInt16(r,a),2),[A]:(e,r,a)=>(e.setUint32(r,a),4),[D]:(e,r,a)=>(e.setInt32(r,a),4),[I]:(e,r,a)=>(e.setFloat32(r,a),4),[$]:(e,r,a)=>(e.setFloat64(r,a),8)},F={[d]:(e,r)=>({value:e.getUint8(r),size:1}),[R]:(e,r)=>({value:e.getInt8(r),size:1}),[U]:(e,r)=>({value:e.getUint16(r),size:2}),[z]:(e,r)=>({value:e.getInt16(r),size:2}),[A]:(e,r)=>({value:e.getUint32(r),size:4}),[D]:(e,r)=>({value:e.getInt32(r),size:4}),[I]:(e,r)=>({value:e.getFloat32(r),size:4}),[$]:(e,r)=>({value:e.getFloat64(r),size:8})};function j(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let r=le.get(e);if(r)return r;throw new Error(`Unknown type function: ${e}`)}return E(e)?j(e[x]):I}var Y=(e=P)=>{let r=[];return Object.defineProperty(r,x,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function B(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function M(e){if(E(e))return j(e[x]);for(let r of[d,R,U,z,A,D,I,$])if(r in e)return r;return e instanceof Int8Array?R:e instanceof Uint8Array?d:e instanceof Int16Array?z:e instanceof Uint16Array?U:e instanceof Int32Array?D:e instanceof Uint32Array?A:e instanceof Float32Array?I:$}function E(e){return Array.isArray(e)&&x in e}function k(e){return e[x]}function Z(e,r,a,n){let i=0,s=Array.isArray(r)?1:0;if(i+=C[d](a,n,s),!s)return i;i+=C[A](a,n+i,r.length);for(let t=0;t<r.length;t++){let o=r[t];if(E(e))i+=Z(k(e),o,a,n+i);else{let u=j(e);i+=C[u](a,n+i,o)}}return i}function _(e,r,a){let n=0,i=F[d](r,a+n);if(n+=i.size,!i.value)return{size:n};let s=F[A](r,a+n);n+=s.size;let t=new Array(s.value);for(let o=0;o<t.length;o++)if(E(e)){let{value:u,size:y}=_(k(e),r,a+n);n+=y,Array.isArray(u)&&(t[o]=u)}else{let u=j(e),{value:y,size:l}=F[u](r,a+n);n+=l,t[o]=y}return{value:t,size:n}}var pe=e=>{if(B(e)){let i=M(e),s=C[i];return(t,o,u)=>{let y=0;return y+=C[A](t,o,u),y+=s(t,o+y,e[u]),y}}let r=Object.keys(e),n=r.map(i=>{let s=e[i];if(!B(s))throw new Error(`Invalid array type for property ${i}`);return M(s)}).map(i=>C[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,s,t)=>{let o=0;o+=C[A](i,s+o,t);for(let u=0;u<r.length;u++){let y=e[r[u]];E(y)?o+=Z(k(y),y[t],i,s+o):o+=n[u](i,s+o,y[t])}return o}},ce=e=>{if(B(e)){let i=M(e),s=F[i];return(t,o,u)=>{let y=0,{value:l,size:p}=F[A](t,o);y+=p;let b=u?u.get(l)??l:l,{value:m,size:f}=s(t,o+y);return e[b]=m,y+f}}let r=Object.keys(e),n=r.map(i=>{let s=e[i];if(!B(s))throw new Error(`Invalid array type for property ${i}`);return M(s)}).map(i=>F[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,s,t)=>{let o=0,{value:u,size:y}=F[A](i,s+o);o+=y;let l=t?t.get(u)??u:u;for(let p=0;p<r.length;p++){let b=e[r[p]];if(E(b)){let{value:m,size:f}=_(k(b),i,s+o);Array.isArray(m)&&(b[l]=m),o+=f}else{let{value:m,size:f}=n[p](i,s+o);e[r[p]][l]=m,o+=f}}return o}},w=(e,r=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(r),n=e.map(pe);return i=>{let s=0;for(let t=0;t<i.length;t++){let o=i[t];for(let u=0;u<n.length;u++)s+=n[u](a,s,o)}return r.slice(0,s)}},W=e=>{let r=e.map(ce);return(a,n)=>{let i=new DataView(a),s=0;for(;s<a.byteLength;)for(let t=0;t<r.length;t++)s+=r[t](i,s,n)}};var T=require("bitecs");function me(e,r,a,n){if(!e)return n;if(Array.isArray(e)){let i=e[r];return i!==void 0?(a.setFloat64(n,i),n+8):n}if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s],o=t[r];o!==void 0&&(t instanceof Int8Array||R in t?(a.setInt8(n,o),n+=1):t instanceof Uint8Array||d in t?(a.setUint8(n,o),n+=1):t instanceof Int16Array||z in t?(a.setInt16(n,o),n+=2):t instanceof Uint16Array||U in t?(a.setUint16(n,o),n+=2):t instanceof Int32Array||D in t?(a.setInt32(n,o),n+=4):t instanceof Uint32Array||A in t?(a.setUint32(n,o),n+=4):t instanceof Float32Array||I in t?(a.setFloat32(n,o),n+=4):(a.setFloat64(n,o),n+=8))}}return n}function be(e,r,a,n){if(!e)return n;if(Array.isArray(e))return e[r]=a.getFloat64(n),n+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s];t instanceof Int8Array||R in t?(t[r]=a.getInt8(n),n+=1):t instanceof Uint8Array||d in t?(t[r]=a.getUint8(n),n+=1):t instanceof Int16Array||z in t?(t[r]=a.getInt16(n),n+=2):t instanceof Uint16Array||U in t?(t[r]=a.getUint16(n),n+=2):t instanceof Int32Array||D in t?(t[r]=a.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=a.getUint32(n),n+=4):t instanceof Float32Array||I in t?(t[r]=a.getFloat32(n),n+=4):(t[r]=a.getFloat64(n),n+=8)}}return n}var ee=(e,r,a=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(a),i=0,s=o=>{let u=o.length;n.setUint32(i,u),i+=4;for(let y=0;y<u;y++){let l=o[y],p=0;n.setUint32(i,l),i+=4;let b=i;i+=1;for(let m=0;m<r.length;m++){let f=r[m];if((0,T.isRelation)(f)){let g=(0,T.getRelationTargets)(e,l,f);for(let v of g){n.setUint8(i,m),i+=1,n.setUint32(i,v),i+=4;let S=f(v);i=me(S,l,n,i),p++}}else(0,T.hasComponent)(e,l,f)&&(n.setUint8(i,m),i+=1,p++)}n.setUint8(b,p)}},t=o=>{let y=w(r,a.slice(i))(o);new Uint8Array(a).set(new Uint8Array(y),i),i+=y.byteLength};return()=>{i=0;let o=(0,T.getAllEntities)(e);return s(o),t(o),a.slice(0,i)}},ne=(e,r,a)=>{let n=a||new Map,i=W(r);return(s,t)=>{let o=t||n,u=new DataView(s),y=0,l=u.getUint32(y);y+=4;for(let p=0;p<l;p++){let b=u.getUint32(y);y+=4;let m=o.get(b);m===void 0&&(m=(0,T.addEntity)(e),o.set(b,m));let f=u.getUint8(y);y+=1;for(let g=0;g<f;g++){let v=u.getUint8(y);y+=1;let S=r[v];if((0,T.isRelation)(S)){let Q=u.getUint32(y);y+=4;let O=o.get(Q);O===void 0&&(O=(0,T.addEntity)(e),o.set(Q,O));let X=S(O);(0,T.addComponent)(e,m,X),y=be(X,m,u,y)}else(0,T.addComponent)(e,m,S)}}return i(s.slice(y),o),o}};var c=require("bitecs");function Ae(e,r,a,n){if(!e)return n;if(Array.isArray(e)){let i=e[r];return i!==void 0?(a.setFloat64(n,i),n+8):n}if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s],o=t[r];o!==void 0&&(t instanceof Int8Array||R in t?(a.setInt8(n,o),n+=1):t instanceof Uint8Array||d in t?(a.setUint8(n,o),n+=1):t instanceof Int16Array||z in t?(a.setInt16(n,o),n+=2):t instanceof Uint16Array||U in t?(a.setUint16(n,o),n+=2):t instanceof Int32Array||D in t?(a.setInt32(n,o),n+=4):t instanceof Uint32Array||A in t?(a.setUint32(n,o),n+=4):t instanceof Float32Array||I in t?(a.setFloat32(n,o),n+=4):(a.setFloat64(n,o),n+=8))}}return n}function fe(e,r,a,n){if(!e)return n;if(Array.isArray(e))return e[r]=a.getFloat64(n),n+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s];t instanceof Int8Array||R in t?(t[r]=a.getInt8(n),n+=1):t instanceof Uint8Array||d in t?(t[r]=a.getUint8(n),n+=1):t instanceof Int16Array||z in t?(t[r]=a.getInt16(n),n+=2):t instanceof Uint16Array||U in t?(t[r]=a.getUint16(n),n+=2):t instanceof Int32Array||D in t?(t[r]=a.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=a.getUint32(n),n+=4):t instanceof Float32Array||I in t?(t[r]=a.getFloat32(n),n+=4):(t[r]=a.getFloat64(n),n+=8)}}return n}var te=(e,r,a,n=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(n),s=0,t=[],o=new Map;return(0,c.observe)(e,(0,c.onAdd)(r),u=>{t.push([u,0,-1])}),(0,c.observe)(e,(0,c.onRemove)(r),u=>{t.push([u,1,-1]),o.delete(u)}),a.forEach((u,y)=>{(0,c.isRelation)(u)?((0,c.observe)(e,(0,c.onAdd)(r,u(c.Wildcard)),l=>{let p=(0,c.getRelationTargets)(e,l,u);for(let b of p){o.has(l)||o.set(l,new Map),o.get(l).set(y,b);let m=u(b);t.push([l,4,y,b,m])}}),(0,c.observe)(e,(0,c.onRemove)(r,u(c.Wildcard)),l=>{let p=o.get(l);if(p){let b=p.get(y);b!==void 0&&(t.push([l,5,y,b]),p.delete(y),p.size===0&&o.delete(l))}})):((0,c.observe)(e,(0,c.onAdd)(r,u),l=>{t.push([l,2,y])}),(0,c.observe)(e,(0,c.onRemove)(r,u),l=>{t.push([l,3,y])}))}),()=>{s=0;for(let u=0;u<t.length;u++){let[y,l,p,b,m]=t[u];i.setUint32(s,y),s+=4,i.setUint8(s,l),s+=1,(l===2||l===3||l===4||l===5)&&(i.setUint8(s,p),s+=1,(l===4||l===5)&&(i.setUint32(s,b),s+=4,l===4&&m&&(s=Ae(m,y,i,s))))}return t.length=0,n.slice(0,s)}},re=(e,r,a,n)=>{let i=n||new Map;return(s,t)=>{let o=t||i,u=new DataView(s),y=0;for(;y<s.byteLength;){let l=u.getUint32(y);y+=4;let p=u.getUint8(y);y+=1;let b=-1,m=-1;(p===2||p===3||p===4||p===5)&&(b=u.getUint8(y),y+=1,(p===4||p===5)&&(m=u.getUint32(y),y+=4));let f=a[b],g=o.get(l);if(p===0)g===void 0?(g=(0,c.addEntity)(e),o.set(l,g),(0,c.addComponent)(e,g,r)):console.warn(`Attempted to deserialize addEntity with ID ${l}, but it has already been deserialzied and exists in the mapping.`);else if(g!==void 0&&(0,c.entityExists)(e,g)){if(p===1)(0,c.removeEntity)(e,g),o.delete(l);else if(p===2)(0,c.addComponent)(e,g,f);else if(p===3)(0,c.removeComponent)(e,g,f);else if(p===4){let v=o.get(m);if(v!==void 0){let S=f(v);(0,c.addComponent)(e,g,S),y=fe(S,g,u,y)}}else if(p===5){let v=o.get(m);v!==void 0&&(0,c.removeComponent)(e,g,f(v))}}}return o}};
//# sourceMappingURL=index.min.cjs.map
