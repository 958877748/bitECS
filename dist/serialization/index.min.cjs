var L=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var me=Object.prototype.hasOwnProperty;var fe=(e,t)=>{for(var i in t)L(e,i,{get:t[i],enumerable:!0})},be=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ce(t))!me.call(e,s)&&s!==i&&L(e,s,{get:()=>t[s],enumerable:!(n=pe(t,s))||n.enumerable});return e};var Ae=e=>be(L({},"__esModule",{value:!0}),e);var Oe={};fe(Oe,{$f32:()=>R,$f64:()=>$,$i16:()=>v,$i32:()=>C,$i8:()=>U,$u16:()=>h,$u32:()=>A,$u8:()=>z,array:()=>te,createAoSDeserializer:()=>oe,createAoSSerializer:()=>ae,createObserverDeserializer:()=>ue,createObserverSerializer:()=>le,createSnapshotDeserializer:()=>ye,createSnapshotSerializer:()=>se,createSoADeserializer:()=>G,createSoASerializer:()=>N,f32:()=>W,f64:()=>Y,i16:()=>K,i32:()=>X,i8:()=>H,u16:()=>J,u32:()=>Q,u8:()=>q});module.exports=Ae(Oe);var z=Symbol.for("bitecs-u8"),U=Symbol.for("bitecs-i8"),h=Symbol.for("bitecs-u16"),v=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),C=Symbol.for("bitecs-i32"),R=Symbol.for("bitecs-f32"),$=Symbol.for("bitecs-f64"),M=Symbol.for("bitecs-arr"),x=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),q=x(z),H=x(U),J=x(h),K=x(v),Q=x(A),X=x(C),W=x(R),Y=x($),ge=new Map([[q,z],[H,U],[J,h],[K,v],[Q,A],[X,C],[W,R],[Y,$]]),S={[z]:(e,t,i)=>(e.setUint8(t,i),1),[U]:(e,t,i)=>(e.setInt8(t,i),1),[h]:(e,t,i)=>(e.setUint16(t,i),2),[v]:(e,t,i)=>(e.setInt16(t,i),2),[A]:(e,t,i)=>(e.setUint32(t,i),4),[C]:(e,t,i)=>(e.setInt32(t,i),4),[R]:(e,t,i)=>(e.setFloat32(t,i),4),[$]:(e,t,i)=>(e.setFloat64(t,i),8)},T={[z]:(e,t)=>({value:e.getUint8(t),size:1}),[U]:(e,t)=>({value:e.getInt8(t),size:1}),[h]:(e,t)=>({value:e.getUint16(t),size:2}),[v]:(e,t)=>({value:e.getInt16(t),size:2}),[A]:(e,t)=>({value:e.getUint32(t),size:4}),[C]:(e,t)=>({value:e.getInt32(t),size:4}),[R]:(e,t)=>({value:e.getFloat32(t),size:4}),[$]:(e,t)=>({value:e.getFloat64(t),size:8})};function w(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let t=ge.get(e);if(t)return t;throw new Error(`Unknown type function: ${e}`)}return E(e)?w(e[M]):R}var te=(e=W)=>{let t=[];return Object.defineProperty(t,M,{value:e,enumerable:!1,writable:!1,configurable:!1}),t};function V(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function O(e){if(E(e))return w(e[M]);for(let t of[z,U,h,v,A,C,R,$])if(t in e)return t;return e instanceof Int8Array?U:e instanceof Uint8Array?z:e instanceof Int16Array?v:e instanceof Uint16Array?h:e instanceof Int32Array?C:e instanceof Uint32Array?A:e instanceof Float32Array?R:$}function E(e){return Array.isArray(e)&&M in e}function F(e){return e[M]}function P(e,t,i,n){let s=0,l=Array.isArray(t)?1:0;if(s+=S[z](i,n,l),!l)return s;s+=S[A](i,n+s,t.length);for(let r=0;r<t.length;r++){let a=t[r];if(E(e))s+=P(F(e),a,i,n+s);else{let o=w(e);s+=S[o](i,n+s,a)}}return s}function k(e,t,i){let n=0,s=T[z](t,i+n);if(n+=s.size,!s.value)return{size:n};let l=T[A](t,i+n);n+=l.size;let r=new Array(l.value);for(let a=0;a<r.length;a++)if(E(e)){let{value:o,size:y}=k(F(e),t,i+n);n+=y,Array.isArray(o)&&(r[a]=o)}else{let o=w(e),{value:y,size:u}=T[o](t,i+n);n+=u,r[a]=y}return{value:r,size:n}}var de=e=>{let t=O(e);return t===R||t===$},Se=(e,t)=>de(e)?t:0,ze=(e,t)=>{let i=e.get(t);return i||(ArrayBuffer.isView(t)?i=new t.constructor(t.length):i=new Array(t.length).fill(0),e.set(t,i)),i},ee=(e,t,i,n=1e-4)=>{let s=ze(e,t),l=t[i],r=Se(t,n),a=r>0?Math.abs(s[i]-l)>r:s[i]!==l;return s[i]=l,a},Te=(e,t=!1,i,n=1e-4)=>{if(V(e)){let a=O(e),o=S[a];return(y,u,p,c)=>{if(t&&i){if(!ee(i,e,p,n))return 0;let m=0;return m+=S[A](y,u+m,p),m+=S[A](y,u+m,c),m+=o(y,u+m,e[p]),m}else{let m=0;return m+=S[A](y,u+m,p),m+=o(y,u+m,e[p]),m}}}let s=Object.keys(e),r=s.map(a=>{let o=e[a];if(!V(o))throw new Error(`Invalid array type for property ${a}`);return O(o)}).map(a=>S[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,o,y,u)=>{if(t&&i){let p=0;for(let f=0;f<s.length;f++){let b=e[s[f]];ee(i,b,y,n)&&(p|=1<<f)}if(p===0)return 0;let c=0;c+=S[A](a,o+c,y),c+=S[A](a,o+c,u);let m=s.length<=8?S[z]:s.length<=16?S[h]:S[A];c+=m(a,o+c,p);for(let f=0;f<s.length;f++)if(p&1<<f){let b=e[s[f]];E(b)?c+=P(F(b),b[y],a,o+c):c+=r[f](a,o+c,b[y])}return c}else{let p=0;p+=S[A](a,o+p,y);for(let c=0;c<s.length;c++){let m=e[s[c]];E(m)?p+=P(F(m),m[y],a,o+p):p+=r[c](a,o+p,m[y])}return p}}},he=(e,t=!1)=>{if(V(e)){let l=O(e),r=T[l];return(a,o,y)=>{let u=0,{value:p,size:c}=T[A](a,o);u+=c;let m=y?y.get(p)??p:p;if(t){let{size:d}=T[A](a,o+u);u+=d}let{value:f,size:b}=r(a,o+u);return e[m]=f,u+b}}let i=Object.keys(e),s=i.map(l=>{let r=e[l];if(!V(r))throw new Error(`Invalid array type for property ${l}`);return O(r)}).map(l=>T[l]||(()=>{throw new Error("Unsupported or unannotated type")}));return(l,r,a)=>{let o=0,{value:y,size:u}=T[A](l,r+o);o+=u;let p=a?a.get(y)??y:y;if(t){let{size:c}=T[A](l,r+o);o+=c;let m=i.length<=8?T[z]:i.length<=16?T[h]:T[A],{value:f,size:b}=m(l,r+o);o+=b;for(let d=0;d<i.length;d++)if(f&1<<d){let I=e[i[d]];if(E(I)){let{value:j,size:B}=k(F(I),l,r+o);Array.isArray(j)&&(I[p]=j),o+=B}else{let{value:j,size:B}=s[d](l,r+o);e[i[d]][p]=j,o+=B}}}else for(let c=0;c<i.length;c++){let m=e[i[c]];if(E(m)){let{value:f,size:b}=k(F(m),l,r+o);Array.isArray(f)&&(m[p]=f),o+=b}else{let{value:f,size:b}=s[c](l,r+o);e[i[c]][p]=f,o+=b}}return o}},N=(e,t={})=>{let{diff:i=!1,buffer:n=new ArrayBuffer(1024*1024*100),epsilon:s=1e-4}=t,l=new DataView(n),r=i?new Map:void 0,a=e.map(o=>Te(o,i,r,s));return o=>{let y=0;for(let u=0;u<o.length;u++){let p=o[u];for(let c=0;c<a.length;c++)y+=a[c](l,y,p,c)}return n.slice(0,y)}},G=(e,t={})=>{let{diff:i=!1}=t,n=e.map(s=>he(s,i));return(s,l)=>{let r=new DataView(s),a=0;for(;a<s.byteLength;)if(i){let{value:o,size:y}=T[A](r,a),{value:u,size:p}=T[A](r,a+y);a+=n[u](r,a,l)}else for(let o=0;o<n.length;o++)a+=n[o](r,a,l)}};var Re=e=>{let t=O(e);return t===R||t===$},ne=(e,t)=>Re(e)?t:0,ie=(e,t)=>{let i=e.get(t);return i||(i=[],e.set(t,i)),i},Z=(e,t,i,n)=>{let s=ie(e,t),l=t[i],r=s[i];if(l===void 0)return!1;if(r===void 0)return!0;if(typeof l=="object"&&l!==null){let a=t;for(let o in l)if(a[o]){let y=ne(a[o],n);if(y>0?Math.abs(r[o]-l[o])>y:r[o]!==l[o])return!0}return!1}else{let a=ne(t,n);return a>0?Math.abs(r-l)>a:r!==l}},re=(e,t,i)=>{let n=ie(e,t),s=t[i];typeof s=="object"&&s!==null?n[i]={...s}:n[i]=s},De=(e,t,i,n=1e-4)=>{if(typeof e=="object"&&Object.keys(e).some(l=>isNaN(parseInt(l))&&typeof e[l]=="object")){let l=Object.keys(e).filter(o=>isNaN(parseInt(o))),a=l.map(o=>O(e[o])).map(o=>S[o]);return(o,y,u)=>{let p=e[u];if(p===void 0)return 0;if(t&&i){if(!Z(i,e,u,n))return 0;re(i,e,u)}let c=0;for(let m=0;m<l.length;m++){let f=e[l[m]],b=p[l[m]];E(f)?c+=P(F(f),b,o,y+c):c+=a[m](o,y+c,b)}return c}}else{let l=O(e),r=S[l];return(a,o,y)=>{let u=e[y];if(u===void 0)return 0;if(t&&i){if(!Z(i,e,y,n))return 0;re(i,e,y)}return r(a,o,u)}}},Ie=e=>{if(typeof e=="object"&&Object.keys(e).some(i=>isNaN(parseInt(i))&&typeof e[i]=="object")){let i=Object.keys(e).filter(l=>isNaN(parseInt(l))),s=i.map(l=>O(e[l])).map(l=>T[l]);return(l,r,a)=>{let o=0,y={};for(let u=0;u<i.length;u++){let p=e[i[u]];if(E(p)){let{value:c,size:m}=k(F(p),l,r+o);Array.isArray(c)&&(y[i[u]]=c),o+=m}else{let{value:c,size:m}=s[u](l,r+o);y[i[u]]=c,o+=m}}return e[a]=y,o}}else{let i=O(e),n=T[i];return(s,l,r)=>{let{value:a,size:o}=n(s,l);return e[r]=a,o}}},ae=(e,t={})=>{let{diff:i=!1,buffer:n=new ArrayBuffer(1024*1024*100),epsilon:s=1e-4}=t,l=new DataView(n),r=i?new Map:void 0,a=e.map(o=>De(o,i,r,s));return o=>{let y=0;for(let u=0;u<o.length;u++){let p=o[u];if(i){let c=!1;for(let d=0;d<e.length;d++)if(r&&Z(r,e[d],p,s)){c=!0;break}if(!c)continue;y+=S[A](l,y,p);let m=y,f=e.length<=8?S[z]:e.length<=16?S[h]:S[A];y+=f===S[z]?1:f===S[h]?2:4;let b=0;for(let d=0;d<a.length;d++){let I=a[d](l,y,p);I>0&&(b|=1<<d,y+=I)}f(l,m,b)}else{y+=S[A](l,y,p);for(let c=0;c<a.length;c++)y+=a[c](l,y,p)}}return n.slice(0,y)}},oe=(e,t={})=>{let{diff:i=!1}=t,n=e.map(s=>Ie(s));return(s,l)=>{let r=new DataView(s),a=0;for(;a<s.byteLength;){let{value:o,size:y}=T[A](r,a);a+=y;let u=l?l.get(o)??o:o;if(i){let p=e.length<=8?T[z]:e.length<=16?T[h]:T[A],{value:c,size:m}=p(r,a);a+=m;for(let f=0;f<e.length;f++)c&1<<f&&(a+=n[f](r,a,u))}else for(let p=0;p<n.length;p++)a+=n[p](r,a,u)}}};var D=require("bitecs");function Ue(e,t,i,n){if(!e)return n;if(Array.isArray(e)){let s=e[t];return s!==void 0?(i.setFloat64(n,s),n+8):n}if(typeof e=="object"){let s=Object.keys(e).sort();for(let l of s){let r=e[l],a=r[t];a!==void 0&&(r instanceof Int8Array||U in r?(i.setInt8(n,a),n+=1):r instanceof Uint8Array||z in r?(i.setUint8(n,a),n+=1):r instanceof Int16Array||v in r?(i.setInt16(n,a),n+=2):r instanceof Uint16Array||h in r?(i.setUint16(n,a),n+=2):r instanceof Int32Array||C in r?(i.setInt32(n,a),n+=4):r instanceof Uint32Array||A in r?(i.setUint32(n,a),n+=4):r instanceof Float32Array||R in r?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function ve(e,t,i,n){if(!e)return n;if(Array.isArray(e))return e[t]=i.getFloat64(n),n+8;if(typeof e=="object"){let s=Object.keys(e).sort();for(let l of s){let r=e[l];r instanceof Int8Array||U in r?(r[t]=i.getInt8(n),n+=1):r instanceof Uint8Array||z in r?(r[t]=i.getUint8(n),n+=1):r instanceof Int16Array||v in r?(r[t]=i.getInt16(n),n+=2):r instanceof Uint16Array||h in r?(r[t]=i.getUint16(n),n+=2):r instanceof Int32Array||C in r?(r[t]=i.getInt32(n),n+=4):r instanceof Uint32Array||A in r?(r[t]=i.getUint32(n),n+=4):r instanceof Float32Array||R in r?(r[t]=i.getFloat32(n),n+=4):(r[t]=i.getFloat64(n),n+=8)}}return n}var se=(e,t,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),s=0,l=a=>{let o=a.length;n.setUint32(s,o),s+=4;for(let y=0;y<o;y++){let u=a[y],p=0;n.setUint32(s,u),s+=4;let c=s;s+=1;for(let m=0;m<t.length;m++){let f=t[m];if((0,D.isRelation)(f)){let b=(0,D.getRelationTargets)(e,u,f);for(let d of b){n.setUint8(s,m),s+=1,n.setUint32(s,d),s+=4;let I=f(d);s=Ue(I,u,n,s),p++}}else(0,D.hasComponent)(e,u,f)&&(n.setUint8(s,m),s+=1,p++)}n.setUint8(c,p)}},r=a=>{let y=N(t,{buffer:i.slice(s)})(a);new Uint8Array(i).set(new Uint8Array(y),s),s+=y.byteLength};return()=>{s=0;let a=(0,D.getAllEntities)(e);return l(a),r(a),i.slice(0,s)}},ye=(e,t,i)=>{let n=i||new Map,s=G(t);return(l,r)=>{let a=r||n,o=new DataView(l),y=0,u=o.getUint32(y);y+=4;for(let p=0;p<u;p++){let c=o.getUint32(y);y+=4;let m=a.get(c);m===void 0&&(m=(0,D.addEntity)(e),a.set(c,m));let f=o.getUint8(y);y+=1;for(let b=0;b<f;b++){let d=o.getUint8(y);y+=1;let I=t[d];if((0,D.isRelation)(I)){let j=o.getUint32(y);y+=4;let B=a.get(j);B===void 0&&(B=(0,D.addEntity)(e),a.set(j,B));let _=I(B);(0,D.addComponent)(e,m,_),y=ve(_,m,o,y)}else(0,D.addComponent)(e,m,I)}}return s(l.slice(y),a),a}};var g=require("bitecs");function Ce(e,t,i,n){if(!e)return n;if(Array.isArray(e)){let s=e[t];return s!==void 0?(i.setFloat64(n,s),n+8):n}if(typeof e=="object"){let s=Object.keys(e).sort();for(let l of s){let r=e[l],a=r[t];a!==void 0&&(r instanceof Int8Array||U in r?(i.setInt8(n,a),n+=1):r instanceof Uint8Array||z in r?(i.setUint8(n,a),n+=1):r instanceof Int16Array||v in r?(i.setInt16(n,a),n+=2):r instanceof Uint16Array||h in r?(i.setUint16(n,a),n+=2):r instanceof Int32Array||C in r?(i.setInt32(n,a),n+=4):r instanceof Uint32Array||A in r?(i.setUint32(n,a),n+=4):r instanceof Float32Array||R in r?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function $e(e,t,i,n){if(!e)return n;if(Array.isArray(e))return e[t]=i.getFloat64(n),n+8;if(typeof e=="object"){let s=Object.keys(e).sort();for(let l of s){let r=e[l];r instanceof Int8Array||U in r?(r[t]=i.getInt8(n),n+=1):r instanceof Uint8Array||z in r?(r[t]=i.getUint8(n),n+=1):r instanceof Int16Array||v in r?(r[t]=i.getInt16(n),n+=2):r instanceof Uint16Array||h in r?(r[t]=i.getUint16(n),n+=2):r instanceof Int32Array||C in r?(r[t]=i.getInt32(n),n+=4):r instanceof Uint32Array||A in r?(r[t]=i.getUint32(n),n+=4):r instanceof Float32Array||R in r?(r[t]=i.getFloat32(n),n+=4):(r[t]=i.getFloat64(n),n+=8)}}return n}var le=(e,t,i,n=new ArrayBuffer(1024*1024*100))=>{let s=new DataView(n),l=0,r=[],a=new Map;return(0,g.observe)(e,(0,g.onAdd)(t),o=>{r.push([o,0,-1])}),(0,g.observe)(e,(0,g.onRemove)(t),o=>{r.push([o,1,-1]),a.delete(o)}),i.forEach((o,y)=>{(0,g.isRelation)(o)?((0,g.observe)(e,(0,g.onAdd)(t,o(g.Wildcard)),u=>{let p=(0,g.getRelationTargets)(e,u,o);for(let c of p){a.has(u)||a.set(u,new Map),a.get(u).set(y,c);let m=o(c);r.push([u,4,y,c,m])}}),(0,g.observe)(e,(0,g.onRemove)(t,o(g.Wildcard)),u=>{let p=a.get(u);if(p){let c=p.get(y);c!==void 0&&(r.push([u,5,y,c]),p.delete(y),p.size===0&&a.delete(u))}})):((0,g.observe)(e,(0,g.onAdd)(t,o),u=>{r.push([u,2,y])}),(0,g.observe)(e,(0,g.onRemove)(t,o),u=>{r.push([u,3,y])}))}),()=>{l=0;for(let o=0;o<r.length;o++){let[y,u,p,c,m]=r[o];s.setUint32(l,y),l+=4,s.setUint8(l,u),l+=1,(u===2||u===3||u===4||u===5)&&(s.setUint8(l,p),l+=1,(u===4||u===5)&&(s.setUint32(l,c),l+=4,u===4&&m&&(l=Ce(m,y,s,l))))}return r.length=0,n.slice(0,l)}},ue=(e,t,i,n)=>{let s=n||new Map;return(l,r)=>{let a=r||s,o=new DataView(l),y=0;for(;y<l.byteLength;){let u=o.getUint32(y);y+=4;let p=o.getUint8(y);y+=1;let c=-1,m=-1;(p===2||p===3||p===4||p===5)&&(c=o.getUint8(y),y+=1,(p===4||p===5)&&(m=o.getUint32(y),y+=4));let f=i[c],b=a.get(u);if(p===0)b===void 0?(b=(0,g.addEntity)(e),a.set(u,b),(0,g.addComponent)(e,b,t)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(b!==void 0&&(0,g.entityExists)(e,b)){if(p===1)(0,g.removeEntity)(e,b),a.delete(u);else if(p===2)(0,g.addComponent)(e,b,f);else if(p===3)(0,g.removeComponent)(e,b,f);else if(p===4){let d=a.get(m);if(d!==void 0){let I=f(d);(0,g.addComponent)(e,b,I),y=$e(I,b,o,y)}}else if(p===5){let d=a.get(m);d!==void 0&&(0,g.removeComponent)(e,b,f(d))}}}return a}};
//# sourceMappingURL=index.min.cjs.map
