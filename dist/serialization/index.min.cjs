var P=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var ne=(e,r)=>{for(var i in r)P(e,i,{get:r[i],enumerable:!0})},re=(e,r,i,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of ee(r))!te.call(e,a)&&a!==i&&P(e,a,{get:()=>r[a],enumerable:!(n=_(r,a))||n.enumerable});return e};var ie=e=>re(P({},"__esModule",{value:!0}),e);var ce={};ne(ce,{array:()=>N,createObserverDeserializer:()=>Z,createObserverSerializer:()=>Y,createSnapshotDeserializer:()=>X,createSnapshotSerializer:()=>Q,createSoADeserializer:()=>M,createSoASerializer:()=>j,f32:()=>J,f64:()=>K,i16:()=>q,i32:()=>H,i8:()=>L,u16:()=>V,u32:()=>G,u8:()=>w});module.exports=ie(ce);var U=Symbol.for("bitecs-u8"),v=Symbol.for("bitecs-i8"),D=Symbol.for("bitecs-u16"),z=Symbol.for("bitecs-i16"),g=Symbol.for("bitecs-u32"),S=Symbol.for("bitecs-i32"),R=Symbol.for("bitecs-f32"),E=Symbol.for("bitecs-f64"),k=Symbol.for("bitecs-arr"),C=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),w=C(U),L=C(v),V=C(D),q=C(z),G=C(g),H=C(S),J=C(R),K=C(E),h={[U]:(e,r,i)=>(e.setUint8(r,i),1),[v]:(e,r,i)=>(e.setInt8(r,i),1),[D]:(e,r,i)=>(e.setUint16(r,i),2),[z]:(e,r,i)=>(e.setInt16(r,i),2),[g]:(e,r,i)=>(e.setUint32(r,i),4),[S]:(e,r,i)=>(e.setInt32(r,i),4),[R]:(e,r,i)=>(e.setFloat32(r,i),4),[E]:(e,r,i)=>(e.setFloat64(r,i),8)},$={[U]:(e,r)=>({value:e.getUint8(r),size:1}),[v]:(e,r)=>({value:e.getInt8(r),size:1}),[D]:(e,r)=>({value:e.getUint16(r),size:2}),[z]:(e,r)=>({value:e.getInt16(r),size:2}),[g]:(e,r)=>({value:e.getUint32(r),size:4}),[S]:(e,r)=>({value:e.getInt32(r),size:4}),[R]:(e,r)=>({value:e.getFloat32(r),size:4}),[E]:(e,r)=>({value:e.getFloat64(r),size:8})},N=(e=R)=>{let r=[];return Object.defineProperty(r,k,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function B(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function F(e){for(let r of[U,v,D,z,g,S,R,E])if(r in e)return r;return e instanceof Int8Array?v:e instanceof Uint8Array?U:e instanceof Int16Array?z:e instanceof Uint16Array?D:e instanceof Int32Array?S:e instanceof Uint32Array?g:e instanceof Float32Array?R:E}var ae=e=>{if(B(e)){let a=F(e),y=h[a];return(t,o,l)=>{let s=0;return s+=h[g](t,o,l),s+=y(t,o+s,e[l]),s}}let r=Object.keys(e),n=r.map(a=>{let y=e[a];if(!B(y))throw new Error(`Invalid array type for property ${a}`);return F(y)}).map(a=>h[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,y,t)=>{let o=0;o+=h[g](a,y+o,t);for(let l=0;l<r.length;l++){let s=e[r[l]][k];if(s!==void 0){let u=e[r[l]][t],c=u.length;o+=h[g](a,y+o,c);for(let b=0;b<c;b++)o+=h[s](a,y+o,u[b])}else o+=n[l](a,y+o,e[r[l]][t])}return o}},oe=e=>{if(B(e)){let a=F(e),y=$[a];return(t,o,l)=>{let s=0,{value:u,size:c}=$[g](t,o);s+=c;let b=l?l.get(u)??u:u,{value:m,size:f}=y(t,o+s);return e[b]=m,s+f}}let r=Object.keys(e),n=r.map(a=>{let y=e[a];if(!B(y))throw new Error(`Invalid array type for property ${a}`);return F(y)}).map(a=>$[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,y,t)=>{let o=0,{value:l,size:s}=$[g](a,y+o);o+=s;let u=t?t.get(l)??l:l;for(let c=0;c<r.length;c++){let b=e[r[c]][k];if(b!==void 0){let{value:m,size:f}=$[g](a,y+o),A=new Array(m);o+=f;for(let I=0;I<m;I++){let{value:T,size:O}=$[b](a,y+o);o+=O,A[I]=T}e[r[c]][u]=A}else{let{value:m,size:f}=n[c](a,y+o);e[r[c]][u]=m,o+=f}}return o}},j=(e,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),n=e.map(ae);return a=>{let y=0;for(let t=0;t<a.length;t++){let o=a[t];for(let l=0;l<n.length;l++)y+=n[l](i,y,o)}return r.slice(0,y)}},M=e=>{let r=e.map(oe);return(i,n)=>{let a=new DataView(i),y=0;for(;y<i.byteLength;)for(let t=0;t<r.length;t++)y+=r[t](a,y,n)}};var d=require("bitecs");function se(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y],o=t[r];o!==void 0&&(t instanceof Int8Array||v in t?(i.setInt8(n,o),n+=1):t instanceof Uint8Array||U in t?(i.setUint8(n,o),n+=1):t instanceof Int16Array||z in t?(i.setInt16(n,o),n+=2):t instanceof Uint16Array||D in t?(i.setUint16(n,o),n+=2):t instanceof Int32Array||S in t?(i.setInt32(n,o),n+=4):t instanceof Uint32Array||g in t?(i.setUint32(n,o),n+=4):t instanceof Float32Array||R in t?(i.setFloat32(n,o),n+=4):(i.setFloat64(n,o),n+=8))}}return n}function ye(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y];t instanceof Int8Array||v in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||U in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||z in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||D in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||S in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||g in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||R in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var Q=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),a=0,y=o=>{let l=o.length;n.setUint32(a,l),a+=4;for(let s=0;s<l;s++){let u=o[s],c=0;n.setUint32(a,u),a+=4;let b=a;a+=1;for(let m=0;m<r.length;m++){let f=r[m];if((0,d.isRelation)(f)){let A=(0,d.getRelationTargets)(e,u,f);for(let I of A){n.setUint8(a,m),a+=1,n.setUint32(a,I),a+=4;let T=f(I);a=se(T,u,n,a),c++}}else(0,d.hasComponent)(e,u,f)&&(n.setUint8(a,m),a+=1,c++)}n.setUint8(b,c)}},t=o=>{let s=j(r,i.slice(a))(o);new Uint8Array(i).set(new Uint8Array(s),a),a+=s.byteLength};return()=>{a=0;let o=(0,d.getAllEntities)(e);return y(o),t(o),i.slice(0,a)}},X=(e,r,i)=>{let n=i||new Map,a=M(r);return(y,t)=>{let o=t||n,l=new DataView(y),s=0,u=l.getUint32(s);s+=4;for(let c=0;c<u;c++){let b=l.getUint32(s);s+=4;let m=o.get(b);m===void 0&&(m=(0,d.addEntity)(e),o.set(b,m));let f=l.getUint8(s);s+=1;for(let A=0;A<f;A++){let I=l.getUint8(s);s+=1;let T=r[I];if((0,d.isRelation)(T)){let O=l.getUint32(s);s+=4;let x=o.get(O);x===void 0&&(x=(0,d.addEntity)(e),o.set(O,x));let W=T(x);(0,d.addComponent)(e,m,W),s=ye(W,m,l,s)}else(0,d.addComponent)(e,m,T)}}return a(y.slice(s),o),o}};var p=require("bitecs");function le(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y],o=t[r];o!==void 0&&(t instanceof Int8Array||v in t?(i.setInt8(n,o),n+=1):t instanceof Uint8Array||U in t?(i.setUint8(n,o),n+=1):t instanceof Int16Array||z in t?(i.setInt16(n,o),n+=2):t instanceof Uint16Array||D in t?(i.setUint16(n,o),n+=2):t instanceof Int32Array||S in t?(i.setInt32(n,o),n+=4):t instanceof Uint32Array||g in t?(i.setUint32(n,o),n+=4):t instanceof Float32Array||R in t?(i.setFloat32(n,o),n+=4):(i.setFloat64(n,o),n+=8))}}return n}function ue(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y];t instanceof Int8Array||v in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||U in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||z in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||D in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||S in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||g in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||R in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var Y=(e,r,i,n=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(n),y=0,t=[],o=new Map;return(0,p.observe)(e,(0,p.onAdd)(r),l=>{t.push([l,0,-1])}),(0,p.observe)(e,(0,p.onRemove)(r),l=>{t.push([l,1,-1]),o.delete(l)}),i.forEach((l,s)=>{(0,p.isRelation)(l)?((0,p.observe)(e,(0,p.onAdd)(r,l(p.Wildcard)),u=>{let c=(0,p.getRelationTargets)(e,u,l);for(let b of c){o.has(u)||o.set(u,new Map),o.get(u).set(s,b);let m=l(b);t.push([u,4,s,b,m])}}),(0,p.observe)(e,(0,p.onRemove)(r,l(p.Wildcard)),u=>{let c=o.get(u);if(c){let b=c.get(s);b!==void 0&&(t.push([u,5,s,b]),c.delete(s),c.size===0&&o.delete(u))}})):((0,p.observe)(e,(0,p.onAdd)(r,l),u=>{t.push([u,2,s])}),(0,p.observe)(e,(0,p.onRemove)(r,l),u=>{t.push([u,3,s])}))}),()=>{y=0;for(let l=0;l<t.length;l++){let[s,u,c,b,m]=t[l];a.setUint32(y,s),y+=4,a.setUint8(y,u),y+=1,(u===2||u===3||u===4||u===5)&&(a.setUint8(y,c),y+=1,(u===4||u===5)&&(a.setUint32(y,b),y+=4,u===4&&m&&(y=le(m,s,a,y))))}return t.length=0,n.slice(0,y)}},Z=(e,r,i,n)=>{let a=n||new Map;return(y,t)=>{let o=t||a,l=new DataView(y),s=0;for(;s<y.byteLength;){let u=l.getUint32(s);s+=4;let c=l.getUint8(s);s+=1;let b=-1,m=-1;(c===2||c===3||c===4||c===5)&&(b=l.getUint8(s),s+=1,(c===4||c===5)&&(m=l.getUint32(s),s+=4));let f=i[b],A=o.get(u);if(c===0)A===void 0?(A=(0,p.addEntity)(e),o.set(u,A),(0,p.addComponent)(e,A,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(A!==void 0&&(0,p.entityExists)(e,A)){if(c===1)(0,p.removeEntity)(e,A),o.delete(u);else if(c===2)(0,p.addComponent)(e,A,f);else if(c===3)(0,p.removeComponent)(e,A,f);else if(c===4){let I=o.get(m);if(I!==void 0){let T=f(I);(0,p.addComponent)(e,A,T),s=ue(T,A,l,s)}}else if(c===5){let I=o.get(m);I!==void 0&&(0,p.removeComponent)(e,A,f(I))}}}return o}};
//# sourceMappingURL=index.min.cjs.map
