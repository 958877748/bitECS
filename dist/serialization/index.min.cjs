var k=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var ae=Object.prototype.hasOwnProperty;var oe=(e,r)=>{for(var a in r)k(e,a,{get:r[a],enumerable:!0})},se=(e,r,a,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ie(r))!ae.call(e,i)&&i!==a&&k(e,i,{get:()=>r[i],enumerable:!(t=re(r,i))||t.enumerable});return e};var ye=e=>se(k({},"__esModule",{value:!0}),e);var Ae={};oe(Ae,{$f32:()=>R,$f64:()=>E,$i16:()=>D,$i32:()=>v,$i8:()=>U,$u16:()=>z,$u32:()=>A,$u8:()=>I,array:()=>X,createObserverDeserializer:()=>ne,createObserverSerializer:()=>te,createSnapshotDeserializer:()=>ee,createSnapshotSerializer:()=>_,createSoADeserializer:()=>j,createSoASerializer:()=>M,f32:()=>N,f64:()=>Q,i16:()=>H,i32:()=>K,i8:()=>q,u16:()=>G,u32:()=>J,u8:()=>L});module.exports=ye(Ae);var I=Symbol.for("bitecs-u8"),U=Symbol.for("bitecs-i8"),z=Symbol.for("bitecs-u16"),D=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),v=Symbol.for("bitecs-i32"),R=Symbol.for("bitecs-f32"),E=Symbol.for("bitecs-f64"),W=Symbol.for("bitecs-arr"),$=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),L=$(I),q=$(U),G=$(z),H=$(D),J=$(A),K=$(v),N=$(R),Q=$(E),h={[I]:(e,r,a)=>(e.setUint8(r,a),1),[U]:(e,r,a)=>(e.setInt8(r,a),1),[z]:(e,r,a)=>(e.setUint16(r,a),2),[D]:(e,r,a)=>(e.setInt16(r,a),2),[A]:(e,r,a)=>(e.setUint32(r,a),4),[v]:(e,r,a)=>(e.setInt32(r,a),4),[R]:(e,r,a)=>(e.setFloat32(r,a),4),[E]:(e,r,a)=>(e.setFloat64(r,a),8)},C={[I]:(e,r)=>({value:e.getUint8(r),size:1}),[U]:(e,r)=>({value:e.getInt8(r),size:1}),[z]:(e,r)=>({value:e.getUint16(r),size:2}),[D]:(e,r)=>({value:e.getInt16(r),size:2}),[A]:(e,r)=>({value:e.getUint32(r),size:4}),[v]:(e,r)=>({value:e.getInt32(r),size:4}),[R]:(e,r)=>({value:e.getFloat32(r),size:4}),[E]:(e,r)=>({value:e.getFloat64(r),size:8})},X=(e=R)=>{let r=[];return Object.defineProperty(r,W,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function O(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function B(e){for(let r of[I,U,z,D,A,v,R,E])if(r in e)return r;return e instanceof Int8Array?U:e instanceof Uint8Array?I:e instanceof Int16Array?D:e instanceof Uint16Array?z:e instanceof Int32Array?v:e instanceof Uint32Array?A:e instanceof Float32Array?R:E}function F(e){return Array.isArray(e)&&W in e}function P(e){return e[W]}function Y(e,r,a,t){let i=0,y=Array.isArray(r)?1:0;if(i+=h[I](a,t,y),!y)return i;i+=h[A](a,t+i,r.length);for(let n=0;n<r.length;n++){let o=r[n];F(e)?i+=Y(P(e),o,a,t+i):typeof e=="symbol"&&(i+=h[e](a,t+i,o))}return i}function Z(e,r,a){let t=0,i=C[I](r,a+t);if(t+=i.size,!i.value)return{size:t};let y=C[A](r,a+t);t+=y.size;let n=new Array(y.value);for(let o=0;o<n.length;o++)if(F(e)){let{value:l,size:s}=Z(P(e),r,a+t);t+=s,Array.isArray(l)&&(n[o]=l)}else{let{value:l,size:s}=C[e](r,a+t);t+=s,n[o]=l}return{value:n,size:t}}var le=e=>{if(O(e)){let i=B(e),y=h[i];return(n,o,l)=>{let s=0;return s+=h[A](n,o,l),s+=y(n,o+s,e[l]),s}}let r=Object.keys(e),t=r.map(i=>{let y=e[i];if(!O(y))throw new Error(`Invalid array type for property ${i}`);return B(y)}).map(i=>h[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,y,n)=>{let o=0;o+=h[A](i,y+o,n);for(let l=0;l<r.length;l++){let s=e[r[l]];F(s)?o+=Y(P(s),s[n],i,y+o):o+=t[l](i,y+o,s[n])}return o}},ue=e=>{if(O(e)){let i=B(e),y=C[i];return(n,o,l)=>{let s=0,{value:u,size:c}=C[A](n,o);s+=c;let b=l?l.get(u)??u:u,{value:m,size:f}=y(n,o+s);return e[b]=m,s+f}}let r=Object.keys(e),t=r.map(i=>{let y=e[i];if(!O(y))throw new Error(`Invalid array type for property ${i}`);return B(y)}).map(i=>C[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,y,n)=>{let o=0,{value:l,size:s}=C[A](i,y+o);o+=s;let u=n?n.get(l)??l:l;for(let c=0;c<r.length;c++){let b=e[r[c]];if(F(b)){let{value:m,size:f}=Z(P(b),i,y+o);Array.isArray(m)&&(b[u]=m),o+=f}else{let{value:m,size:f}=t[c](i,y+o);e[r[c]][u]=m,o+=f}}return o}},M=(e,r=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(r),t=e.map(le);return i=>{let y=0;for(let n=0;n<i.length;n++){let o=i[n];for(let l=0;l<t.length;l++)y+=t[l](a,y,o)}return r.slice(0,y)}},j=e=>{let r=e.map(ue);return(a,t)=>{let i=new DataView(a),y=0;for(;y<a.byteLength;)for(let n=0;n<r.length;n++)y+=r[n](i,y,t)}};var d=require("bitecs");function ce(e,r,a,t){if(!e)return t;if(Array.isArray(e)){let i=e[r];return i!==void 0?(a.setFloat64(t,i),t+8):t}if(typeof e=="object"){let i=Object.keys(e).sort();for(let y of i){let n=e[y],o=n[r];o!==void 0&&(n instanceof Int8Array||U in n?(a.setInt8(t,o),t+=1):n instanceof Uint8Array||I in n?(a.setUint8(t,o),t+=1):n instanceof Int16Array||D in n?(a.setInt16(t,o),t+=2):n instanceof Uint16Array||z in n?(a.setUint16(t,o),t+=2):n instanceof Int32Array||v in n?(a.setInt32(t,o),t+=4):n instanceof Uint32Array||A in n?(a.setUint32(t,o),t+=4):n instanceof Float32Array||R in n?(a.setFloat32(t,o),t+=4):(a.setFloat64(t,o),t+=8))}}return t}function pe(e,r,a,t){if(!e)return t;if(Array.isArray(e))return e[r]=a.getFloat64(t),t+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let y of i){let n=e[y];n instanceof Int8Array||U in n?(n[r]=a.getInt8(t),t+=1):n instanceof Uint8Array||I in n?(n[r]=a.getUint8(t),t+=1):n instanceof Int16Array||D in n?(n[r]=a.getInt16(t),t+=2):n instanceof Uint16Array||z in n?(n[r]=a.getUint16(t),t+=2):n instanceof Int32Array||v in n?(n[r]=a.getInt32(t),t+=4):n instanceof Uint32Array||A in n?(n[r]=a.getUint32(t),t+=4):n instanceof Float32Array||R in n?(n[r]=a.getFloat32(t),t+=4):(n[r]=a.getFloat64(t),t+=8)}}return t}var _=(e,r,a=new ArrayBuffer(1024*1024*100))=>{let t=new DataView(a),i=0,y=o=>{let l=o.length;t.setUint32(i,l),i+=4;for(let s=0;s<l;s++){let u=o[s],c=0;t.setUint32(i,u),i+=4;let b=i;i+=1;for(let m=0;m<r.length;m++){let f=r[m];if((0,d.isRelation)(f)){let g=(0,d.getRelationTargets)(e,u,f);for(let T of g){t.setUint8(i,m),i+=1,t.setUint32(i,T),i+=4;let S=f(T);i=ce(S,u,t,i),c++}}else(0,d.hasComponent)(e,u,f)&&(t.setUint8(i,m),i+=1,c++)}t.setUint8(b,c)}},n=o=>{let s=M(r,a.slice(i))(o);new Uint8Array(a).set(new Uint8Array(s),i),i+=s.byteLength};return()=>{i=0;let o=(0,d.getAllEntities)(e);return y(o),n(o),a.slice(0,i)}},ee=(e,r,a)=>{let t=a||new Map,i=j(r);return(y,n)=>{let o=n||t,l=new DataView(y),s=0,u=l.getUint32(s);s+=4;for(let c=0;c<u;c++){let b=l.getUint32(s);s+=4;let m=o.get(b);m===void 0&&(m=(0,d.addEntity)(e),o.set(b,m));let f=l.getUint8(s);s+=1;for(let g=0;g<f;g++){let T=l.getUint8(s);s+=1;let S=r[T];if((0,d.isRelation)(S)){let w=l.getUint32(s);s+=4;let x=o.get(w);x===void 0&&(x=(0,d.addEntity)(e),o.set(w,x));let V=S(x);(0,d.addComponent)(e,m,V),s=pe(V,m,l,s)}else(0,d.addComponent)(e,m,S)}}return i(y.slice(s),o),o}};var p=require("bitecs");function me(e,r,a,t){if(!e)return t;if(Array.isArray(e)){let i=e[r];return i!==void 0?(a.setFloat64(t,i),t+8):t}if(typeof e=="object"){let i=Object.keys(e).sort();for(let y of i){let n=e[y],o=n[r];o!==void 0&&(n instanceof Int8Array||U in n?(a.setInt8(t,o),t+=1):n instanceof Uint8Array||I in n?(a.setUint8(t,o),t+=1):n instanceof Int16Array||D in n?(a.setInt16(t,o),t+=2):n instanceof Uint16Array||z in n?(a.setUint16(t,o),t+=2):n instanceof Int32Array||v in n?(a.setInt32(t,o),t+=4):n instanceof Uint32Array||A in n?(a.setUint32(t,o),t+=4):n instanceof Float32Array||R in n?(a.setFloat32(t,o),t+=4):(a.setFloat64(t,o),t+=8))}}return t}function be(e,r,a,t){if(!e)return t;if(Array.isArray(e))return e[r]=a.getFloat64(t),t+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let y of i){let n=e[y];n instanceof Int8Array||U in n?(n[r]=a.getInt8(t),t+=1):n instanceof Uint8Array||I in n?(n[r]=a.getUint8(t),t+=1):n instanceof Int16Array||D in n?(n[r]=a.getInt16(t),t+=2):n instanceof Uint16Array||z in n?(n[r]=a.getUint16(t),t+=2):n instanceof Int32Array||v in n?(n[r]=a.getInt32(t),t+=4):n instanceof Uint32Array||A in n?(n[r]=a.getUint32(t),t+=4):n instanceof Float32Array||R in n?(n[r]=a.getFloat32(t),t+=4):(n[r]=a.getFloat64(t),t+=8)}}return t}var te=(e,r,a,t=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(t),y=0,n=[],o=new Map;return(0,p.observe)(e,(0,p.onAdd)(r),l=>{n.push([l,0,-1])}),(0,p.observe)(e,(0,p.onRemove)(r),l=>{n.push([l,1,-1]),o.delete(l)}),a.forEach((l,s)=>{(0,p.isRelation)(l)?((0,p.observe)(e,(0,p.onAdd)(r,l(p.Wildcard)),u=>{let c=(0,p.getRelationTargets)(e,u,l);for(let b of c){o.has(u)||o.set(u,new Map),o.get(u).set(s,b);let m=l(b);n.push([u,4,s,b,m])}}),(0,p.observe)(e,(0,p.onRemove)(r,l(p.Wildcard)),u=>{let c=o.get(u);if(c){let b=c.get(s);b!==void 0&&(n.push([u,5,s,b]),c.delete(s),c.size===0&&o.delete(u))}})):((0,p.observe)(e,(0,p.onAdd)(r,l),u=>{n.push([u,2,s])}),(0,p.observe)(e,(0,p.onRemove)(r,l),u=>{n.push([u,3,s])}))}),()=>{y=0;for(let l=0;l<n.length;l++){let[s,u,c,b,m]=n[l];i.setUint32(y,s),y+=4,i.setUint8(y,u),y+=1,(u===2||u===3||u===4||u===5)&&(i.setUint8(y,c),y+=1,(u===4||u===5)&&(i.setUint32(y,b),y+=4,u===4&&m&&(y=me(m,s,i,y))))}return n.length=0,t.slice(0,y)}},ne=(e,r,a,t)=>{let i=t||new Map;return(y,n)=>{let o=n||i,l=new DataView(y),s=0;for(;s<y.byteLength;){let u=l.getUint32(s);s+=4;let c=l.getUint8(s);s+=1;let b=-1,m=-1;(c===2||c===3||c===4||c===5)&&(b=l.getUint8(s),s+=1,(c===4||c===5)&&(m=l.getUint32(s),s+=4));let f=a[b],g=o.get(u);if(c===0)g===void 0?(g=(0,p.addEntity)(e),o.set(u,g),(0,p.addComponent)(e,g,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(g!==void 0&&(0,p.entityExists)(e,g)){if(c===1)(0,p.removeEntity)(e,g),o.delete(u);else if(c===2)(0,p.addComponent)(e,g,f);else if(c===3)(0,p.removeComponent)(e,g,f);else if(c===4){let T=o.get(m);if(T!==void 0){let S=f(T);(0,p.addComponent)(e,g,S),s=be(S,g,l,s)}}else if(c===5){let T=o.get(m);T!==void 0&&(0,p.removeComponent)(e,g,f(T))}}}return o}};
//# sourceMappingURL=index.min.cjs.map
