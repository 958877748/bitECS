var F=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(n,r)=>{for(var i in r)F(n,i,{get:r[i],enumerable:!0})},_=(n,r,i,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of X(r))!Y.call(n,o)&&o!==i&&F(n,o,{get:()=>r[o],enumerable:!(t=V(r,o))||t.enumerable});return n};var ee=n=>_(F({},"__esModule",{value:!0}),n);var se={};Z(se,{createObserverDeserializer:()=>Q,createObserverSerializer:()=>N,createSnapshotDeserializer:()=>K,createSnapshotSerializer:()=>J,createSoADeserializer:()=>x,createSoASerializer:()=>O,f32:()=>G,f64:()=>H,i16:()=>w,i32:()=>q,i8:()=>W,u16:()=>P,u32:()=>L,u8:()=>k});module.exports=ee(se);var R=Symbol.for("bitecs-u8"),U=Symbol.for("bitecs-i8"),D=Symbol.for("bitecs-u16"),v=Symbol.for("bitecs-i16"),f=Symbol.for("bitecs-u32"),z=Symbol.for("bitecs-i32"),C=Symbol.for("bitecs-f32"),$=Symbol.for("bitecs-f64"),h=n=>(r=[])=>Object.defineProperty(r,n,{value:!0,enumerable:!1,writable:!1,configurable:!1}),k=h(R),W=h(U),P=h(D),w=h(v),L=h(f),q=h(z),G=h(C),H=h($),M={[R]:(n,r,i)=>(n.setUint8(r,i),1),[U]:(n,r,i)=>(n.setInt8(r,i),1),[D]:(n,r,i)=>(n.setUint16(r,i),2),[v]:(n,r,i)=>(n.setInt16(r,i),2),[f]:(n,r,i)=>(n.setUint32(r,i),4),[z]:(n,r,i)=>(n.setInt32(r,i),4),[C]:(n,r,i)=>(n.setFloat32(r,i),4),[$]:(n,r,i)=>(n.setFloat64(r,i),8)},j={[R]:(n,r)=>({value:n.getUint8(r),size:1}),[U]:(n,r)=>({value:n.getInt8(r),size:1}),[D]:(n,r)=>({value:n.getUint16(r),size:2}),[v]:(n,r)=>({value:n.getInt16(r),size:2}),[f]:(n,r)=>({value:n.getUint32(r),size:4}),[z]:(n,r)=>({value:n.getInt32(r),size:4}),[C]:(n,r)=>({value:n.getFloat32(r),size:4}),[$]:(n,r)=>({value:n.getFloat64(r),size:8})},te=n=>{let r=Object.keys(n),t=r.map(o=>{let s=n[o];for(let e of[R,U,D,v,f,z,C,$])if(e in s)return e;return $}).map(o=>M[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0;a+=M[f](o,s+a,e);for(let l=0;l<r.length;l++)a+=t[l](o,s+a,n[r[l]][e]);return a}},ne=n=>{let r=Object.keys(n),t=r.map(o=>{let s=n[o];for(let e of[R,U,D,v,f,z,C,$])if(e in s)return e;return $}).map(o=>j[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0,{value:l,size:y}=j[f](o,s+a);a+=y;let u=e?e.get(l)??l:l;for(let p=0;p<r.length;p++){let{value:b,size:m}=t[p](o,s+a);n[r[p]][u]=b,a+=m}return a}},O=(n,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),t=n.map(te);return o=>{let s=0;for(let e=0;e<o.length;e++){let a=o[e];for(let l=0;l<t.length;l++)s+=t[l](i,s,a)}return r.slice(0,s)}},x=n=>{let r=n.map(ne);return(i,t)=>{let o=new DataView(i),s=0;for(;s<i.byteLength;)for(let e=0;e<r.length;e++)s+=r[e](o,s,t)}};var g=require("bitecs");function re(n,r,i,t){if(!n)return t;if(Array.isArray(n)){let o=n[r];return o!==void 0?(i.setFloat64(t,o),t+8):t}if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s],a=e[r];a!==void 0&&(e instanceof Int8Array||U in e?(i.setInt8(t,a),t+=1):e instanceof Uint8Array||R in e?(i.setUint8(t,a),t+=1):e instanceof Int16Array||v in e?(i.setInt16(t,a),t+=2):e instanceof Uint16Array||D in e?(i.setUint16(t,a),t+=2):e instanceof Int32Array||z in e?(i.setInt32(t,a),t+=4):e instanceof Uint32Array||f in e?(i.setUint32(t,a),t+=4):e instanceof Float32Array||C in e?(i.setFloat32(t,a),t+=4):(i.setFloat64(t,a),t+=8))}}return t}function ie(n,r,i,t){if(!n)return t;if(Array.isArray(n))return n[r]=i.getFloat64(t),t+8;if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s];e instanceof Int8Array||U in e?(e[r]=i.getInt8(t),t+=1):e instanceof Uint8Array||R in e?(e[r]=i.getUint8(t),t+=1):e instanceof Int16Array||v in e?(e[r]=i.getInt16(t),t+=2):e instanceof Uint16Array||D in e?(e[r]=i.getUint16(t),t+=2):e instanceof Int32Array||z in e?(e[r]=i.getInt32(t),t+=4):e instanceof Uint32Array||f in e?(e[r]=i.getUint32(t),t+=4):e instanceof Float32Array||C in e?(e[r]=i.getFloat32(t),t+=4):(e[r]=i.getFloat64(t),t+=8)}}return t}var J=(n,r,i=new ArrayBuffer(1024*1024*100))=>{let t=new DataView(i),o=0,s=a=>{let l=a.length;t.setUint32(o,l),o+=4;for(let y=0;y<l;y++){let u=a[y],p=0;t.setUint32(o,u),o+=4;let b=o;o+=1;for(let m=0;m<r.length;m++){let I=r[m];if((0,g.isRelation)(I)){let A=(0,g.getRelationTargets)(n,u,I);for(let d of A){t.setUint8(o,m),o+=1,t.setUint32(o,d),o+=4;let S=I(d);o=re(S,u,t,o),p++}}else(0,g.hasComponent)(n,u,I)&&(t.setUint8(o,m),o+=1,p++)}t.setUint8(b,p)}},e=a=>{let y=O(r,i.slice(o))(a);new Uint8Array(i).set(new Uint8Array(y),o),o+=y.byteLength};return()=>{o=0;let a=(0,g.getAllEntities)(n);return s(a),e(a),i.slice(0,o)}},K=(n,r,i)=>{let t=i||new Map,o=x(r);return(s,e)=>{let a=e||t,l=new DataView(s),y=0,u=l.getUint32(y);y+=4;for(let p=0;p<u;p++){let b=l.getUint32(y);y+=4;let m=a.get(b);m===void 0&&(m=(0,g.addEntity)(n),a.set(b,m));let I=l.getUint8(y);y+=1;for(let A=0;A<I;A++){let d=l.getUint8(y);y+=1;let S=r[d];if((0,g.isRelation)(S)){let T=l.getUint32(y);y+=4;let E=a.get(T);E===void 0&&(E=(0,g.addEntity)(n),a.set(T,E));let B=S(E);(0,g.addComponent)(n,m,B),y=ie(B,m,l,y)}else(0,g.addComponent)(n,m,S)}}return o(s.slice(y),a),a}};var c=require("bitecs");function oe(n,r,i,t){if(!n)return t;if(Array.isArray(n)){let o=n[r];return o!==void 0?(i.setFloat64(t,o),t+8):t}if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s],a=e[r];a!==void 0&&(e instanceof Int8Array||U in e?(i.setInt8(t,a),t+=1):e instanceof Uint8Array||R in e?(i.setUint8(t,a),t+=1):e instanceof Int16Array||v in e?(i.setInt16(t,a),t+=2):e instanceof Uint16Array||D in e?(i.setUint16(t,a),t+=2):e instanceof Int32Array||z in e?(i.setInt32(t,a),t+=4):e instanceof Uint32Array||f in e?(i.setUint32(t,a),t+=4):e instanceof Float32Array||C in e?(i.setFloat32(t,a),t+=4):(i.setFloat64(t,a),t+=8))}}return t}function ae(n,r,i,t){if(!n)return t;if(Array.isArray(n))return n[r]=i.getFloat64(t),t+8;if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s];e instanceof Int8Array||U in e?(e[r]=i.getInt8(t),t+=1):e instanceof Uint8Array||R in e?(e[r]=i.getUint8(t),t+=1):e instanceof Int16Array||v in e?(e[r]=i.getInt16(t),t+=2):e instanceof Uint16Array||D in e?(e[r]=i.getUint16(t),t+=2):e instanceof Int32Array||z in e?(e[r]=i.getInt32(t),t+=4):e instanceof Uint32Array||f in e?(e[r]=i.getUint32(t),t+=4):e instanceof Float32Array||C in e?(e[r]=i.getFloat32(t),t+=4):(e[r]=i.getFloat64(t),t+=8)}}return t}var N=(n,r,i,t=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(t),s=0,e=[],a=new Map;return(0,c.observe)(n,(0,c.onAdd)(r),l=>{e.push([l,0,-1])}),(0,c.observe)(n,(0,c.onRemove)(r),l=>{e.push([l,1,-1]),a.delete(l)}),i.forEach((l,y)=>{(0,c.isRelation)(l)?((0,c.observe)(n,(0,c.onAdd)(r,l(c.Wildcard)),u=>{let p=(0,c.getRelationTargets)(n,u,l);for(let b of p){a.has(u)||a.set(u,new Map),a.get(u).set(y,b);let m=l(b);e.push([u,4,y,b,m])}}),(0,c.observe)(n,(0,c.onRemove)(r,l(c.Wildcard)),u=>{let p=a.get(u);if(p){let b=p.get(y);b!==void 0&&(e.push([u,5,y,b]),p.delete(y),p.size===0&&a.delete(u))}})):((0,c.observe)(n,(0,c.onAdd)(r,l),u=>{e.push([u,2,y])}),(0,c.observe)(n,(0,c.onRemove)(r,l),u=>{e.push([u,3,y])}))}),()=>{s=0;for(let l=0;l<e.length;l++){let[y,u,p,b,m]=e[l];o.setUint32(s,y),s+=4,o.setUint8(s,u),s+=1,(u===2||u===3||u===4||u===5)&&(o.setUint8(s,p),s+=1,(u===4||u===5)&&(o.setUint32(s,b),s+=4,u===4&&m&&(s=oe(m,y,o,s))))}return e.length=0,t.slice(0,s)}},Q=(n,r,i,t)=>{let o=t||new Map;return(s,e)=>{let a=e||o,l=new DataView(s),y=0;for(;y<s.byteLength;){let u=l.getUint32(y);y+=4;let p=l.getUint8(y);y+=1;let b=-1,m=-1;(p===2||p===3||p===4||p===5)&&(b=l.getUint8(y),y+=1,(p===4||p===5)&&(m=l.getUint32(y),y+=4));let I=i[b],A=a.get(u);if(p===0)if(A===void 0)A=(0,c.addEntity)(n),a.set(u,A),(0,c.addComponent)(n,A,r);else throw new Error(`Entity with ID ${u} already exists in the mapping.`);else if(A!==void 0&&(0,c.entityExists)(n,A)){if(p===1)(0,c.removeEntity)(n,A);else if(p===2)(0,c.addComponent)(n,A,I);else if(p===3)(0,c.removeComponent)(n,A,I);else if(p===4){let d=a.get(m);if(d!==void 0){let S=I(d);(0,c.addComponent)(n,A,S),y=ae(S,A,l,y)}}else if(p===5){let d=a.get(m);d!==void 0&&(0,c.removeComponent)(n,A,I(d))}}}return a}};
//# sourceMappingURL=index.min.cjs.map
