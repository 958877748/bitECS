var $=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var Q=(e,n)=>{for(var o in n)$(e,o,{get:n[o],enumerable:!0})},X=(e,n,o,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of K(n))!N.call(e,i)&&i!==o&&$(e,i,{get:()=>n[i],enumerable:!(r=J(n,i))||r.enumerable});return e};var Y=e=>X($({},"__esModule",{value:!0}),e);var ne={};Q(ne,{createObserverDeserializer:()=>q,createObserverSerializer:()=>G,createSnapshotDeserializer:()=>L,createSnapshotSerializer:()=>k,createSoADeserializer:()=>E,createSoASerializer:()=>h,f32:()=>P,f64:()=>M,i16:()=>V,i32:()=>W,i8:()=>B,u16:()=>F,u32:()=>j,u8:()=>T});module.exports=Y(ne);var d=Symbol("u8"),R=Symbol("i8"),v=Symbol("u16"),U=Symbol("i16"),A=Symbol("u32"),D=Symbol("i32"),I=Symbol("f32"),C=Symbol("f64"),z=e=>(n=[])=>Object.defineProperty(n,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),T=z(d),B=z(R),F=z(v),V=z(U),j=z(A),W=z(D),P=z(I),M=z(C),x={[d]:(e,n,o)=>(e.setUint8(n,o),1),[R]:(e,n,o)=>(e.setInt8(n,o),1),[v]:(e,n,o)=>(e.setUint16(n,o),2),[U]:(e,n,o)=>(e.setInt16(n,o),2),[A]:(e,n,o)=>(e.setUint32(n,o),4),[D]:(e,n,o)=>(e.setInt32(n,o),4),[I]:(e,n,o)=>(e.setFloat32(n,o),4),[C]:(e,n,o)=>(e.setFloat64(n,o),8)},w={[d]:(e,n)=>({value:e.getUint8(n),size:1}),[R]:(e,n)=>({value:e.getInt8(n),size:1}),[v]:(e,n)=>({value:e.getUint16(n),size:2}),[U]:(e,n)=>({value:e.getInt16(n),size:2}),[A]:(e,n)=>({value:e.getUint32(n),size:4}),[D]:(e,n)=>({value:e.getInt32(n),size:4}),[I]:(e,n)=>({value:e.getFloat32(n),size:4}),[C]:(e,n)=>({value:e.getFloat64(n),size:8})},Z=e=>{let n=Object.keys(e),r=n.map(i=>{let a=e[i];for(let t of[d,R,v,U,A,D,I,C])if(t in a)return t;return C}).map(i=>x[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,a,t)=>{let l=0;l+=x[A](i,a+l,t);for(let s=0;s<n.length;s++)l+=r[s](i,a+l,e[n[s]][t]);return l}},_=e=>{let n=Object.keys(e),r=n.map(i=>{let a=e[i];for(let t of[d,R,v,U,A,D,I,C])if(t in a)return t;return C}).map(i=>w[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,a,t)=>{let l=0,{value:s,size:p}=w[A](i,a+l);l+=p;let u=t?t.get(s)??s:s;for(let c=0;c<n.length;c++){let{value:m,size:f}=r[c](i,a+l);e[n[c]][u]=m,l+=f}return l}},h=(e,n=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(n),r=e.map(Z);return i=>{let a=0;for(let t=0;t<i.length;t++){let l=i[t];for(let s=0;s<r.length;s++)a+=r[s](o,a,l)}return n.slice(0,a)}},E=e=>{let n=e.map(_);return(o,r)=>{let i=new DataView(o),a=0;for(;a<o.byteLength;)for(let t=0;t<n.length;t++)a+=n[t](i,a,r)}};var b=require("bitecs"),k=(e,n,o=new ArrayBuffer(1024*1024*100))=>{let r=new DataView(o),i=0,a=l=>{let s=l.length;r.setUint32(i,s),i+=4;for(let p=0;p<s;p++){let u=l[p],c=0;r.setUint32(i,u),i+=4;let m=i;i+=1;for(let f=0;f<n.length;f++){let g=n[f];if((0,b.isRelation)(g)){let S=(0,b.getRelationTargets)(e,u,g);for(let O of S)r.setUint8(i,f),i+=1,r.setUint32(i,O),i+=4,c++}else(0,b.hasComponent)(e,u,g)&&(r.setUint8(i,f),i+=1,c++)}r.setUint8(m,c)}},t=l=>{let p=h(n,o.slice(i))(l);new Uint8Array(o).set(new Uint8Array(p),i),i+=p.byteLength};return()=>{i=0;let l=(0,b.getAllEntities)(e);return a(l),t(l),o.slice(0,i)}},L=(e,n)=>{let o=E(n);return r=>{let i=new DataView(r),a=0,t=new Map,l=i.getUint32(a);a+=4;for(let s=0;s<l;s++){let p=i.getUint32(a);a+=4;let u=(0,b.addEntity)(e);t.set(p,u);let c=i.getUint8(a);a+=1;for(let m=0;m<c;m++){let f=i.getUint8(a);a+=1;let g=n[f];if((0,b.isRelation)(g)){let S=i.getUint32(a);if(a+=4,!t.has(S)){let H=(0,b.addEntity)(e);t.set(S,H)}let O=t.get(S);(0,b.addComponent)(e,u,g(O))}else(0,b.addComponent)(e,u,g)}}return o(r.slice(a),t),t}};var y=require("bitecs");function ee(e,n,o,r){if(!e)return r;if(Array.isArray(e)){let i=e[n];return i!==void 0?(o.setFloat64(r,i),r+8):r}if(typeof e=="object"){let i=Object.keys(e).sort();for(let a of i){let t=e[a],l=t[n];l!==void 0&&(t instanceof Int8Array||R in t?(o.setInt8(r,l),r+=1):t instanceof Uint8Array||d in t?(o.setUint8(r,l),r+=1):t instanceof Int16Array||U in t?(o.setInt16(r,l),r+=2):t instanceof Uint16Array||v in t?(o.setUint16(r,l),r+=2):t instanceof Int32Array||D in t?(o.setInt32(r,l),r+=4):t instanceof Uint32Array||A in t?(o.setUint32(r,l),r+=4):t instanceof Float32Array||I in t?(o.setFloat32(r,l),r+=4):(o.setFloat64(r,l),r+=8))}}return r}function te(e,n,o,r){if(!e)return r;if(Array.isArray(e))return e[n]=o.getFloat64(r),r+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let a of i){let t=e[a];t instanceof Int8Array||R in t?(t[n]=o.getInt8(r),r+=1):t instanceof Uint8Array||d in t?(t[n]=o.getUint8(r),r+=1):t instanceof Int16Array||U in t?(t[n]=o.getInt16(r),r+=2):t instanceof Uint16Array||v in t?(t[n]=o.getUint16(r),r+=2):t instanceof Int32Array||D in t?(t[n]=o.getInt32(r),r+=4):t instanceof Uint32Array||A in t?(t[n]=o.getUint32(r),r+=4):t instanceof Float32Array||I in t?(t[n]=o.getFloat32(r),r+=4):(t[n]=o.getFloat64(r),r+=8)}}return r}var G=(e,n,o,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),a=0,t=[],l=new Map;return(0,y.observe)(e,(0,y.onAdd)(n),s=>{t.push([s,0,-1])}),(0,y.observe)(e,(0,y.onRemove)(n),s=>{t.push([s,1,-1]),l.delete(s)}),o.forEach((s,p)=>{(0,y.isRelation)(s)?((0,y.observe)(e,(0,y.onAdd)(n,s(y.Wildcard)),u=>{let c=(0,y.getRelationTargets)(e,u,s);for(let m of c){l.has(u)||l.set(u,new Map),l.get(u).set(p,m);let f=s(m);t.push([u,4,p,m,f])}}),(0,y.observe)(e,(0,y.onRemove)(n,s(y.Wildcard)),u=>{let c=l.get(u);if(c){let m=c.get(p);m!==void 0&&(t.push([u,5,p,m]),c.delete(p),c.size===0&&l.delete(u))}})):((0,y.observe)(e,(0,y.onAdd)(n,s),u=>{t.push([u,2,p])}),(0,y.observe)(e,(0,y.onRemove)(n,s),u=>{t.push([u,3,p])}))}),()=>{a=0;for(let s=0;s<t.length;s++){let[p,u,c,m,f]=t[s];i.setUint32(a,p),a+=4,i.setUint8(a,u),a+=1,(u===2||u===3||u===4||u===5)&&(i.setUint8(a,c),a+=1,(u===4||u===5)&&(i.setUint32(a,m),a+=4,u===4&&f&&(a=ee(f,p,i,a))))}return t.length=0,r.slice(0,a)}},q=(e,n,o,r=new Map)=>i=>{let a=new DataView(i),t=0;for(;t<i.byteLength;){let l=a.getUint32(t);t+=4;let s=a.getUint8(t);t+=1;let p=-1,u=-1;(s===2||s===3||s===4||s===5)&&(p=a.getUint8(t),t+=1,(s===4||s===5)&&(u=a.getUint32(t),t+=4));let c=o[p],m=r.get(l);if(s===0)if(m===void 0)m=(0,y.addEntity)(e),r.set(l,m),(0,y.addComponent)(e,m,n);else throw new Error(`Entity with ID ${l} already exists in the mapping.`);else if(m!==void 0&&(0,y.entityExists)(e,m)){if(s===1)(0,y.removeEntity)(e,m);else if(s===2)(0,y.addComponent)(e,m,c);else if(s===3)(0,y.removeComponent)(e,m,c);else if(s===4){let f=r.get(u);if(f!==void 0){let g=c(f);(0,y.addComponent)(e,m,g),t=te(g,m,a,t)}}else if(s===5){let f=r.get(u);f!==void 0&&(0,y.removeComponent)(e,m,c(f))}}}return r};
//# sourceMappingURL=index.min.cjs.map
