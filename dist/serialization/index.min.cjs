var q=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var be=Object.prototype.hasOwnProperty;var Ae=(e,t)=>{for(var r in t)q(e,r,{get:t[r],enumerable:!0})},ge=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of fe(t))!be.call(e,s)&&s!==r&&q(e,s,{get:()=>t[s],enumerable:!(n=me(t,s))||n.enumerable});return e};var de=e=>ge(q({},"__esModule",{value:!0}),e);var Be={};Ae(Be,{$f32:()=>R,$f64:()=>$,$i16:()=>U,$i32:()=>C,$i8:()=>I,$str:()=>V,$u16:()=>h,$u32:()=>A,$u8:()=>T,array:()=>re,createAoSDeserializer:()=>ye,createAoSSerializer:()=>se,createObserverDeserializer:()=>pe,createObserverSerializer:()=>ce,createSnapshotDeserializer:()=>ue,createSnapshotSerializer:()=>le,createSoADeserializer:()=>L,createSoASerializer:()=>G,f32:()=>W,f64:()=>Z,i16:()=>Q,i32:()=>Y,i8:()=>J,str:()=>_,u16:()=>K,u32:()=>X,u8:()=>H});module.exports=de(Be);var T=Symbol.for("bitecs-u8"),I=Symbol.for("bitecs-i8"),h=Symbol.for("bitecs-u16"),U=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),C=Symbol.for("bitecs-i32"),R=Symbol.for("bitecs-f32"),$=Symbol.for("bitecs-f64"),V=Symbol.for("bitecs-str"),w=Symbol.for("bitecs-arr"),F=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),H=F(T),J=F(I),K=F(h),Q=F(U),X=F(A),Y=F(C),W=F(R),Z=F($),_=F(V),Se=new Map([[H,T],[J,I],[K,h],[Q,U],[X,A],[Y,C],[W,R],[Z,$],[_,V]]),S={[T]:(e,t,r)=>(e.setUint8(t,r),1),[I]:(e,t,r)=>(e.setInt8(t,r),1),[h]:(e,t,r)=>(e.setUint16(t,r),2),[U]:(e,t,r)=>(e.setInt16(t,r),2),[A]:(e,t,r)=>(e.setUint32(t,r),4),[C]:(e,t,r)=>(e.setInt32(t,r),4),[R]:(e,t,r)=>(e.setFloat32(t,r),4),[$]:(e,t,r)=>(e.setFloat64(t,r),8),[V]:(e,t,r)=>{let s=ze.encode(r),y=0;return y+=S[A](e,t+y,s.length),new Uint8Array(e.buffer,e.byteOffset+t+y,s.length).set(s),y+=s.length,y}},z={[T]:(e,t)=>({value:e.getUint8(t),size:1}),[I]:(e,t)=>({value:e.getInt8(t),size:1}),[h]:(e,t)=>({value:e.getUint16(t),size:2}),[U]:(e,t)=>({value:e.getInt16(t),size:2}),[A]:(e,t)=>({value:e.getUint32(t),size:4}),[C]:(e,t)=>({value:e.getInt32(t),size:4}),[R]:(e,t)=>({value:e.getFloat32(t),size:4}),[$]:(e,t)=>({value:e.getFloat64(t),size:8}),[V]:(e,t)=>{let{value:r,size:n}=z[A](e,t),s=new Uint8Array(e.buffer,e.byteOffset+t+n,r);return{value:Te.decode(s),size:n+r}}};function N(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let t=Se.get(e);if(t)return t;throw new Error(`Unknown type function: ${e}`)}return E(e)?N(e[w]):R}var ze=new TextEncoder,Te=new TextDecoder,re=(e=W)=>{let t=[];return Object.defineProperty(t,w,{value:e,enumerable:!1,writable:!1,configurable:!1}),t};function M(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function O(e){if(E(e))return N(e[w]);for(let t of[T,I,h,U,A,C,R,$,V])if(t in e)return t;return e instanceof Int8Array?I:e instanceof Uint8Array?T:e instanceof Int16Array?U:e instanceof Uint16Array?h:e instanceof Int32Array?C:e instanceof Uint32Array?A:e instanceof Float32Array?R:$}function E(e){return Array.isArray(e)&&w in e}function x(e){return e[w]}function P(e,t,r,n){let s=0,y=Array.isArray(t)?1:0;if(s+=S[T](r,n,y),!y)return s;s+=S[A](r,n+s,t.length);for(let i=0;i<t.length;i++){let a=t[i];if(E(e))s+=P(x(e),a,r,n+s);else{let o=N(e);s+=S[o](r,n+s,a)}}return s}function k(e,t,r){let n=0,s=z[T](t,r+n);if(n+=s.size,!s.value)return{size:n};let y=z[A](t,r+n);n+=y.size;let i=new Array(y.value);for(let a=0;a<i.length;a++)if(E(e)){let{value:o,size:l}=k(x(e),t,r+n);n+=l,Array.isArray(o)&&(i[a]=o)}else{let o=N(e),{value:l,size:u}=z[o](t,r+n);n+=u,i[a]=l}return{value:i,size:n}}var he=e=>{let t=O(e);return t===R||t===$},Re=(e,t)=>he(e)?t:0,De=(e,t)=>{let r=e.get(t);return r||(ArrayBuffer.isView(t)?r=new t.constructor(t.length):r=new Array(t.length).fill(0),e.set(t,r)),r},ne=(e,t,r,n=1e-4)=>{let s=De(e,t),y=t[r],i=Re(t,n),a=i>0?Math.abs(s[r]-y)>i:s[r]!==y;return s[r]=y,a},ve=(e,t=!1,r,n=1e-4)=>{if(M(e)){let a=O(e),o=S[a];return(l,u,c,p)=>{if(t&&r){if(!ne(r,e,c,n))return 0;let m=0;return m+=S[A](l,u+m,c),m+=S[A](l,u+m,p),m+=o(l,u+m,e[c]),m}else{let m=0;return m+=S[A](l,u+m,c),m+=o(l,u+m,e[c]),m}}}let s=Object.keys(e),i=s.map(a=>{let o=e[a];if(!M(o))throw new Error(`Invalid array type for property ${a}`);return O(o)}).map(a=>S[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,o,l,u)=>{if(t&&r){let c=0;for(let f=0;f<s.length;f++){let b=e[s[f]];ne(r,b,l,n)&&(c|=1<<f)}if(c===0)return 0;let p=0;p+=S[A](a,o+p,l),p+=S[A](a,o+p,u);let m=s.length<=8?S[T]:s.length<=16?S[h]:S[A];p+=m(a,o+p,c);for(let f=0;f<s.length;f++)if(c&1<<f){let b=e[s[f]];E(b)?p+=P(x(b),b[l],a,o+p):p+=i[f](a,o+p,b[l])}return p}else{let c=0;c+=S[A](a,o+c,l);for(let p=0;p<s.length;p++){let m=e[s[p]];E(m)?c+=P(x(m),m[l],a,o+c):c+=i[p](a,o+c,m[l])}return c}}},Ie=(e,t=!1)=>{if(M(e)){let y=O(e),i=z[y];return(a,o,l)=>{let u=0,{value:c,size:p}=z[A](a,o);u+=p;let m=l?l.get(c)??c:c;if(t){let{size:d}=z[A](a,o+u);u+=d}let{value:f,size:b}=i(a,o+u);return e[m]=f,u+b}}let r=Object.keys(e),s=r.map(y=>{let i=e[y];if(!M(i))throw new Error(`Invalid array type for property ${y}`);return O(i)}).map(y=>z[y]||(()=>{throw new Error("Unsupported or unannotated type")}));return(y,i,a)=>{let o=0,{value:l,size:u}=z[A](y,i+o);o+=u;let c=a?a.get(l)??l:l;if(t){let{size:p}=z[A](y,i+o);o+=p;let m=r.length<=8?z[T]:r.length<=16?z[h]:z[A],{value:f,size:b}=m(y,i+o);o+=b;for(let d=0;d<r.length;d++)if(f&1<<d){let v=e[r[d]];if(E(v)){let{value:j,size:B}=k(x(v),y,i+o);Array.isArray(j)&&(v[c]=j),o+=B}else{let{value:j,size:B}=s[d](y,i+o);e[r[d]][c]=j,o+=B}}}else for(let p=0;p<r.length;p++){let m=e[r[p]];if(E(m)){let{value:f,size:b}=k(x(m),y,i+o);Array.isArray(f)&&(m[c]=f),o+=b}else{let{value:f,size:b}=s[p](y,i+o);e[r[p]][c]=f,o+=b}}return o}},G=(e,t={})=>{let{diff:r=!1,buffer:n=new ArrayBuffer(1024*1024*100),epsilon:s=1e-4}=t,y=new DataView(n),i=r?new Map:void 0,a=e.map(o=>ve(o,r,i,s));return o=>{let l=0;for(let u=0;u<o.length;u++){let c=o[u];for(let p=0;p<a.length;p++)l+=a[p](y,l,c,p)}return n.slice(0,l)}},L=(e,t={})=>{let{diff:r=!1}=t,n=e.map(s=>Ie(s,r));return(s,y)=>{let i=new DataView(s),a=0;for(;a<s.byteLength;)if(r){let{value:o,size:l}=z[A](i,a),{value:u,size:c}=z[A](i,a+l);a+=n[u](i,a,y)}else for(let o=0;o<n.length;o++)a+=n[o](i,a,y)}};var Ue=e=>{let t=O(e);return t===R||t===$},ie=(e,t)=>Ue(e)?t:0,oe=(e,t)=>{let r=e.get(t);return r||(r=[],e.set(t,r)),r},ee=(e,t,r,n)=>{let s=oe(e,t),y=t[r],i=s[r];if(y===void 0)return!1;if(i===void 0)return!0;if(typeof y=="object"&&y!==null){let a=t;for(let o in y)if(a[o]){let l=ie(a[o],n);if(l>0?Math.abs(i[o]-y[o])>l:i[o]!==y[o])return!0}return!1}else{let a=ie(t,n);return a>0?Math.abs(i-y)>a:i!==y}},ae=(e,t,r)=>{let n=oe(e,t),s=t[r];typeof s=="object"&&s!==null?n[r]={...s}:n[r]=s},Ce=(e,t,r,n=1e-4)=>{if(typeof e=="object"&&Object.keys(e).some(y=>isNaN(parseInt(y))&&typeof e[y]=="object")){let y=Object.keys(e).filter(o=>isNaN(parseInt(o))),a=y.map(o=>O(e[o])).map(o=>S[o]);return(o,l,u)=>{let c=e[u];if(c===void 0)return 0;if(t&&r){if(!ee(r,e,u,n))return 0;ae(r,e,u)}let p=0;for(let m=0;m<y.length;m++){let f=e[y[m]],b=c[y[m]];E(f)?p+=P(x(f),b,o,l+p):p+=a[m](o,l+p,b)}return p}}else{let y=O(e),i=S[y];return(a,o,l)=>{let u=e[l];if(u===void 0)return 0;if(t&&r){if(!ee(r,e,l,n))return 0;ae(r,e,l)}return i(a,o,u)}}},$e=e=>{if(typeof e=="object"&&Object.keys(e).some(r=>isNaN(parseInt(r))&&typeof e[r]=="object")){let r=Object.keys(e).filter(y=>isNaN(parseInt(y))),s=r.map(y=>O(e[y])).map(y=>z[y]);return(y,i,a)=>{let o=0,l={};for(let u=0;u<r.length;u++){let c=e[r[u]];if(E(c)){let{value:p,size:m}=k(x(c),y,i+o);Array.isArray(p)&&(l[r[u]]=p),o+=m}else{let{value:p,size:m}=s[u](y,i+o);l[r[u]]=p,o+=m}}return e[a]=l,o}}else{let r=O(e),n=z[r];return(s,y,i)=>{let{value:a,size:o}=n(s,y);return e[i]=a,o}}},se=(e,t={})=>{let{diff:r=!1,buffer:n=new ArrayBuffer(1024*1024*100),epsilon:s=1e-4}=t,y=new DataView(n),i=r?new Map:void 0,a=e.map(o=>Ce(o,r,i,s));return o=>{let l=0;for(let u=0;u<o.length;u++){let c=o[u];if(r){let p=!1;for(let d=0;d<e.length;d++)if(i&&ee(i,e[d],c,s)){p=!0;break}if(!p)continue;l+=S[A](y,l,c);let m=l,f=e.length<=8?S[T]:e.length<=16?S[h]:S[A];l+=f===S[T]?1:f===S[h]?2:4;let b=0;for(let d=0;d<a.length;d++){let v=a[d](y,l,c);v>0&&(b|=1<<d,l+=v)}f(y,m,b)}else{l+=S[A](y,l,c);for(let p=0;p<a.length;p++)l+=a[p](y,l,c)}}return n.slice(0,l)}},ye=(e,t={})=>{let{diff:r=!1}=t,n=e.map(s=>$e(s));return(s,y)=>{let i=new DataView(s),a=0;for(;a<s.byteLength;){let{value:o,size:l}=z[A](i,a);a+=l;let u=y?y.get(o)??o:o;if(r){let c=e.length<=8?z[T]:e.length<=16?z[h]:z[A],{value:p,size:m}=c(i,a);a+=m;for(let f=0;f<e.length;f++)p&1<<f&&(a+=n[f](i,a,u))}else for(let c=0;c<n.length;c++)a+=n[c](i,a,u)}}};var D=require("bitecs");function Oe(e,t,r,n){if(!e)return n;if(Array.isArray(e)){let s=e[t];return s!==void 0?(r.setFloat64(n,s),n+8):n}if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let i=e[y],a=i[t];a!==void 0&&(i instanceof Int8Array||I in i?(r.setInt8(n,a),n+=1):i instanceof Uint8Array||T in i?(r.setUint8(n,a),n+=1):i instanceof Int16Array||U in i?(r.setInt16(n,a),n+=2):i instanceof Uint16Array||h in i?(r.setUint16(n,a),n+=2):i instanceof Int32Array||C in i?(r.setInt32(n,a),n+=4):i instanceof Uint32Array||A in i?(r.setUint32(n,a),n+=4):i instanceof Float32Array||R in i?(r.setFloat32(n,a),n+=4):(r.setFloat64(n,a),n+=8))}}return n}function Ee(e,t,r,n){if(!e)return n;if(Array.isArray(e))return e[t]=r.getFloat64(n),n+8;if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let i=e[y];i instanceof Int8Array||I in i?(i[t]=r.getInt8(n),n+=1):i instanceof Uint8Array||T in i?(i[t]=r.getUint8(n),n+=1):i instanceof Int16Array||U in i?(i[t]=r.getInt16(n),n+=2):i instanceof Uint16Array||h in i?(i[t]=r.getUint16(n),n+=2):i instanceof Int32Array||C in i?(i[t]=r.getInt32(n),n+=4):i instanceof Uint32Array||A in i?(i[t]=r.getUint32(n),n+=4):i instanceof Float32Array||R in i?(i[t]=r.getFloat32(n),n+=4):(i[t]=r.getFloat64(n),n+=8)}}return n}var le=(e,t,r=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(r),s=0,y=a=>{let o=a.length;n.setUint32(s,o),s+=4;for(let l=0;l<o;l++){let u=a[l],c=0;n.setUint32(s,u),s+=4;let p=s;s+=1;for(let m=0;m<t.length;m++){let f=t[m];if((0,D.isRelation)(f)){let b=(0,D.getRelationTargets)(e,u,f);for(let d of b){n.setUint8(s,m),s+=1,n.setUint32(s,d),s+=4;let v=f(d);s=Oe(v,u,n,s),c++}}else(0,D.hasComponent)(e,u,f)&&(n.setUint8(s,m),s+=1,c++)}n.setUint8(p,c)}},i=a=>{let l=G(t,{buffer:r.slice(s)})(a);new Uint8Array(r).set(new Uint8Array(l),s),s+=l.byteLength};return()=>{s=0;let a=(0,D.getAllEntities)(e);return y(a),i(a),r.slice(0,s)}},ue=(e,t,r)=>{let n=r||new Map,s=L(t);return(y,i)=>{let a=i||n,o=new DataView(y),l=0,u=o.getUint32(l);l+=4;for(let c=0;c<u;c++){let p=o.getUint32(l);l+=4;let m=a.get(p);m===void 0&&(m=(0,D.addEntity)(e),a.set(p,m));let f=o.getUint8(l);l+=1;for(let b=0;b<f;b++){let d=o.getUint8(l);l+=1;let v=t[d];if((0,D.isRelation)(v)){let j=o.getUint32(l);l+=4;let B=a.get(j);B===void 0&&(B=(0,D.addEntity)(e),a.set(j,B));let te=v(B);(0,D.addComponent)(e,m,te),l=Ee(te,m,o,l)}else(0,D.addComponent)(e,m,v)}}return s(y.slice(l),a),a}};var g=require("bitecs");function xe(e,t,r,n){if(!e)return n;if(Array.isArray(e)){let s=e[t];return s!==void 0?(r.setFloat64(n,s),n+8):n}if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let i=e[y],a=i[t];a!==void 0&&(i instanceof Int8Array||I in i?(r.setInt8(n,a),n+=1):i instanceof Uint8Array||T in i?(r.setUint8(n,a),n+=1):i instanceof Int16Array||U in i?(r.setInt16(n,a),n+=2):i instanceof Uint16Array||h in i?(r.setUint16(n,a),n+=2):i instanceof Int32Array||C in i?(r.setInt32(n,a),n+=4):i instanceof Uint32Array||A in i?(r.setUint32(n,a),n+=4):i instanceof Float32Array||R in i?(r.setFloat32(n,a),n+=4):(r.setFloat64(n,a),n+=8))}}return n}function Fe(e,t,r,n){if(!e)return n;if(Array.isArray(e))return e[t]=r.getFloat64(n),n+8;if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let i=e[y];i instanceof Int8Array||I in i?(i[t]=r.getInt8(n),n+=1):i instanceof Uint8Array||T in i?(i[t]=r.getUint8(n),n+=1):i instanceof Int16Array||U in i?(i[t]=r.getInt16(n),n+=2):i instanceof Uint16Array||h in i?(i[t]=r.getUint16(n),n+=2):i instanceof Int32Array||C in i?(i[t]=r.getInt32(n),n+=4):i instanceof Uint32Array||A in i?(i[t]=r.getUint32(n),n+=4):i instanceof Float32Array||R in i?(i[t]=r.getFloat32(n),n+=4):(i[t]=r.getFloat64(n),n+=8)}}return n}var ce=(e,t,r,n=new ArrayBuffer(1024*1024*100))=>{let s=new DataView(n),y=0,i=[],a=new Map;return(0,g.observe)(e,(0,g.onAdd)(t),o=>{i.push([o,0,-1])}),(0,g.observe)(e,(0,g.onRemove)(t),o=>{i.push([o,1,-1]),a.delete(o)}),r.forEach((o,l)=>{(0,g.isRelation)(o)?((0,g.observe)(e,(0,g.onAdd)(t,o(g.Wildcard)),u=>{let c=(0,g.getRelationTargets)(e,u,o);for(let p of c){a.has(u)||a.set(u,new Map),a.get(u).set(l,p);let m=o(p);i.push([u,4,l,p,m])}}),(0,g.observe)(e,(0,g.onRemove)(t,o(g.Wildcard)),u=>{let c=a.get(u);if(c){let p=c.get(l);p!==void 0&&(i.push([u,5,l,p]),c.delete(l),c.size===0&&a.delete(u))}})):((0,g.observe)(e,(0,g.onAdd)(t,o),u=>{i.push([u,2,l])}),(0,g.observe)(e,(0,g.onRemove)(t,o),u=>{i.push([u,3,l])}))}),()=>{y=0;for(let o=0;o<i.length;o++){let[l,u,c,p,m]=i[o];s.setUint32(y,l),y+=4,s.setUint8(y,u),y+=1,(u===2||u===3||u===4||u===5)&&(s.setUint8(y,c),y+=1,(u===4||u===5)&&(s.setUint32(y,p),y+=4,u===4&&m&&(y=xe(m,l,s,y))))}return i.length=0,n.slice(0,y)}},pe=(e,t,r,n)=>{let s=n||new Map;return(y,i)=>{let a=i||s,o=new DataView(y),l=0;for(;l<y.byteLength;){let u=o.getUint32(l);l+=4;let c=o.getUint8(l);l+=1;let p=-1,m=-1;(c===2||c===3||c===4||c===5)&&(p=o.getUint8(l),l+=1,(c===4||c===5)&&(m=o.getUint32(l),l+=4));let f=r[p],b=a.get(u);if(c===0)b===void 0?(b=(0,g.addEntity)(e),a.set(u,b),(0,g.addComponent)(e,b,t)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(b!==void 0&&(0,g.entityExists)(e,b)){if(c===1)(0,g.removeEntity)(e,b),a.delete(u);else if(c===2)(0,g.addComponent)(e,b,f);else if(c===3)(0,g.removeComponent)(e,b,f);else if(c===4){let d=a.get(m);if(d!==void 0){let v=f(d);(0,g.addComponent)(e,b,v),l=Fe(v,b,o,l)}}else if(c===5){let d=a.get(m);d!==void 0&&(0,g.removeComponent)(e,b,f(d))}}}return a}};
//# sourceMappingURL=index.min.cjs.map
