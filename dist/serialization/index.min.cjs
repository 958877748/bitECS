var P=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var ne=(e,r)=>{for(var o in r)P(e,o,{get:r[o],enumerable:!0})},re=(e,r,o,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ee(r))!te.call(e,i)&&i!==o&&P(e,i,{get:()=>r[i],enumerable:!(n=_(r,i))||n.enumerable});return e};var ie=e=>re(P({},"__esModule",{value:!0}),e);var ce={};ne(ce,{$f32:()=>U,$f64:()=>E,$i16:()=>z,$i32:()=>S,$i8:()=>v,$u16:()=>D,$u32:()=>f,$u8:()=>R,array:()=>N,createObserverDeserializer:()=>Z,createObserverSerializer:()=>Y,createSnapshotDeserializer:()=>X,createSnapshotSerializer:()=>Q,createSoADeserializer:()=>M,createSoASerializer:()=>j,f32:()=>J,f64:()=>K,i16:()=>q,i32:()=>H,i8:()=>L,u16:()=>V,u32:()=>G,u8:()=>w});module.exports=ie(ce);var R=Symbol.for("bitecs-u8"),v=Symbol.for("bitecs-i8"),D=Symbol.for("bitecs-u16"),z=Symbol.for("bitecs-i16"),f=Symbol.for("bitecs-u32"),S=Symbol.for("bitecs-i32"),U=Symbol.for("bitecs-f32"),E=Symbol.for("bitecs-f64"),k=Symbol.for("bitecs-arr"),h=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),w=h(R),L=h(v),V=h(D),q=h(z),G=h(f),H=h(S),J=h(U),K=h(E),T={[R]:(e,r,o)=>(e.setUint8(r,o),1),[v]:(e,r,o)=>(e.setInt8(r,o),1),[D]:(e,r,o)=>(e.setUint16(r,o),2),[z]:(e,r,o)=>(e.setInt16(r,o),2),[f]:(e,r,o)=>(e.setUint32(r,o),4),[S]:(e,r,o)=>(e.setInt32(r,o),4),[U]:(e,r,o)=>(e.setFloat32(r,o),4),[E]:(e,r,o)=>(e.setFloat64(r,o),8)},C={[R]:(e,r)=>({value:e.getUint8(r),size:1}),[v]:(e,r)=>({value:e.getInt8(r),size:1}),[D]:(e,r)=>({value:e.getUint16(r),size:2}),[z]:(e,r)=>({value:e.getInt16(r),size:2}),[f]:(e,r)=>({value:e.getUint32(r),size:4}),[S]:(e,r)=>({value:e.getInt32(r),size:4}),[U]:(e,r)=>({value:e.getFloat32(r),size:4}),[E]:(e,r)=>({value:e.getFloat64(r),size:8})},N=(e=U)=>{let r=[];return Object.defineProperty(r,k,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function B(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function F(e){for(let r of[R,v,D,z,f,S,U,E])if(r in e)return r;return e instanceof Int8Array?v:e instanceof Uint8Array?R:e instanceof Int16Array?z:e instanceof Uint16Array?D:e instanceof Int32Array?S:e instanceof Uint32Array?f:e instanceof Float32Array?U:E}var ae=e=>{if(B(e)){let i=F(e),s=T[i];return(t,a,l)=>{let y=0;return y+=T[f](t,a,l),y+=s(t,a+y,e[l]),y}}let r=Object.keys(e),n=r.map(i=>{let s=e[i];if(!B(s))throw new Error(`Invalid array type for property ${i}`);return F(s)}).map(i=>T[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,s,t)=>{let a=0;a+=T[f](i,s+a,t);for(let l=0;l<r.length;l++){let y=e[r[l]][k],u=e[r[l]][t];if(y===void 0){a+=n[l](i,s+a,u);continue}let c=Array.isArray(u);if(a+=T[R](i,s+a,c?1:0),!c)continue;let b=u,m=b.length;a+=T[f](i,s+a,m);for(let g=0;g<m;g++)a+=T[y](i,s+a,b[g])}return a}},oe=e=>{if(B(e)){let i=F(e),s=C[i];return(t,a,l)=>{let y=0,{value:u,size:c}=C[f](t,a);y+=c;let b=l?l.get(u)??u:u,{value:m,size:g}=s(t,a+y);return e[b]=m,y+g}}let r=Object.keys(e),n=r.map(i=>{let s=e[i];if(!B(s))throw new Error(`Invalid array type for property ${i}`);return F(s)}).map(i=>C[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,s,t)=>{let a=0,{value:l,size:y}=C[f](i,s+a);a+=y;let u=t?t.get(l)??l:l;for(let c=0;c<r.length;c++){let b=e[r[c]][k];if(b===void 0){let{value:d,size:$}=n[c](i,s+a);e[r[c]][u]=d,a+=$;continue}let m=C[R](i,s+a);if(a+=m.size,!m.value)continue;let g=C[f](i,s+a);a+=g.size;let A=new Array(g.value);for(let d=0;d<A.length;d++){let{value:$,size:x}=C[b](i,s+a);a+=x,A[d]=$}e[r[c]][u]=A}return a}},j=(e,r=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(r),n=e.map(ae);return i=>{let s=0;for(let t=0;t<i.length;t++){let a=i[t];for(let l=0;l<n.length;l++)s+=n[l](o,s,a)}return r.slice(0,s)}},M=e=>{let r=e.map(oe);return(o,n)=>{let i=new DataView(o),s=0;for(;s<o.byteLength;)for(let t=0;t<r.length;t++)s+=r[t](i,s,n)}};var I=require("bitecs");function se(e,r,o,n){if(!e)return n;if(Array.isArray(e)){let i=e[r];return i!==void 0?(o.setFloat64(n,i),n+8):n}if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s],a=t[r];a!==void 0&&(t instanceof Int8Array||v in t?(o.setInt8(n,a),n+=1):t instanceof Uint8Array||R in t?(o.setUint8(n,a),n+=1):t instanceof Int16Array||z in t?(o.setInt16(n,a),n+=2):t instanceof Uint16Array||D in t?(o.setUint16(n,a),n+=2):t instanceof Int32Array||S in t?(o.setInt32(n,a),n+=4):t instanceof Uint32Array||f in t?(o.setUint32(n,a),n+=4):t instanceof Float32Array||U in t?(o.setFloat32(n,a),n+=4):(o.setFloat64(n,a),n+=8))}}return n}function ye(e,r,o,n){if(!e)return n;if(Array.isArray(e))return e[r]=o.getFloat64(n),n+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s];t instanceof Int8Array||v in t?(t[r]=o.getInt8(n),n+=1):t instanceof Uint8Array||R in t?(t[r]=o.getUint8(n),n+=1):t instanceof Int16Array||z in t?(t[r]=o.getInt16(n),n+=2):t instanceof Uint16Array||D in t?(t[r]=o.getUint16(n),n+=2):t instanceof Int32Array||S in t?(t[r]=o.getInt32(n),n+=4):t instanceof Uint32Array||f in t?(t[r]=o.getUint32(n),n+=4):t instanceof Float32Array||U in t?(t[r]=o.getFloat32(n),n+=4):(t[r]=o.getFloat64(n),n+=8)}}return n}var Q=(e,r,o=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(o),i=0,s=a=>{let l=a.length;n.setUint32(i,l),i+=4;for(let y=0;y<l;y++){let u=a[y],c=0;n.setUint32(i,u),i+=4;let b=i;i+=1;for(let m=0;m<r.length;m++){let g=r[m];if((0,I.isRelation)(g)){let A=(0,I.getRelationTargets)(e,u,g);for(let d of A){n.setUint8(i,m),i+=1,n.setUint32(i,d),i+=4;let $=g(d);i=se($,u,n,i),c++}}else(0,I.hasComponent)(e,u,g)&&(n.setUint8(i,m),i+=1,c++)}n.setUint8(b,c)}},t=a=>{let y=j(r,o.slice(i))(a);new Uint8Array(o).set(new Uint8Array(y),i),i+=y.byteLength};return()=>{i=0;let a=(0,I.getAllEntities)(e);return s(a),t(a),o.slice(0,i)}},X=(e,r,o)=>{let n=o||new Map,i=M(r);return(s,t)=>{let a=t||n,l=new DataView(s),y=0,u=l.getUint32(y);y+=4;for(let c=0;c<u;c++){let b=l.getUint32(y);y+=4;let m=a.get(b);m===void 0&&(m=(0,I.addEntity)(e),a.set(b,m));let g=l.getUint8(y);y+=1;for(let A=0;A<g;A++){let d=l.getUint8(y);y+=1;let $=r[d];if((0,I.isRelation)($)){let x=l.getUint32(y);y+=4;let O=a.get(x);O===void 0&&(O=(0,I.addEntity)(e),a.set(x,O));let W=$(O);(0,I.addComponent)(e,m,W),y=ye(W,m,l,y)}else(0,I.addComponent)(e,m,$)}}return i(s.slice(y),a),a}};var p=require("bitecs");function le(e,r,o,n){if(!e)return n;if(Array.isArray(e)){let i=e[r];return i!==void 0?(o.setFloat64(n,i),n+8):n}if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s],a=t[r];a!==void 0&&(t instanceof Int8Array||v in t?(o.setInt8(n,a),n+=1):t instanceof Uint8Array||R in t?(o.setUint8(n,a),n+=1):t instanceof Int16Array||z in t?(o.setInt16(n,a),n+=2):t instanceof Uint16Array||D in t?(o.setUint16(n,a),n+=2):t instanceof Int32Array||S in t?(o.setInt32(n,a),n+=4):t instanceof Uint32Array||f in t?(o.setUint32(n,a),n+=4):t instanceof Float32Array||U in t?(o.setFloat32(n,a),n+=4):(o.setFloat64(n,a),n+=8))}}return n}function ue(e,r,o,n){if(!e)return n;if(Array.isArray(e))return e[r]=o.getFloat64(n),n+8;if(typeof e=="object"){let i=Object.keys(e).sort();for(let s of i){let t=e[s];t instanceof Int8Array||v in t?(t[r]=o.getInt8(n),n+=1):t instanceof Uint8Array||R in t?(t[r]=o.getUint8(n),n+=1):t instanceof Int16Array||z in t?(t[r]=o.getInt16(n),n+=2):t instanceof Uint16Array||D in t?(t[r]=o.getUint16(n),n+=2):t instanceof Int32Array||S in t?(t[r]=o.getInt32(n),n+=4):t instanceof Uint32Array||f in t?(t[r]=o.getUint32(n),n+=4):t instanceof Float32Array||U in t?(t[r]=o.getFloat32(n),n+=4):(t[r]=o.getFloat64(n),n+=8)}}return n}var Y=(e,r,o,n=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(n),s=0,t=[],a=new Map;return(0,p.observe)(e,(0,p.onAdd)(r),l=>{t.push([l,0,-1])}),(0,p.observe)(e,(0,p.onRemove)(r),l=>{t.push([l,1,-1]),a.delete(l)}),o.forEach((l,y)=>{(0,p.isRelation)(l)?((0,p.observe)(e,(0,p.onAdd)(r,l(p.Wildcard)),u=>{let c=(0,p.getRelationTargets)(e,u,l);for(let b of c){a.has(u)||a.set(u,new Map),a.get(u).set(y,b);let m=l(b);t.push([u,4,y,b,m])}}),(0,p.observe)(e,(0,p.onRemove)(r,l(p.Wildcard)),u=>{let c=a.get(u);if(c){let b=c.get(y);b!==void 0&&(t.push([u,5,y,b]),c.delete(y),c.size===0&&a.delete(u))}})):((0,p.observe)(e,(0,p.onAdd)(r,l),u=>{t.push([u,2,y])}),(0,p.observe)(e,(0,p.onRemove)(r,l),u=>{t.push([u,3,y])}))}),()=>{s=0;for(let l=0;l<t.length;l++){let[y,u,c,b,m]=t[l];i.setUint32(s,y),s+=4,i.setUint8(s,u),s+=1,(u===2||u===3||u===4||u===5)&&(i.setUint8(s,c),s+=1,(u===4||u===5)&&(i.setUint32(s,b),s+=4,u===4&&m&&(s=le(m,y,i,s))))}return t.length=0,n.slice(0,s)}},Z=(e,r,o,n)=>{let i=n||new Map;return(s,t)=>{let a=t||i,l=new DataView(s),y=0;for(;y<s.byteLength;){let u=l.getUint32(y);y+=4;let c=l.getUint8(y);y+=1;let b=-1,m=-1;(c===2||c===3||c===4||c===5)&&(b=l.getUint8(y),y+=1,(c===4||c===5)&&(m=l.getUint32(y),y+=4));let g=o[b],A=a.get(u);if(c===0)A===void 0?(A=(0,p.addEntity)(e),a.set(u,A),(0,p.addComponent)(e,A,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(A!==void 0&&(0,p.entityExists)(e,A)){if(c===1)(0,p.removeEntity)(e,A),a.delete(u);else if(c===2)(0,p.addComponent)(e,A,g);else if(c===3)(0,p.removeComponent)(e,A,g);else if(c===4){let d=a.get(m);if(d!==void 0){let $=g(d);(0,p.addComponent)(e,A,$),y=ue($,A,l,y)}}else if(c===5){let d=a.get(m);d!==void 0&&(0,p.removeComponent)(e,A,g(d))}}}return a}};
//# sourceMappingURL=index.min.cjs.map
