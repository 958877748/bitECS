var J=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var he=(t,e)=>{for(var n in e)J(t,n,{get:e[n],enumerable:!0})},We=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ge(e))!Re.call(t,o)&&o!==n&&J(t,o,{get:()=>e[o],enumerable:!(a=Ie(e,o))||a.enumerable});return t};var Ae=t=>We(J({},"__esModule",{value:!0}),t);var Ue={};he(Ue,{createObserverDeserializer:()=>Z,createObserverSerializer:()=>_,createSnapshotDeserializer:()=>Te,createSnapshotSerializer:()=>Ce,createSoADeserializer:()=>$,createSoASerializer:()=>z,f32:()=>ye,f64:()=>ce,i16:()=>ie,i32:()=>me,i8:()=>ae,u16:()=>se,u32:()=>pe,u8:()=>re});module.exports=Ae(Ue);var Q=Symbol("u8"),M=Symbol("i8"),k=Symbol("u16"),D=Symbol("i16"),T=Symbol("u32"),U=Symbol("i32"),w=Symbol("f32"),v=Symbol("f64"),x=t=>(e=[])=>Object.defineProperty(e,t,{value:!0,enumerable:!1,writable:!1,configurable:!1}),re=x(Q),ae=x(M),se=x(k),ie=x(D),pe=x(T),me=x(U),ye=x(w),ce=x(v),ne={[Q]:(t,e,n)=>(t.setUint8(e,n),1),[M]:(t,e,n)=>(t.setInt8(e,n),1),[k]:(t,e,n)=>(t.setUint16(e,n),2),[D]:(t,e,n)=>(t.setInt16(e,n),2),[T]:(t,e,n)=>(t.setUint32(e,n),4),[U]:(t,e,n)=>(t.setInt32(e,n),4),[w]:(t,e,n)=>(t.setFloat32(e,n),4),[v]:(t,e,n)=>(t.setFloat64(e,n),8)},oe={[Q]:(t,e)=>({value:t.getUint8(e),size:1}),[M]:(t,e)=>({value:t.getInt8(e),size:1}),[k]:(t,e)=>({value:t.getUint16(e),size:2}),[D]:(t,e)=>({value:t.getInt16(e),size:2}),[T]:(t,e)=>({value:t.getUint32(e),size:4}),[U]:(t,e)=>({value:t.getInt32(e),size:4}),[w]:(t,e)=>({value:t.getFloat32(e),size:4}),[v]:(t,e)=>({value:t.getFloat64(e),size:8})},Se=t=>{let e=Object.keys(t),a=e.map(o=>{let r=t[o];for(let s of[Q,M,k,D,T,U,w,v])if(s in r)return s;return v}).map(o=>ne[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,r,s)=>{let i=0;i+=ne[T](o,r+i,s);for(let p=0;p<e.length;p++)i+=a[p](o,r+i,t[e[p]][s]);return i}},Ee=t=>{let e=Object.keys(t),a=e.map(o=>{let r=t[o];for(let s of[Q,M,k,D,T,U,w,v])if(s in r)return s;return v}).map(o=>oe[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,r,s)=>{let i=0,{value:p,size:m}=oe[T](o,r+i);i+=m;let c=s?s.get(p)??p:p;for(let y=0;y<e.length;y++){let{value:l,size:f}=a[y](o,r+i);t[e[y]][c]=l,i+=f}return i}},z=(t,e=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(e),a=t.map(Se);return o=>{let r=0;for(let s=0;s<o.length;s++){let i=o[s];for(let p=0;p<a.length;p++)r+=a[p](n,r,i)}return e.slice(0,r)}},$=t=>{let e=t.map(Ee);return(n,a)=>{let o=new DataView(n),r=0;for(;r<n.byteLength;)for(let s=0;s<e.length;s++)r+=e[s](o,r,a)}};var A=(t,e,n)=>Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0,configurable:!0});var X=(t,e)=>{let n=t.sparse[e];return n!==void 0&&t.dense[n]===e};var d=Symbol.for("bitecs_internal");var B=()=>{let t=new Set;return{subscribe:a=>(t.add(a),()=>{t.delete(a)}),notify:(a,...o)=>Array.from(t).reduce((r,s)=>{let i=s(a,...o);return i&&typeof i=="object"?{...r,...i}:r},{})}};var Ze=Symbol("opType"),et=Symbol("opTerms");function V(t,e,n){let a=t[d],{masks:o,notMasks:r,orMasks:s,generations:i}=e;for(let p=0;p<i.length;p++){let m=i[p],c=o[m],y=r[m],l=s[m],f=a.entityMasks[m][n];if(y&&f&y||c&&(f&c)!==c||l&&!(f&l))return!1}return!0}var H=(t,e)=>{t.toRemove.remove(e),t.addObservable.notify(e),t.add(e)};var F=(t,e,n)=>{let a=t[d];!e.has(n)||e.toRemove.has(n)||(e.toRemove.add(n),a.dirtyQueries.add(e),e.removeObservable.notify(n))};var N=require("../core"),ee=require("../core");var u=require("../core");var _=(t,e,n,a=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(a),r=0,s=[];return(0,u.observe)(t,(0,u.onAdd)(e),i=>{s.push([i,0,-1])}),(0,u.observe)(t,(0,u.onRemove)(e),i=>{s.push([i,1,-1])}),n.forEach((i,p)=>{(0,u.observe)(t,(0,u.onAdd)(e,i),m=>{s.push([m,2,p])}),(0,u.observe)(t,(0,u.onRemove)(e,i),m=>{s.push([m,3,p])})}),()=>{r=0;for(let i=0;i<s.length;i++){let[p,m,c]=s[i];o.setUint32(r,p),r+=4,o.setUint8(r,m),r+=1,o.setUint8(r,c),r+=1}return s.length=0,a.slice(0,r)}},Z=(t,e,n)=>(a,o=new Map)=>{let r=new DataView(a),s=0;for(;s<a.byteLength;){let i=r.getUint32(s);s+=4;let p=r.getUint8(s);s+=1;let m=r.getUint8(s);s+=1;let c=n[m],y=o.get(i);y===void 0&&(y=(0,u.addEntity)(t),o.set(i,y)),p===0?(0,u.addComponent)(t,y,e):p===1?(0,u.removeEntity)(t,y):p===2?(0,u.addComponent)(t,y,c):p===3&&(0,u.removeComponent)(t,y,c)}return o};var Qe=require("../core");var Me=Symbol("$modifier");var O=Symbol("relation"),R=Symbol("pairTarget"),q=Symbol("isPairComponent"),C=Symbol("relationData"),be=()=>{let t={pairsMap:new Map,initStore:void 0,exclusiveRelation:!1,autoRemoveSubject:!1,onTargetRemoved:void 0},e=n=>{if(n===void 0)throw Error("Relation target is undefined");let a=n==="*"?b:n;if(!t.pairsMap.has(a)){let o=t.initStore?t.initStore():{};A(o,O,e),A(o,R,a),A(o,q,!0),t.pairsMap.set(a,o)}return t.pairsMap.get(a)};return A(e,C,t),e},ue=t=>e=>{let n=e[C];return n.initStore=t,e},De=t=>{let e=t[C];return e.exclusiveRelation=!0,t},le=t=>{let e=t[C];return e.autoRemoveSubject=!0,t},de=t=>e=>{let n=e[C];return n.onTargetRemoved=t,e};var g=(t,e)=>{if(t===void 0)throw Error("Relation is undefined");return t(e)},b=te(),S=te(),E=(t,e,n)=>{let a=j(t,e),o=[];for(let r of a)r[O]===n&&r[R]!==b&&o.push(r[R]);return o};function te(...t){if(t.length===1&&typeof t[0]=="object"){let{store:e,exclusive:n,autoRemoveSubject:a,onTargetRemoved:o}=t[0];return[e&&ue(e),n&&De,a&&le,o&&de(o)].filter(Boolean).reduce((s,i)=>i(s),be())}else return t.reduce((n,a)=>a(n),be())}var P={};var j=(t,e)=>{let n=t[d];if(e===void 0)throw new Error("bitECS - entity is undefined.");if(!X(n.entityIndex,e))throw new Error("bitECS - entity does not exist in the world.");return Array.from(n.entityComponents.get(e))},K=(t,e)=>X(t[d].entityIndex,e);var Y=(t,e)=>{if(!e)throw new Error("bitECS - Cannot register null or undefined component");let n=t[d],a=new Set,o={id:n.componentCount++,generationId:n.entityMasks.length-1,bitflag:n.bitflag,ref:e,queries:a,setObservable:B(),getObservable:B()};return n.componentMap.set(e,o),n.bitflag*=2,n.bitflag>=2**31&&(n.bitflag=1,n.entityMasks.push([])),o};var I=(t,e,n)=>{let a=t[d],o=a.componentMap.get(n);if(!o)return!1;let{generationId:r,bitflag:s}=o;return(a.entityMasks[r][e]&s)===s},fe=(t,e,n)=>{let o=t[d].componentMap.get(n);if(o&&I(t,e,n))return o.getObservable.notify(e)};var xe=(t,e,n)=>{let a=t[d];h(t,e,S(n));let o=j(t,n);for(let s of o){if(s===P)continue;h(t,e,s);let i=a.componentMap.get(s);if(i&&i.setObservable){let p=fe(t,n,s);i.setObservable.notify(e,p)}}let r=E(t,n,S);for(let s of r)xe(t,e,s)},h=(t,e,...n)=>{let a=t[d];if(!K(t,e))throw new Error(`Cannot add component - entity ${e} does not exist in the world.`);n.forEach(o=>{let r="component"in o?o.component:o,s="data"in o?o.data:void 0;if(a.componentMap.has(r)||Y(t,r),I(t,e,r))return;let i=a.componentMap.get(r),{generationId:p,bitflag:m,queries:c}=i;if(a.entityMasks[p][e]|=m,I(t,e,P)||c.forEach(y=>{y.toRemove.remove(e),V(t,y,e)?H(y,e):F(t,y,e)}),a.entityComponents.get(e).add(r),s!==void 0&&i.setObservable.notify(e,s),r[q]){let y=r[O];h(t,e,g(y,b));let l=r[R];if(h(t,e,g(b,l)),y[C].exclusiveRelation===!0&&l!==b){let W=E(t,e,y)[0];W!=null&&W!==l&&L(t,e,y(W))}if(y===S){let W=E(t,e,S);for(let ve of W)xe(t,e,ve)}}})};var L=(t,e,...n)=>{let a=t[d];if(!K(t,e))throw new Error(`Cannot remove component - entity ${e} does not exist in the world.`);n.forEach(o=>{if(!I(t,e,o))return;let r=a.componentMap.get(o),{generationId:s,bitflag:i,queries:p}=r;if(a.entityMasks[s][e]&=~i,p.forEach(m=>{m.toRemove.remove(e),V(t,m,e)?H(m,e):F(t,m,e)}),a.entityComponents.get(e).delete(o),o[q]){let m=o[R];L(t,e,g(b,m));let c=o[O];E(t,e,c).length===0&&L(t,e,g(c,b))}})};var G=require("../core"),Ce=(t,e,n=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(n),o=0,r=i=>{let p=i.length;a.setUint32(o,p),o+=4;for(let m=0;m<p;m++){let c=i[m],y=0;a.setUint32(o,c),o+=4;let l=o;o+=1;for(let f=0;f<e.length;f++)I(t,c,e[f])&&(a.setUint8(o,f),o+=1,y++);a.setUint8(l,y)}},s=i=>{let m=z(e,n.slice(o))(i);new Uint8Array(n).set(new Uint8Array(m),o),o+=m.byteLength};return()=>{o=0;let i=(0,G.getAllEntities)(t);return r(i),s(i),n.slice(0,o)}},Te=(t,e)=>{let n=$(e);return a=>{let o=new DataView(a),r=0,s=new Map,i=o.getUint32(r);r+=4;for(let p=0;p<i;p++){let m=o.getUint32(r);r+=4;let c=(0,G.addEntity)(t);s.set(m,c);let y=o.getUint8(r);r+=1;for(let l=0;l<y;l++){let f=o.getUint8(r);r+=1,h(t,c,e[f])}}return n(a.slice(r),s),s}};
//# sourceMappingURL=index.min.cjs.map
