var f=Symbol.for("bitecs-u8"),I=Symbol.for("bitecs-i8"),R=Symbol.for("bitecs-u16"),U=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),D=Symbol.for("bitecs-i32"),v=Symbol.for("bitecs-f32"),S=Symbol.for("bitecs-f64"),d=n=>(r=[])=>Object.defineProperty(r,n,{value:!0,enumerable:!1,writable:!1,configurable:!1}),G=d(f),H=d(I),J=d(R),K=d(U),N=d(A),Q=d(D),V=d(v),X=d(S),j={[f]:(n,r,i)=>(n.setUint8(r,i),1),[I]:(n,r,i)=>(n.setInt8(r,i),1),[R]:(n,r,i)=>(n.setUint16(r,i),2),[U]:(n,r,i)=>(n.setInt16(r,i),2),[A]:(n,r,i)=>(n.setUint32(r,i),4),[D]:(n,r,i)=>(n.setInt32(r,i),4),[v]:(n,r,i)=>(n.setFloat32(r,i),4),[S]:(n,r,i)=>(n.setFloat64(r,i),8)},k={[f]:(n,r)=>({value:n.getUint8(r),size:1}),[I]:(n,r)=>({value:n.getInt8(r),size:1}),[R]:(n,r)=>({value:n.getUint16(r),size:2}),[U]:(n,r)=>({value:n.getInt16(r),size:2}),[A]:(n,r)=>({value:n.getUint32(r),size:4}),[D]:(n,r)=>({value:n.getInt32(r),size:4}),[v]:(n,r)=>({value:n.getFloat32(r),size:4}),[S]:(n,r)=>({value:n.getFloat64(r),size:8})},Y=n=>{let r=Object.keys(n),t=r.map(o=>{let s=n[o];for(let e of[f,I,R,U,A,D,v,S])if(e in s)return e;return S}).map(o=>j[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0;a+=j[A](o,s+a,e);for(let l=0;l<r.length;l++)a+=t[l](o,s+a,n[r[l]][e]);return a}},Z=n=>{let r=Object.keys(n),t=r.map(o=>{let s=n[o];for(let e of[f,I,R,U,A,D,v,S])if(e in s)return e;return S}).map(o=>k[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0,{value:l,size:y}=k[A](o,s+a);a+=y;let u=e?e.get(l)??l:l;for(let c=0;c<r.length;c++){let{value:m,size:p}=t[c](o,s+a);n[r[c]][u]=m,a+=p}return a}},E=(n,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),t=n.map(Y);return o=>{let s=0;for(let e=0;e<o.length;e++){let a=o[e];for(let l=0;l<t.length;l++)s+=t[l](i,s,a)}return r.slice(0,s)}},O=n=>{let r=n.map(Z);return(i,t)=>{let o=new DataView(i),s=0;for(;s<i.byteLength;)for(let e=0;e<r.length;e++)s+=r[e](o,s,t)}};import{addComponent as W,hasComponent as _,getAllEntities as ee,addEntity as P,isRelation as w,getRelationTargets as te,Wildcard as Ue,query as ze}from"bitecs";function ne(n,r,i,t){if(!n)return t;if(Array.isArray(n)){let o=n[r];return o!==void 0?(i.setFloat64(t,o),t+8):t}if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s],a=e[r];a!==void 0&&(e instanceof Int8Array||I in e?(i.setInt8(t,a),t+=1):e instanceof Uint8Array||f in e?(i.setUint8(t,a),t+=1):e instanceof Int16Array||U in e?(i.setInt16(t,a),t+=2):e instanceof Uint16Array||R in e?(i.setUint16(t,a),t+=2):e instanceof Int32Array||D in e?(i.setInt32(t,a),t+=4):e instanceof Uint32Array||A in e?(i.setUint32(t,a),t+=4):e instanceof Float32Array||v in e?(i.setFloat32(t,a),t+=4):(i.setFloat64(t,a),t+=8))}}return t}function re(n,r,i,t){if(!n)return t;if(Array.isArray(n))return n[r]=i.getFloat64(t),t+8;if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s];e instanceof Int8Array||I in e?(e[r]=i.getInt8(t),t+=1):e instanceof Uint8Array||f in e?(e[r]=i.getUint8(t),t+=1):e instanceof Int16Array||U in e?(e[r]=i.getInt16(t),t+=2):e instanceof Uint16Array||R in e?(e[r]=i.getUint16(t),t+=2):e instanceof Int32Array||D in e?(e[r]=i.getInt32(t),t+=4):e instanceof Uint32Array||A in e?(e[r]=i.getUint32(t),t+=4):e instanceof Float32Array||v in e?(e[r]=i.getFloat32(t),t+=4):(e[r]=i.getFloat64(t),t+=8)}}return t}var ie=(n,r,i=new ArrayBuffer(1024*1024*100))=>{let t=new DataView(i),o=0,s=a=>{let l=a.length;t.setUint32(o,l),o+=4;for(let y=0;y<l;y++){let u=a[y],c=0;t.setUint32(o,u),o+=4;let m=o;o+=1;for(let p=0;p<r.length;p++){let g=r[p];if(w(g)){let b=te(n,u,g);for(let z of b){t.setUint8(o,p),o+=1,t.setUint32(o,z),o+=4;let C=g(z);o=ne(C,u,t,o),c++}}else _(n,u,g)&&(t.setUint8(o,p),o+=1,c++)}t.setUint8(m,c)}},e=a=>{let y=E(r,i.slice(o))(a);new Uint8Array(i).set(new Uint8Array(y),o),o+=y.byteLength};return()=>{o=0;let a=ee(n);return s(a),e(a),i.slice(0,o)}},oe=(n,r,i)=>{let t=i||new Map,o=O(r);return(s,e)=>{let a=e||t,l=new DataView(s),y=0,u=l.getUint32(y);y+=4;for(let c=0;c<u;c++){let m=l.getUint32(y);y+=4;let p=a.get(m);p===void 0&&(p=P(n),a.set(m,p));let g=l.getUint8(y);y+=1;for(let b=0;b<g;b++){let z=l.getUint8(y);y+=1;let C=r[z];if(w(C)){let B=l.getUint32(y);y+=4;let $=a.get(B);$===void 0&&($=P(n),a.set(B,$));let M=C($);W(n,p,M),y=re(M,p,l,y)}else W(n,p,C)}}return o(s.slice(y),a),a}};import{addComponent as x,removeComponent as L,addEntity as ae,removeEntity as se,observe as h,onAdd as F,onRemove as T,entityExists as le,isRelation as ye,getRelationTargets as ue,Wildcard as q}from"bitecs";function ce(n,r,i,t){if(!n)return t;if(Array.isArray(n)){let o=n[r];return o!==void 0?(i.setFloat64(t,o),t+8):t}if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s],a=e[r];a!==void 0&&(e instanceof Int8Array||I in e?(i.setInt8(t,a),t+=1):e instanceof Uint8Array||f in e?(i.setUint8(t,a),t+=1):e instanceof Int16Array||U in e?(i.setInt16(t,a),t+=2):e instanceof Uint16Array||R in e?(i.setUint16(t,a),t+=2):e instanceof Int32Array||D in e?(i.setInt32(t,a),t+=4):e instanceof Uint32Array||A in e?(i.setUint32(t,a),t+=4):e instanceof Float32Array||v in e?(i.setFloat32(t,a),t+=4):(i.setFloat64(t,a),t+=8))}}return t}function pe(n,r,i,t){if(!n)return t;if(Array.isArray(n))return n[r]=i.getFloat64(t),t+8;if(typeof n=="object"){let o=Object.keys(n).sort();for(let s of o){let e=n[s];e instanceof Int8Array||I in e?(e[r]=i.getInt8(t),t+=1):e instanceof Uint8Array||f in e?(e[r]=i.getUint8(t),t+=1):e instanceof Int16Array||U in e?(e[r]=i.getInt16(t),t+=2):e instanceof Uint16Array||R in e?(e[r]=i.getUint16(t),t+=2):e instanceof Int32Array||D in e?(e[r]=i.getInt32(t),t+=4):e instanceof Uint32Array||A in e?(e[r]=i.getUint32(t),t+=4):e instanceof Float32Array||v in e?(e[r]=i.getFloat32(t),t+=4):(e[r]=i.getFloat64(t),t+=8)}}return t}var me=(n,r,i,t=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(t),s=0,e=[],a=new Map;return h(n,F(r),l=>{e.push([l,0,-1])}),h(n,T(r),l=>{e.push([l,1,-1]),a.delete(l)}),i.forEach((l,y)=>{ye(l)?(h(n,F(r,l(q)),u=>{let c=ue(n,u,l);for(let m of c){a.has(u)||a.set(u,new Map),a.get(u).set(y,m);let p=l(m);e.push([u,4,y,m,p])}}),h(n,T(r,l(q)),u=>{let c=a.get(u);if(c){let m=c.get(y);m!==void 0&&(e.push([u,5,y,m]),c.delete(y),c.size===0&&a.delete(u))}})):(h(n,F(r,l),u=>{e.push([u,2,y])}),h(n,T(r,l),u=>{e.push([u,3,y])}))}),()=>{s=0;for(let l=0;l<e.length;l++){let[y,u,c,m,p]=e[l];o.setUint32(s,y),s+=4,o.setUint8(s,u),s+=1,(u===2||u===3||u===4||u===5)&&(o.setUint8(s,c),s+=1,(u===4||u===5)&&(o.setUint32(s,m),s+=4,u===4&&p&&(s=ce(p,y,o,s))))}return e.length=0,t.slice(0,s)}},be=(n,r,i,t)=>{let o=t||new Map;return(s,e)=>{let a=e||o,l=new DataView(s),y=0;for(;y<s.byteLength;){let u=l.getUint32(y);y+=4;let c=l.getUint8(y);y+=1;let m=-1,p=-1;(c===2||c===3||c===4||c===5)&&(m=l.getUint8(y),y+=1,(c===4||c===5)&&(p=l.getUint32(y),y+=4));let g=i[m],b=a.get(u);if(c===0)if(b===void 0)b=ae(n),a.set(u,b),x(n,b,r);else throw new Error(`Entity with ID ${u} already exists in the mapping.`);else if(b!==void 0&&le(n,b)){if(c===1)se(n,b);else if(c===2)x(n,b,g);else if(c===3)L(n,b,g);else if(c===4){let z=a.get(p);if(z!==void 0){let C=g(z);x(n,b,C),y=pe(C,b,l,y)}}else if(c===5){let z=a.get(p);z!==void 0&&L(n,b,g(z))}}}return a}};export{be as createObserverDeserializer,me as createObserverSerializer,oe as createSnapshotDeserializer,ie as createSnapshotSerializer,O as createSoADeserializer,E as createSoASerializer,V as f32,X as f64,K as i16,Q as i32,H as i8,J as u16,N as u32,G as u8};
//# sourceMappingURL=index.min.mjs.map
