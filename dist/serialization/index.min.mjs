var I=Symbol("u8"),f=Symbol("i8"),R=Symbol("u16"),U=Symbol("i16"),A=Symbol("u32"),D=Symbol("i32"),v=Symbol("f32"),d=Symbol("f64"),S=t=>(r=[])=>Object.defineProperty(r,t,{value:!0,enumerable:!1,writable:!1,configurable:!1}),q=S(I),H=S(f),J=S(R),K=S(U),N=S(A),Q=S(D),V=S(v),X=S(d),j={[I]:(t,r,i)=>(t.setUint8(r,i),1),[f]:(t,r,i)=>(t.setInt8(r,i),1),[R]:(t,r,i)=>(t.setUint16(r,i),2),[U]:(t,r,i)=>(t.setInt16(r,i),2),[A]:(t,r,i)=>(t.setUint32(r,i),4),[D]:(t,r,i)=>(t.setInt32(r,i),4),[v]:(t,r,i)=>(t.setFloat32(r,i),4),[d]:(t,r,i)=>(t.setFloat64(r,i),8)},k={[I]:(t,r)=>({value:t.getUint8(r),size:1}),[f]:(t,r)=>({value:t.getInt8(r),size:1}),[R]:(t,r)=>({value:t.getUint16(r),size:2}),[U]:(t,r)=>({value:t.getInt16(r),size:2}),[A]:(t,r)=>({value:t.getUint32(r),size:4}),[D]:(t,r)=>({value:t.getInt32(r),size:4}),[v]:(t,r)=>({value:t.getFloat32(r),size:4}),[d]:(t,r)=>({value:t.getFloat64(r),size:8})},Y=t=>{let r=Object.keys(t),n=r.map(o=>{let s=t[o];for(let e of[I,f,R,U,A,D,v,d])if(e in s)return e;return d}).map(o=>j[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0;a+=j[A](o,s+a,e);for(let l=0;l<r.length;l++)a+=n[l](o,s+a,t[r[l]][e]);return a}},Z=t=>{let r=Object.keys(t),n=r.map(o=>{let s=t[o];for(let e of[I,f,R,U,A,D,v,d])if(e in s)return e;return d}).map(o=>k[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,s,e)=>{let a=0,{value:l,size:u}=k[A](o,s+a);a+=u;let y=e?e.get(l)??l:l;for(let p=0;p<r.length;p++){let{value:c,size:m}=n[p](o,s+a);t[r[p]][y]=c,a+=m}return a}},E=(t,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),n=t.map(Y);return o=>{let s=0;for(let e=0;e<o.length;e++){let a=o[e];for(let l=0;l<n.length;l++)s+=n[l](i,s,a)}return r.slice(0,s)}},O=t=>{let r=t.map(Z);return(i,n)=>{let o=new DataView(i),s=0;for(;s<i.byteLength;)for(let e=0;e<r.length;e++)s+=r[e](o,s,n)}};import{addComponent as W,hasComponent as _,getAllEntities as ee,addEntity as P,isRelation as w,getRelationTargets as ne}from"bitecs";function te(t,r,i,n){if(!t)return n;if(Array.isArray(t)){let o=t[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s],a=e[r];a!==void 0&&(e instanceof Int8Array||f in e?(i.setInt8(n,a),n+=1):e instanceof Uint8Array||I in e?(i.setUint8(n,a),n+=1):e instanceof Int16Array||U in e?(i.setInt16(n,a),n+=2):e instanceof Uint16Array||R in e?(i.setUint16(n,a),n+=2):e instanceof Int32Array||D in e?(i.setInt32(n,a),n+=4):e instanceof Uint32Array||A in e?(i.setUint32(n,a),n+=4):e instanceof Float32Array||v in e?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function re(t,r,i,n){if(!t)return n;if(Array.isArray(t))return t[r]=i.getFloat64(n),n+8;if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s];e instanceof Int8Array||f in e?(e[r]=i.getInt8(n),n+=1):e instanceof Uint8Array||I in e?(e[r]=i.getUint8(n),n+=1):e instanceof Int16Array||U in e?(e[r]=i.getInt16(n),n+=2):e instanceof Uint16Array||R in e?(e[r]=i.getUint16(n),n+=2):e instanceof Int32Array||D in e?(e[r]=i.getInt32(n),n+=4):e instanceof Uint32Array||A in e?(e[r]=i.getUint32(n),n+=4):e instanceof Float32Array||v in e?(e[r]=i.getFloat32(n),n+=4):(e[r]=i.getFloat64(n),n+=8)}}return n}var ie=(t,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),o=0,s=a=>{let l=a.length;n.setUint32(o,l),o+=4;for(let u=0;u<l;u++){let y=a[u],p=0;n.setUint32(o,y),o+=4;let c=o;o+=1;for(let m=0;m<r.length;m++){let g=r[m];if(w(g)){let b=ne(t,y,g);for(let z of b){n.setUint8(o,m),o+=1,n.setUint32(o,z),o+=4;let C=g(z);o=te(C,y,n,o),p++}}else _(t,y,g)&&(n.setUint8(o,m),o+=1,p++)}n.setUint8(c,p)}},e=a=>{let u=E(r,i.slice(o))(a);new Uint8Array(i).set(new Uint8Array(u),o),o+=u.byteLength};return()=>{o=0;let a=ee(t);return s(a),e(a),i.slice(0,o)}},oe=(t,r,i)=>{let n=i||new Map,o=O(r);return(s,e)=>{let a=e||n,l=new DataView(s),u=0,y=l.getUint32(u);u+=4;for(let p=0;p<y;p++){let c=l.getUint32(u);u+=4;let m=a.get(c);m===void 0&&(m=P(t),a.set(c,m));let g=l.getUint8(u);u+=1;for(let b=0;b<g;b++){let z=l.getUint8(u);u+=1;let C=r[z];if(w(C)){let B=l.getUint32(u);u+=4;let $=a.get(B);$===void 0&&($=P(t),a.set(B,$));let M=C($);W(t,m,M),u=re(M,m,l,u)}else W(t,m,C)}}return o(s.slice(u),a),a}};import{addComponent as x,removeComponent as L,addEntity as ae,removeEntity as se,observe as h,onAdd as F,onRemove as T,entityExists as le,isRelation as ue,getRelationTargets as ye,Wildcard as G}from"bitecs";function pe(t,r,i,n){if(!t)return n;if(Array.isArray(t)){let o=t[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s],a=e[r];a!==void 0&&(e instanceof Int8Array||f in e?(i.setInt8(n,a),n+=1):e instanceof Uint8Array||I in e?(i.setUint8(n,a),n+=1):e instanceof Int16Array||U in e?(i.setInt16(n,a),n+=2):e instanceof Uint16Array||R in e?(i.setUint16(n,a),n+=2):e instanceof Int32Array||D in e?(i.setInt32(n,a),n+=4):e instanceof Uint32Array||A in e?(i.setUint32(n,a),n+=4):e instanceof Float32Array||v in e?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function me(t,r,i,n){if(!t)return n;if(Array.isArray(t))return t[r]=i.getFloat64(n),n+8;if(typeof t=="object"){let o=Object.keys(t).sort();for(let s of o){let e=t[s];e instanceof Int8Array||f in e?(e[r]=i.getInt8(n),n+=1):e instanceof Uint8Array||I in e?(e[r]=i.getUint8(n),n+=1):e instanceof Int16Array||U in e?(e[r]=i.getInt16(n),n+=2):e instanceof Uint16Array||R in e?(e[r]=i.getUint16(n),n+=2):e instanceof Int32Array||D in e?(e[r]=i.getInt32(n),n+=4):e instanceof Uint32Array||A in e?(e[r]=i.getUint32(n),n+=4):e instanceof Float32Array||v in e?(e[r]=i.getFloat32(n),n+=4):(e[r]=i.getFloat64(n),n+=8)}}return n}var ce=(t,r,i,n=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(n),s=0,e=[],a=new Map;return h(t,F(r),l=>{e.push([l,0,-1])}),h(t,T(r),l=>{e.push([l,1,-1]),a.delete(l)}),i.forEach((l,u)=>{ue(l)?(h(t,F(r,l(G)),y=>{let p=ye(t,y,l);for(let c of p){a.has(y)||a.set(y,new Map),a.get(y).set(u,c);let m=l(c);e.push([y,4,u,c,m])}}),h(t,T(r,l(G)),y=>{let p=a.get(y);if(p){let c=p.get(u);c!==void 0&&(e.push([y,5,u,c]),p.delete(u),p.size===0&&a.delete(y))}})):(h(t,F(r,l),y=>{e.push([y,2,u])}),h(t,T(r,l),y=>{e.push([y,3,u])}))}),()=>{s=0;for(let l=0;l<e.length;l++){let[u,y,p,c,m]=e[l];o.setUint32(s,u),s+=4,o.setUint8(s,y),s+=1,(y===2||y===3||y===4||y===5)&&(o.setUint8(s,p),s+=1,(y===4||y===5)&&(o.setUint32(s,c),s+=4,y===4&&m&&(s=pe(m,u,o,s))))}return e.length=0,n.slice(0,s)}},be=(t,r,i,n)=>{let o=n||new Map;return(s,e)=>{let a=e||o,l=new DataView(s),u=0;for(;u<s.byteLength;){let y=l.getUint32(u);u+=4;let p=l.getUint8(u);u+=1;let c=-1,m=-1;(p===2||p===3||p===4||p===5)&&(c=l.getUint8(u),u+=1,(p===4||p===5)&&(m=l.getUint32(u),u+=4));let g=i[c],b=a.get(y);if(p===0)if(b===void 0)b=ae(t),a.set(y,b),x(t,b,r);else throw new Error(`Entity with ID ${y} already exists in the mapping.`);else if(b!==void 0&&le(t,b)){if(p===1)se(t,b);else if(p===2)x(t,b,g);else if(p===3)L(t,b,g);else if(p===4){let z=a.get(m);if(z!==void 0){let C=g(z);x(t,b,C),u=me(C,b,l,u)}}else if(p===5){let z=a.get(m);z!==void 0&&L(t,b,g(z))}}}return a}};export{be as createObserverDeserializer,ce as createObserverSerializer,oe as createSnapshotDeserializer,ie as createSnapshotSerializer,O as createSoADeserializer,E as createSoASerializer,V as f32,X as f64,K as i16,Q as i32,H as i8,J as u16,N as u32,q as u8};
//# sourceMappingURL=index.min.mjs.map
