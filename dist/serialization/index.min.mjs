var g=Symbol("u8"),A=Symbol("i8"),v=Symbol("u16"),w=Symbol("i16"),d=Symbol("u32"),D=Symbol("i32"),z=Symbol("f32"),b=Symbol("f64"),c=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),T=c(g),$=c(A),B=c(v),P=c(w),W=c(d),F=c(D),M=c(z),j=c(b),I={[g]:(e,t,s)=>(e.setUint8(t,s),1),[A]:(e,t,s)=>(e.setInt8(t,s),1),[v]:(e,t,s)=>(e.setUint16(t,s),2),[w]:(e,t,s)=>(e.setInt16(t,s),2),[d]:(e,t,s)=>(e.setUint32(t,s),4),[D]:(e,t,s)=>(e.setInt32(t,s),4),[z]:(e,t,s)=>(e.setFloat32(t,s),4),[b]:(e,t,s)=>(e.setFloat64(t,s),8)},V={[g]:(e,t)=>({value:e.getUint8(t),size:1}),[A]:(e,t)=>({value:e.getInt8(t),size:1}),[v]:(e,t)=>({value:e.getUint16(t),size:2}),[w]:(e,t)=>({value:e.getInt16(t),size:2}),[d]:(e,t)=>({value:e.getUint32(t),size:4}),[D]:(e,t)=>({value:e.getInt32(t),size:4}),[z]:(e,t)=>({value:e.getFloat32(t),size:4}),[b]:(e,t)=>({value:e.getFloat64(t),size:8})},L=e=>{let t=Object.keys(e),p=t.map(r=>{let o=e[r];for(let i of[g,A,v,w,d,D,z,b])if(i in o)return i;return b}).map(r=>I[r]||(()=>{throw new Error("Unsupported or unannotated type")}));return(r,o,i)=>{let a=0;a+=I[d](r,o+a,i);for(let n=0;n<t.length;n++)a+=p[n](r,o+a,e[t[n]][i]);return a}},G=e=>{let t=Object.keys(e),p=t.map(r=>{let o=e[r];for(let i of[g,A,v,w,d,D,z,b])if(i in o)return i;return b}).map(r=>V[r]||(()=>{throw new Error("Unsupported or unannotated type")}));return(r,o,i)=>{let a=0,{value:n,size:l}=V[d](r,o+a);a+=l;let m=i?i.get(n)??n:n;for(let y=0;y<t.length;y++){let{value:u,size:f}=p[y](r,o+a);e[t[y]][m]=u,a+=f}return a}},S=(e,t=new ArrayBuffer(1024*1024*100))=>{let s=new DataView(t),p=e.map(L);return r=>{let o=0;for(let i=0;i<r.length;i++){let a=r[i];for(let n=0;n<p.length;n++)o+=p[n](s,o,a)}return t.slice(0,o)}},h=e=>{let t=e.map(G);return(s,p)=>{let r=new DataView(s),o=0;for(;o<s.byteLength;)for(let i=0;i<t.length;i++)o+=t[i](r,o,p)}};import{addComponent as q,hasComponent as H,getAllEntities as J,addEntity as K}from"bitecs";var N=(e,t,s=new ArrayBuffer(1024*1024*100))=>{let p=new DataView(s),r=0,o=a=>{let n=a.length;p.setUint32(r,n),r+=4;for(let l=0;l<n;l++){let m=a[l],y=0;p.setUint32(r,m),r+=4;let u=r;r+=1;for(let f=0;f<t.length;f++)H(e,m,t[f])&&(p.setUint8(r,f),r+=1,y++);p.setUint8(u,y)}},i=a=>{let l=S(t,s.slice(r))(a);new Uint8Array(s).set(new Uint8Array(l),r),r+=l.byteLength};return()=>{r=0;let a=J(e);return o(a),i(a),s.slice(0,r)}},Q=(e,t)=>{let s=h(t);return p=>{let r=new DataView(p),o=0,i=new Map,a=r.getUint32(o);o+=4;for(let n=0;n<a;n++){let l=r.getUint32(o);o+=4;let m=K(e);i.set(l,m);let y=r.getUint8(o);o+=1;for(let u=0;u<y;u++){let f=r.getUint8(o);o+=1,q(e,m,t[f])}}return s(p.slice(o),i),i}};import{addComponent as C,removeComponent as x,addEntity as X,removeEntity as Y,observe as R,onAdd as U,onRemove as E,entityExists as Z,isRelation as _,getRelationTargets as k,Wildcard as O}from"bitecs";var ee=(e,t,s,p=new ArrayBuffer(1024*1024*100))=>{let r=new DataView(p),o=0,i=[],a=new Map;return R(e,U(t),n=>{i.push([n,0,-1])}),R(e,E(t),n=>{i.push([n,1,-1]),a.delete(n)}),s.forEach((n,l)=>{_(n)?(R(e,U(t,n(O)),m=>{let y=k(e,m,n);for(let u of y)a.has(m)||a.set(m,new Map),a.get(m).set(l,u),i.push([m,4,l,u])}),R(e,E(t,n(O)),m=>{let y=a.get(m);if(y){let u=y.get(l);u!==void 0&&(i.push([m,5,l,u]),y.delete(l),y.size===0&&a.delete(m))}})):(R(e,U(t,n),m=>{i.push([m,2,l])}),R(e,E(t,n),m=>{i.push([m,3,l])}))}),()=>{o=0;for(let n=0;n<i.length;n++){let[l,m,y,u]=i[n];r.setUint32(o,l),o+=4,r.setUint8(o,m),o+=1,(m===2||m===3||m===4||m===5)&&(r.setUint8(o,y),o+=1,(m===4||m===5)&&(r.setUint32(o,u),o+=4))}return i.length=0,p.slice(0,o)}},te=(e,t,s,p=new Map)=>r=>{let o=new DataView(r),i=0;for(;i<r.byteLength;){let a=o.getUint32(i);i+=4;let n=o.getUint8(i);i+=1;let l=-1,m=-1;(n===2||n===3||n===4||n===5)&&(l=o.getUint8(i),i+=1,(n===4||n===5)&&(m=o.getUint32(i),i+=4));let y=s[l],u=p.get(a);if(n===0)if(u===void 0)u=X(e),p.set(a,u),C(e,u,t);else throw new Error(`Entity with ID ${a} already exists in the mapping.`);else if(u!==void 0&&Z(e,u)){if(n===1)Y(e,u);else if(n===2)C(e,u,y);else if(n===3)x(e,u,y);else if(n===4){let f=p.get(m);f!==void 0&&C(e,u,y(f))}else if(n===5){let f=p.get(m);f!==void 0&&x(e,u,y(f))}}}return p};export{te as createObserverDeserializer,ee as createObserverSerializer,Q as createSnapshotDeserializer,N as createSnapshotSerializer,h as createSoADeserializer,S as createSoASerializer,M as f32,j as f64,P as i16,F as i32,$ as i8,B as u16,W as u32,T as u8};
//# sourceMappingURL=index.min.mjs.map
