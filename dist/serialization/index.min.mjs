var d=Symbol.for("bitecs-u8"),U=Symbol.for("bitecs-i8"),v=Symbol.for("bitecs-u16"),D=Symbol.for("bitecs-i16"),g=Symbol.for("bitecs-u32"),z=Symbol.for("bitecs-i32"),I=Symbol.for("bitecs-f32"),T=Symbol.for("bitecs-f64"),F=Symbol.for("bitecs-arr"),S=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),J=S(d),K=S(U),N=S(v),Q=S(D),X=S(g),Y=S(z),Z=S(I),_=S(T),$={[d]:(e,r,o)=>(e.setUint8(r,o),1),[U]:(e,r,o)=>(e.setInt8(r,o),1),[v]:(e,r,o)=>(e.setUint16(r,o),2),[D]:(e,r,o)=>(e.setInt16(r,o),2),[g]:(e,r,o)=>(e.setUint32(r,o),4),[z]:(e,r,o)=>(e.setInt32(r,o),4),[I]:(e,r,o)=>(e.setFloat32(r,o),4),[T]:(e,r,o)=>(e.setFloat64(r,o),8)},h={[d]:(e,r)=>({value:e.getUint8(r),size:1}),[U]:(e,r)=>({value:e.getInt8(r),size:1}),[v]:(e,r)=>({value:e.getUint16(r),size:2}),[D]:(e,r)=>({value:e.getInt16(r),size:2}),[g]:(e,r)=>({value:e.getUint32(r),size:4}),[z]:(e,r)=>({value:e.getInt32(r),size:4}),[I]:(e,r)=>({value:e.getFloat32(r),size:4}),[T]:(e,r)=>({value:e.getFloat64(r),size:8})},ee=(e=I)=>{let r=[];return Object.defineProperty(r,F,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function O(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function B(e){for(let r of[d,U,v,D,g,z,I,T])if(r in e)return r;return e instanceof Int8Array?U:e instanceof Uint8Array?d:e instanceof Int16Array?D:e instanceof Uint16Array?v:e instanceof Int32Array?z:e instanceof Uint32Array?g:e instanceof Float32Array?I:T}var te=e=>{if(O(e)){let a=B(e),s=$[a];return(t,i,l)=>{let y=0;return y+=$[g](t,i,l),y+=s(t,i+y,e[l]),y}}let r=Object.keys(e),n=r.map(a=>{let s=e[a];if(!O(s))throw new Error(`Invalid array type for property ${a}`);return B(s)}).map(a=>$[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,s,t)=>{let i=0;i+=$[g](a,s+i,t);for(let l=0;l<r.length;l++){let y=e[r[l]][F],u=e[r[l]][t];if(y===void 0){i+=n[l](a,s+i,u);continue}let c=Array.isArray(u);if(i+=$[d](a,s+i,c?1:0),!c)continue;let m=u,p=m.length;i+=$[g](a,s+i,p);for(let A=0;A<p;A++)i+=$[y](a,s+i,m[A])}return i}},ne=e=>{if(O(e)){let a=B(e),s=h[a];return(t,i,l)=>{let y=0,{value:u,size:c}=h[g](t,i);y+=c;let m=l?l.get(u)??u:u,{value:p,size:A}=s(t,i+y);return e[m]=p,y+A}}let r=Object.keys(e),n=r.map(a=>{let s=e[a];if(!O(s))throw new Error(`Invalid array type for property ${a}`);return B(s)}).map(a=>h[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,s,t)=>{let i=0,{value:l,size:y}=h[g](a,s+i);i+=y;let u=t?t.get(l)??l:l;for(let c=0;c<r.length;c++){let m=e[r[c]][F];if(m===void 0){let{value:f,size:R}=n[c](a,s+i);e[r[c]][u]=f,i+=R;continue}let p=h[d](a,s+i);if(i+=p.size,!p.value)continue;let A=h[g](a,s+i);i+=A.size;let b=new Array(A.value);for(let f=0;f<b.length;f++){let{value:R,size:E}=h[m](a,s+i);i+=E,b[f]=R}e[r[c]][u]=b}return i}},j=(e,r=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(r),n=e.map(te);return a=>{let s=0;for(let t=0;t<a.length;t++){let i=a[t];for(let l=0;l<n.length;l++)s+=n[l](o,s,i)}return r.slice(0,s)}},M=e=>{let r=e.map(ne);return(o,n)=>{let a=new DataView(o),s=0;for(;s<o.byteLength;)for(let t=0;t<r.length;t++)s+=r[t](a,s,n)}};import{addComponent as L,hasComponent as re,getAllEntities as ie,addEntity as V,isRelation as q,getRelationTargets as ae,Wildcard as ze}from"bitecs";function oe(e,r,o,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(o.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s],i=t[r];i!==void 0&&(t instanceof Int8Array||U in t?(o.setInt8(n,i),n+=1):t instanceof Uint8Array||d in t?(o.setUint8(n,i),n+=1):t instanceof Int16Array||D in t?(o.setInt16(n,i),n+=2):t instanceof Uint16Array||v in t?(o.setUint16(n,i),n+=2):t instanceof Int32Array||z in t?(o.setInt32(n,i),n+=4):t instanceof Uint32Array||g in t?(o.setUint32(n,i),n+=4):t instanceof Float32Array||I in t?(o.setFloat32(n,i),n+=4):(o.setFloat64(n,i),n+=8))}}return n}function se(e,r,o,n){if(!e)return n;if(Array.isArray(e))return e[r]=o.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s];t instanceof Int8Array||U in t?(t[r]=o.getInt8(n),n+=1):t instanceof Uint8Array||d in t?(t[r]=o.getUint8(n),n+=1):t instanceof Int16Array||D in t?(t[r]=o.getInt16(n),n+=2):t instanceof Uint16Array||v in t?(t[r]=o.getUint16(n),n+=2):t instanceof Int32Array||z in t?(t[r]=o.getInt32(n),n+=4):t instanceof Uint32Array||g in t?(t[r]=o.getUint32(n),n+=4):t instanceof Float32Array||I in t?(t[r]=o.getFloat32(n),n+=4):(t[r]=o.getFloat64(n),n+=8)}}return n}var ye=(e,r,o=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(o),a=0,s=i=>{let l=i.length;n.setUint32(a,l),a+=4;for(let y=0;y<l;y++){let u=i[y],c=0;n.setUint32(a,u),a+=4;let m=a;a+=1;for(let p=0;p<r.length;p++){let A=r[p];if(q(A)){let b=ae(e,u,A);for(let f of b){n.setUint8(a,p),a+=1,n.setUint32(a,f),a+=4;let R=A(f);a=oe(R,u,n,a),c++}}else re(e,u,A)&&(n.setUint8(a,p),a+=1,c++)}n.setUint8(m,c)}},t=i=>{let y=j(r,o.slice(a))(i);new Uint8Array(o).set(new Uint8Array(y),a),a+=y.byteLength};return()=>{a=0;let i=ie(e);return s(i),t(i),o.slice(0,a)}},le=(e,r,o)=>{let n=o||new Map,a=M(r);return(s,t)=>{let i=t||n,l=new DataView(s),y=0,u=l.getUint32(y);y+=4;for(let c=0;c<u;c++){let m=l.getUint32(y);y+=4;let p=i.get(m);p===void 0&&(p=V(e),i.set(m,p));let A=l.getUint8(y);y+=1;for(let b=0;b<A;b++){let f=l.getUint8(y);y+=1;let R=r[f];if(q(R)){let E=l.getUint32(y);y+=4;let x=i.get(E);x===void 0&&(x=V(e),i.set(E,x));let w=R(x);L(e,p,w),y=se(w,p,l,y)}else L(e,p,R)}}return a(s.slice(y),i),i}};import{addComponent as P,removeComponent as G,addEntity as ue,removeEntity as ce,observe as C,onAdd as k,onRemove as W,entityExists as pe,isRelation as me,getRelationTargets as be,Wildcard as H}from"bitecs";function Ae(e,r,o,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(o.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s],i=t[r];i!==void 0&&(t instanceof Int8Array||U in t?(o.setInt8(n,i),n+=1):t instanceof Uint8Array||d in t?(o.setUint8(n,i),n+=1):t instanceof Int16Array||D in t?(o.setInt16(n,i),n+=2):t instanceof Uint16Array||v in t?(o.setUint16(n,i),n+=2):t instanceof Int32Array||z in t?(o.setInt32(n,i),n+=4):t instanceof Uint32Array||g in t?(o.setUint32(n,i),n+=4):t instanceof Float32Array||I in t?(o.setFloat32(n,i),n+=4):(o.setFloat64(n,i),n+=8))}}return n}function ge(e,r,o,n){if(!e)return n;if(Array.isArray(e))return e[r]=o.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s];t instanceof Int8Array||U in t?(t[r]=o.getInt8(n),n+=1):t instanceof Uint8Array||d in t?(t[r]=o.getUint8(n),n+=1):t instanceof Int16Array||D in t?(t[r]=o.getInt16(n),n+=2):t instanceof Uint16Array||v in t?(t[r]=o.getUint16(n),n+=2):t instanceof Int32Array||z in t?(t[r]=o.getInt32(n),n+=4):t instanceof Uint32Array||g in t?(t[r]=o.getUint32(n),n+=4):t instanceof Float32Array||I in t?(t[r]=o.getFloat32(n),n+=4):(t[r]=o.getFloat64(n),n+=8)}}return n}var fe=(e,r,o,n=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(n),s=0,t=[],i=new Map;return C(e,k(r),l=>{t.push([l,0,-1])}),C(e,W(r),l=>{t.push([l,1,-1]),i.delete(l)}),o.forEach((l,y)=>{me(l)?(C(e,k(r,l(H)),u=>{let c=be(e,u,l);for(let m of c){i.has(u)||i.set(u,new Map),i.get(u).set(y,m);let p=l(m);t.push([u,4,y,m,p])}}),C(e,W(r,l(H)),u=>{let c=i.get(u);if(c){let m=c.get(y);m!==void 0&&(t.push([u,5,y,m]),c.delete(y),c.size===0&&i.delete(u))}})):(C(e,k(r,l),u=>{t.push([u,2,y])}),C(e,W(r,l),u=>{t.push([u,3,y])}))}),()=>{s=0;for(let l=0;l<t.length;l++){let[y,u,c,m,p]=t[l];a.setUint32(s,y),s+=4,a.setUint8(s,u),s+=1,(u===2||u===3||u===4||u===5)&&(a.setUint8(s,c),s+=1,(u===4||u===5)&&(a.setUint32(s,m),s+=4,u===4&&p&&(s=Ae(p,y,a,s))))}return t.length=0,n.slice(0,s)}},de=(e,r,o,n)=>{let a=n||new Map;return(s,t)=>{let i=t||a,l=new DataView(s),y=0;for(;y<s.byteLength;){let u=l.getUint32(y);y+=4;let c=l.getUint8(y);y+=1;let m=-1,p=-1;(c===2||c===3||c===4||c===5)&&(m=l.getUint8(y),y+=1,(c===4||c===5)&&(p=l.getUint32(y),y+=4));let A=o[m],b=i.get(u);if(c===0)b===void 0?(b=ue(e),i.set(u,b),P(e,b,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(b!==void 0&&pe(e,b)){if(c===1)ce(e,b),i.delete(u);else if(c===2)P(e,b,A);else if(c===3)G(e,b,A);else if(c===4){let f=i.get(p);if(f!==void 0){let R=A(f);P(e,b,R),y=ge(R,b,l,y)}}else if(c===5){let f=i.get(p);f!==void 0&&G(e,b,A(f))}}}return i}};export{I as $f32,T as $f64,D as $i16,z as $i32,U as $i8,v as $u16,g as $u32,d as $u8,ee as array,de as createObserverDeserializer,fe as createObserverSerializer,le as createSnapshotDeserializer,ye as createSnapshotSerializer,M as createSoADeserializer,j as createSoASerializer,Z as f32,_ as f64,Q as i16,Y as i32,K as i8,N as u16,X as u32,J as u8};
//# sourceMappingURL=index.min.mjs.map
