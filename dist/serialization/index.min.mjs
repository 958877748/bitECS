var I=Symbol.for("bitecs-u8"),R=Symbol.for("bitecs-i8"),U=Symbol.for("bitecs-u16"),v=Symbol.for("bitecs-i16"),f=Symbol.for("bitecs-u32"),D=Symbol.for("bitecs-i32"),d=Symbol.for("bitecs-f32"),$=Symbol.for("bitecs-f64"),F=Symbol.for("bitecs-arr"),S=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),J=S(I),K=S(R),N=S(U),Q=S(v),X=S(f),Y=S(D),Z=S(d),_=S($),T={[I]:(e,r,a)=>(e.setUint8(r,a),1),[R]:(e,r,a)=>(e.setInt8(r,a),1),[U]:(e,r,a)=>(e.setUint16(r,a),2),[v]:(e,r,a)=>(e.setInt16(r,a),2),[f]:(e,r,a)=>(e.setUint32(r,a),4),[D]:(e,r,a)=>(e.setInt32(r,a),4),[d]:(e,r,a)=>(e.setFloat32(r,a),4),[$]:(e,r,a)=>(e.setFloat64(r,a),8)},C={[I]:(e,r)=>({value:e.getUint8(r),size:1}),[R]:(e,r)=>({value:e.getInt8(r),size:1}),[U]:(e,r)=>({value:e.getUint16(r),size:2}),[v]:(e,r)=>({value:e.getInt16(r),size:2}),[f]:(e,r)=>({value:e.getUint32(r),size:4}),[D]:(e,r)=>({value:e.getInt32(r),size:4}),[d]:(e,r)=>({value:e.getFloat32(r),size:4}),[$]:(e,r)=>({value:e.getFloat64(r),size:8})},ee=(e=d)=>{let r=[];return Object.defineProperty(r,F,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function x(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function B(e){for(let r of[I,R,U,v,f,D,d,$])if(r in e)return r;return e instanceof Int8Array?R:e instanceof Uint8Array?I:e instanceof Int16Array?v:e instanceof Uint16Array?U:e instanceof Int32Array?D:e instanceof Uint32Array?f:e instanceof Float32Array?d:$}var te=e=>{if(x(e)){let o=B(e),y=T[o];return(t,i,l)=>{let s=0;return s+=T[f](t,i,l),s+=y(t,i+s,e[l]),s}}let r=Object.keys(e),n=r.map(o=>{let y=e[o];if(!x(y))throw new Error(`Invalid array type for property ${o}`);return B(y)}).map(o=>T[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,y,t)=>{let i=0;i+=T[f](o,y+i,t);for(let l=0;l<r.length;l++){let s=e[r[l]][F];if(s!==void 0){let u=e[r[l]][t],c=u.length;i+=T[f](o,y+i,c);for(let m=0;m<c;m++)i+=T[s](o,y+i,u[m])}else i+=n[l](o,y+i,e[r[l]][t])}return i}},ne=e=>{if(x(e)){let o=B(e),y=C[o];return(t,i,l)=>{let s=0,{value:u,size:c}=C[f](t,i);s+=c;let m=l?l.get(u)??u:u,{value:p,size:A}=y(t,i+s);return e[m]=p,s+A}}let r=Object.keys(e),n=r.map(o=>{let y=e[o];if(!x(y))throw new Error(`Invalid array type for property ${o}`);return B(y)}).map(o=>C[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,y,t)=>{let i=0,{value:l,size:s}=C[f](o,y+i);i+=s;let u=t?t.get(l)??l:l;for(let c=0;c<r.length;c++){let m=e[r[c]][F];if(m!==void 0){let{value:p,size:A}=C[f](o,y+i),b=new Array(p);i+=A;for(let g=0;g<p;g++){let{value:z,size:E}=C[m](o,y+i);i+=E,b[g]=z}e[r[c]][u]=b}else{let{value:p,size:A}=n[c](o,y+i);e[r[c]][u]=p,i+=A}}return i}},j=(e,r=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(r),n=e.map(te);return o=>{let y=0;for(let t=0;t<o.length;t++){let i=o[t];for(let l=0;l<n.length;l++)y+=n[l](a,y,i)}return r.slice(0,y)}},M=e=>{let r=e.map(ne);return(a,n)=>{let o=new DataView(a),y=0;for(;y<a.byteLength;)for(let t=0;t<r.length;t++)y+=r[t](o,y,n)}};import{addComponent as L,hasComponent as re,getAllEntities as ie,addEntity as V,isRelation as q,getRelationTargets as ae,Wildcard as ze}from"bitecs";function oe(e,r,a,n){if(!e)return n;if(Array.isArray(e)){let o=e[r];return o!==void 0?(a.setFloat64(n,o),n+8):n}if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y],i=t[r];i!==void 0&&(t instanceof Int8Array||R in t?(a.setInt8(n,i),n+=1):t instanceof Uint8Array||I in t?(a.setUint8(n,i),n+=1):t instanceof Int16Array||v in t?(a.setInt16(n,i),n+=2):t instanceof Uint16Array||U in t?(a.setUint16(n,i),n+=2):t instanceof Int32Array||D in t?(a.setInt32(n,i),n+=4):t instanceof Uint32Array||f in t?(a.setUint32(n,i),n+=4):t instanceof Float32Array||d in t?(a.setFloat32(n,i),n+=4):(a.setFloat64(n,i),n+=8))}}return n}function se(e,r,a,n){if(!e)return n;if(Array.isArray(e))return e[r]=a.getFloat64(n),n+8;if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y];t instanceof Int8Array||R in t?(t[r]=a.getInt8(n),n+=1):t instanceof Uint8Array||I in t?(t[r]=a.getUint8(n),n+=1):t instanceof Int16Array||v in t?(t[r]=a.getInt16(n),n+=2):t instanceof Uint16Array||U in t?(t[r]=a.getUint16(n),n+=2):t instanceof Int32Array||D in t?(t[r]=a.getInt32(n),n+=4):t instanceof Uint32Array||f in t?(t[r]=a.getUint32(n),n+=4):t instanceof Float32Array||d in t?(t[r]=a.getFloat32(n),n+=4):(t[r]=a.getFloat64(n),n+=8)}}return n}var ye=(e,r,a=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(a),o=0,y=i=>{let l=i.length;n.setUint32(o,l),o+=4;for(let s=0;s<l;s++){let u=i[s],c=0;n.setUint32(o,u),o+=4;let m=o;o+=1;for(let p=0;p<r.length;p++){let A=r[p];if(q(A)){let b=ae(e,u,A);for(let g of b){n.setUint8(o,p),o+=1,n.setUint32(o,g),o+=4;let z=A(g);o=oe(z,u,n,o),c++}}else re(e,u,A)&&(n.setUint8(o,p),o+=1,c++)}n.setUint8(m,c)}},t=i=>{let s=j(r,a.slice(o))(i);new Uint8Array(a).set(new Uint8Array(s),o),o+=s.byteLength};return()=>{o=0;let i=ie(e);return y(i),t(i),a.slice(0,o)}},le=(e,r,a)=>{let n=a||new Map,o=M(r);return(y,t)=>{let i=t||n,l=new DataView(y),s=0,u=l.getUint32(s);s+=4;for(let c=0;c<u;c++){let m=l.getUint32(s);s+=4;let p=i.get(m);p===void 0&&(p=V(e),i.set(m,p));let A=l.getUint8(s);s+=1;for(let b=0;b<A;b++){let g=l.getUint8(s);s+=1;let z=r[g];if(q(z)){let E=l.getUint32(s);s+=4;let O=i.get(E);O===void 0&&(O=V(e),i.set(E,O));let w=z(O);L(e,p,w),s=se(w,p,l,s)}else L(e,p,z)}}return o(y.slice(s),i),i}};import{addComponent as P,removeComponent as G,addEntity as ue,removeEntity as ce,observe as h,onAdd as k,onRemove as W,entityExists as pe,isRelation as me,getRelationTargets as be,Wildcard as H}from"bitecs";function Ae(e,r,a,n){if(!e)return n;if(Array.isArray(e)){let o=e[r];return o!==void 0?(a.setFloat64(n,o),n+8):n}if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y],i=t[r];i!==void 0&&(t instanceof Int8Array||R in t?(a.setInt8(n,i),n+=1):t instanceof Uint8Array||I in t?(a.setUint8(n,i),n+=1):t instanceof Int16Array||v in t?(a.setInt16(n,i),n+=2):t instanceof Uint16Array||U in t?(a.setUint16(n,i),n+=2):t instanceof Int32Array||D in t?(a.setInt32(n,i),n+=4):t instanceof Uint32Array||f in t?(a.setUint32(n,i),n+=4):t instanceof Float32Array||d in t?(a.setFloat32(n,i),n+=4):(a.setFloat64(n,i),n+=8))}}return n}function fe(e,r,a,n){if(!e)return n;if(Array.isArray(e))return e[r]=a.getFloat64(n),n+8;if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y];t instanceof Int8Array||R in t?(t[r]=a.getInt8(n),n+=1):t instanceof Uint8Array||I in t?(t[r]=a.getUint8(n),n+=1):t instanceof Int16Array||v in t?(t[r]=a.getInt16(n),n+=2):t instanceof Uint16Array||U in t?(t[r]=a.getUint16(n),n+=2):t instanceof Int32Array||D in t?(t[r]=a.getInt32(n),n+=4):t instanceof Uint32Array||f in t?(t[r]=a.getUint32(n),n+=4):t instanceof Float32Array||d in t?(t[r]=a.getFloat32(n),n+=4):(t[r]=a.getFloat64(n),n+=8)}}return n}var ge=(e,r,a,n=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(n),y=0,t=[],i=new Map;return h(e,k(r),l=>{t.push([l,0,-1])}),h(e,W(r),l=>{t.push([l,1,-1]),i.delete(l)}),a.forEach((l,s)=>{me(l)?(h(e,k(r,l(H)),u=>{let c=be(e,u,l);for(let m of c){i.has(u)||i.set(u,new Map),i.get(u).set(s,m);let p=l(m);t.push([u,4,s,m,p])}}),h(e,W(r,l(H)),u=>{let c=i.get(u);if(c){let m=c.get(s);m!==void 0&&(t.push([u,5,s,m]),c.delete(s),c.size===0&&i.delete(u))}})):(h(e,k(r,l),u=>{t.push([u,2,s])}),h(e,W(r,l),u=>{t.push([u,3,s])}))}),()=>{y=0;for(let l=0;l<t.length;l++){let[s,u,c,m,p]=t[l];o.setUint32(y,s),y+=4,o.setUint8(y,u),y+=1,(u===2||u===3||u===4||u===5)&&(o.setUint8(y,c),y+=1,(u===4||u===5)&&(o.setUint32(y,m),y+=4,u===4&&p&&(y=Ae(p,s,o,y))))}return t.length=0,n.slice(0,y)}},de=(e,r,a,n)=>{let o=n||new Map;return(y,t)=>{let i=t||o,l=new DataView(y),s=0;for(;s<y.byteLength;){let u=l.getUint32(s);s+=4;let c=l.getUint8(s);s+=1;let m=-1,p=-1;(c===2||c===3||c===4||c===5)&&(m=l.getUint8(s),s+=1,(c===4||c===5)&&(p=l.getUint32(s),s+=4));let A=a[m],b=i.get(u);if(c===0)b===void 0?(b=ue(e),i.set(u,b),P(e,b,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(b!==void 0&&pe(e,b)){if(c===1)ce(e,b),i.delete(u);else if(c===2)P(e,b,A);else if(c===3)G(e,b,A);else if(c===4){let g=i.get(p);if(g!==void 0){let z=A(g);P(e,b,z),s=fe(z,b,l,s)}}else if(c===5){let g=i.get(p);g!==void 0&&G(e,b,A(g))}}}return i}};export{ee as array,de as createObserverDeserializer,ge as createObserverSerializer,le as createSnapshotDeserializer,ye as createSnapshotSerializer,M as createSoADeserializer,j as createSoASerializer,Z as f32,_ as f64,Q as i16,Y as i32,K as i8,N as u16,X as u32,J as u8};
//# sourceMappingURL=index.min.mjs.map
