var z=Symbol.for("bitecs-u8"),D=Symbol.for("bitecs-i8"),T=Symbol.for("bitecs-u16"),v=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),I=Symbol.for("bitecs-i32"),h=Symbol.for("bitecs-f32"),$=Symbol.for("bitecs-f64"),B=Symbol.for("bitecs-str"),k=Symbol.for("bitecs-arr"),E=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),X=E(z),Y=E(D),Z=E(T),_=E(v),ee=E(A),te=E(I),W=E(h),ne=E($),re=E(B),pe=new Map([[X,z],[Y,D],[Z,T],[_,v],[ee,A],[te,I],[W,h],[ne,$],[re,B]]),d={[z]:(e,r,i)=>(e.setUint8(r,i),1),[D]:(e,r,i)=>(e.setInt8(r,i),1),[T]:(e,r,i)=>(e.setUint16(r,i),2),[v]:(e,r,i)=>(e.setInt16(r,i),2),[A]:(e,r,i)=>(e.setUint32(r,i),4),[I]:(e,r,i)=>(e.setInt32(r,i),4),[h]:(e,r,i)=>(e.setFloat32(r,i),4),[$]:(e,r,i)=>(e.setFloat64(r,i),8),[B]:(e,r,i)=>{let s=me.encode(i),y=0;return y+=d[A](e,r+y,s.length),new Uint8Array(e.buffer,e.byteOffset+r+y,s.length).set(s),y+=s.length,y}},S={[z]:(e,r)=>({value:e.getUint8(r),size:1}),[D]:(e,r)=>({value:e.getInt8(r),size:1}),[T]:(e,r)=>({value:e.getUint16(r),size:2}),[v]:(e,r)=>({value:e.getInt16(r),size:2}),[A]:(e,r)=>({value:e.getUint32(r),size:4}),[I]:(e,r)=>({value:e.getInt32(r),size:4}),[h]:(e,r)=>({value:e.getFloat32(r),size:4}),[$]:(e,r)=>({value:e.getFloat64(r),size:8}),[B]:(e,r)=>{let{value:i,size:t}=S[A](e,r),s=new Uint8Array(e.buffer,e.byteOffset+r+t,i);return{value:fe.decode(s),size:t+i}}};function M(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let r=pe.get(e);if(r)return r;throw new Error(`Unknown type function: ${e}`)}return C(e)?M(e[k]):h}var me=new TextEncoder,fe=new TextDecoder,be=(e=W)=>{let r=[];return Object.defineProperty(r,k,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function w(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function U(e){if(C(e))return M(e[k]);for(let r of[z,D,T,v,A,I,h,$,B])if(r in e)return r;return e instanceof Int8Array?D:e instanceof Uint8Array?z:e instanceof Int16Array?v:e instanceof Uint16Array?T:e instanceof Int32Array?I:e instanceof Uint32Array?A:e instanceof Float32Array?h:$}function C(e){return Array.isArray(e)&&k in e}function O(e){return e[k]}function V(e,r,i,t){let s=0,y=Array.isArray(r)?1:0;if(s+=d[z](i,t,y),!y)return s;s+=d[A](i,t+s,r.length);for(let n=0;n<r.length;n++){let a=r[n];if(C(e))s+=V(O(e),a,i,t+s);else{let o=M(e);s+=d[o](i,t+s,a)}}return s}function P(e,r,i){let t=0,s=S[z](r,i+t);if(t+=s.size,!s.value)return{size:t};let y=S[A](r,i+t);t+=y.size;let n=new Array(y.value);for(let a=0;a<n.length;a++)if(C(e)){let{value:o,size:l}=P(O(e),r,i+t);t+=l,Array.isArray(o)&&(n[a]=o)}else{let o=M(e),{value:l,size:u}=S[o](r,i+t);t+=u,n[a]=l}return{value:n,size:t}}var Ae=e=>{let r=U(e);return r===h||r===$},ge=(e,r)=>Ae(e)?r:0,de=(e,r)=>{let i=e.get(r);return i||(ArrayBuffer.isView(r)?i=new r.constructor(r.length):i=new Array(r.length).fill(0),e.set(r,i)),i},Q=(e,r,i,t=1e-4)=>{let s=de(e,r),y=r[i],n=ge(r,t),a=n>0?Math.abs(s[i]-y)>n:s[i]!==y;return s[i]=y,a},Se=(e,r=!1,i,t=1e-4)=>{if(w(e)){let a=U(e),o=d[a];return(l,u,c,p)=>{if(r&&i){if(!Q(i,e,c,t))return 0;let m=0;return m+=d[A](l,u+m,c),m+=d[A](l,u+m,p),m+=o(l,u+m,e[c]),m}else{let m=0;return m+=d[A](l,u+m,c),m+=o(l,u+m,e[c]),m}}}let s=Object.keys(e),n=s.map(a=>{let o=e[a];if(!w(o))throw new Error(`Invalid array type for property ${a}`);return U(o)}).map(a=>d[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,o,l,u)=>{if(r&&i){let c=0;for(let f=0;f<s.length;f++){let b=e[s[f]];Q(i,b,l,t)&&(c|=1<<f)}if(c===0)return 0;let p=0;p+=d[A](a,o+p,l),p+=d[A](a,o+p,u);let m=s.length<=8?d[z]:s.length<=16?d[T]:d[A];p+=m(a,o+p,c);for(let f=0;f<s.length;f++)if(c&1<<f){let b=e[s[f]];C(b)?p+=V(O(b),b[l],a,o+p):p+=n[f](a,o+p,b[l])}return p}else{let c=0;c+=d[A](a,o+c,l);for(let p=0;p<s.length;p++){let m=e[s[p]];C(m)?c+=V(O(m),m[l],a,o+c):c+=n[p](a,o+c,m[l])}return c}}},ze=(e,r=!1)=>{if(w(e)){let y=U(e),n=S[y];return(a,o,l)=>{let u=0,{value:c,size:p}=S[A](a,o);u+=p;let m=l?l.get(c)??c:c;if(r){let{size:g}=S[A](a,o+u);u+=g}let{value:f,size:b}=n(a,o+u);return e[m]=f,u+b}}let i=Object.keys(e),s=i.map(y=>{let n=e[y];if(!w(n))throw new Error(`Invalid array type for property ${y}`);return U(n)}).map(y=>S[y]||(()=>{throw new Error("Unsupported or unannotated type")}));return(y,n,a)=>{let o=0,{value:l,size:u}=S[A](y,n+o);o+=u;let c=a?a.get(l)??l:l;if(r){let{size:p}=S[A](y,n+o);o+=p;let m=i.length<=8?S[z]:i.length<=16?S[T]:S[A],{value:f,size:b}=m(y,n+o);o+=b;for(let g=0;g<i.length;g++)if(f&1<<g){let R=e[i[g]];if(C(R)){let{value:F,size:x}=P(O(R),y,n+o);Array.isArray(F)&&(R[c]=F),o+=x}else{let{value:F,size:x}=s[g](y,n+o);e[i[g]][c]=F,o+=x}}}else for(let p=0;p<i.length;p++){let m=e[i[p]];if(C(m)){let{value:f,size:b}=P(O(m),y,n+o);Array.isArray(f)&&(m[c]=f),o+=b}else{let{value:f,size:b}=s[p](y,n+o);e[i[p]][c]=f,o+=b}}return o}},N=(e,r={})=>{let{diff:i=!1,buffer:t=new ArrayBuffer(1024*1024*100),epsilon:s=1e-4}=r,y=new DataView(t),n=i?new Map:void 0,a=e.map(o=>Se(o,i,n,s));return o=>{let l=0;for(let u=0;u<o.length;u++){let c=o[u];for(let p=0;p<a.length;p++)l+=a[p](y,l,c,p)}return t.slice(0,l)}},G=(e,r={})=>{let{diff:i=!1}=r,t=e.map(s=>ze(s,i));return(s,y)=>{let n=new DataView(s),a=0;for(;a<s.byteLength;)if(i){let{value:o,size:l}=S[A](n,a),{value:u,size:c}=S[A](n,a+l);a+=t[u](n,a,y)}else for(let o=0;o<t.length;o++)a+=t[o](n,a,y)}};var Te=e=>{let r=U(e);return r===h||r===$},ie=(e,r)=>Te(e)?r:0,oe=(e,r)=>{let i=e.get(r);return i||(i=[],e.set(r,i)),i},L=(e,r,i,t)=>{let s=oe(e,r),y=r[i],n=s[i];if(y===void 0)return!1;if(n===void 0)return!0;if(typeof y=="object"&&y!==null){let a=r;for(let o in y)if(a[o]){let l=ie(a[o],t);if(l>0?Math.abs(n[o]-y[o])>l:n[o]!==y[o])return!0}return!1}else{let a=ie(r,t);return a>0?Math.abs(n-y)>a:n!==y}},ae=(e,r,i)=>{let t=oe(e,r),s=r[i];typeof s=="object"&&s!==null?t[i]={...s}:t[i]=s},he=(e,r,i,t=1e-4)=>{if(typeof e=="object"&&Object.keys(e).some(y=>isNaN(parseInt(y))&&typeof e[y]=="object")){let y=Object.keys(e).filter(o=>isNaN(parseInt(o))),a=y.map(o=>U(e[o])).map(o=>d[o]);return(o,l,u)=>{let c=e[u];if(c===void 0)return 0;if(r&&i){if(!L(i,e,u,t))return 0;ae(i,e,u)}let p=0;for(let m=0;m<y.length;m++){let f=e[y[m]],b=c[y[m]];C(f)?p+=V(O(f),b,o,l+p):p+=a[m](o,l+p,b)}return p}}else{let y=U(e),n=d[y];return(a,o,l)=>{let u=e[l];if(u===void 0)return 0;if(r&&i){if(!L(i,e,l,t))return 0;ae(i,e,l)}return n(a,o,u)}}},Re=e=>{if(typeof e=="object"&&Object.keys(e).some(i=>isNaN(parseInt(i))&&typeof e[i]=="object")){let i=Object.keys(e).filter(y=>isNaN(parseInt(y))),s=i.map(y=>U(e[y])).map(y=>S[y]);return(y,n,a)=>{let o=0,l={};for(let u=0;u<i.length;u++){let c=e[i[u]];if(C(c)){let{value:p,size:m}=P(O(c),y,n+o);Array.isArray(p)&&(l[i[u]]=p),o+=m}else{let{value:p,size:m}=s[u](y,n+o);l[i[u]]=p,o+=m}}return e[a]=l,o}}else{let i=U(e),t=S[i];return(s,y,n)=>{let{value:a,size:o}=t(s,y);return e[n]=a,o}}},De=(e,r={})=>{let{diff:i=!1,buffer:t=new ArrayBuffer(1024*1024*100),epsilon:s=1e-4}=r,y=new DataView(t),n=i?new Map:void 0,a=e.map(o=>he(o,i,n,s));return o=>{let l=0;for(let u=0;u<o.length;u++){let c=o[u];if(i){let p=!1;for(let g=0;g<e.length;g++)if(n&&L(n,e[g],c,s)){p=!0;break}if(!p)continue;l+=d[A](y,l,c);let m=l,f=e.length<=8?d[z]:e.length<=16?d[T]:d[A];l+=f===d[z]?1:f===d[T]?2:4;let b=0;for(let g=0;g<a.length;g++){let R=a[g](y,l,c);R>0&&(b|=1<<g,l+=R)}f(y,m,b)}else{l+=d[A](y,l,c);for(let p=0;p<a.length;p++)l+=a[p](y,l,c)}}return t.slice(0,l)}},ve=(e,r={})=>{let{diff:i=!1}=r,t=e.map(s=>Re(s));return(s,y)=>{let n=new DataView(s),a=0;for(;a<s.byteLength;){let{value:o,size:l}=S[A](n,a);a+=l;let u=y?y.get(o)??o:o;if(i){let c=e.length<=8?S[z]:e.length<=16?S[T]:S[A],{value:p,size:m}=c(n,a);a+=m;for(let f=0;f<e.length;f++)p&1<<f&&(a+=t[f](n,a,u))}else for(let c=0;c<t.length;c++)a+=t[c](n,a,u)}}};import{addComponent as se,hasComponent as Ie,getAllEntities as Ue,addEntity as ye,isRelation as le,getRelationTargets as Ce,Wildcard as rt}from"bitecs";function $e(e,r,i,t){if(!e)return t;if(Array.isArray(e)){let s=e[r];return s!==void 0?(i.setFloat64(t,s),t+8):t}if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let n=e[y],a=n[r];a!==void 0&&(n instanceof Int8Array||D in n?(i.setInt8(t,a),t+=1):n instanceof Uint8Array||z in n?(i.setUint8(t,a),t+=1):n instanceof Int16Array||v in n?(i.setInt16(t,a),t+=2):n instanceof Uint16Array||T in n?(i.setUint16(t,a),t+=2):n instanceof Int32Array||I in n?(i.setInt32(t,a),t+=4):n instanceof Uint32Array||A in n?(i.setUint32(t,a),t+=4):n instanceof Float32Array||h in n?(i.setFloat32(t,a),t+=4):(i.setFloat64(t,a),t+=8))}}return t}function Oe(e,r,i,t){if(!e)return t;if(Array.isArray(e))return e[r]=i.getFloat64(t),t+8;if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let n=e[y];n instanceof Int8Array||D in n?(n[r]=i.getInt8(t),t+=1):n instanceof Uint8Array||z in n?(n[r]=i.getUint8(t),t+=1):n instanceof Int16Array||v in n?(n[r]=i.getInt16(t),t+=2):n instanceof Uint16Array||T in n?(n[r]=i.getUint16(t),t+=2):n instanceof Int32Array||I in n?(n[r]=i.getInt32(t),t+=4):n instanceof Uint32Array||A in n?(n[r]=i.getUint32(t),t+=4):n instanceof Float32Array||h in n?(n[r]=i.getFloat32(t),t+=4):(n[r]=i.getFloat64(t),t+=8)}}return t}var Ee=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let t=new DataView(i),s=0,y=a=>{let o=a.length;t.setUint32(s,o),s+=4;for(let l=0;l<o;l++){let u=a[l],c=0;t.setUint32(s,u),s+=4;let p=s;s+=1;for(let m=0;m<r.length;m++){let f=r[m];if(le(f)){let b=Ce(e,u,f);for(let g of b){t.setUint8(s,m),s+=1,t.setUint32(s,g),s+=4;let R=f(g);s=$e(R,u,t,s),c++}}else Ie(e,u,f)&&(t.setUint8(s,m),s+=1,c++)}t.setUint8(p,c)}},n=a=>{let l=N(r,{buffer:i.slice(s)})(a);new Uint8Array(i).set(new Uint8Array(l),s),s+=l.byteLength};return()=>{s=0;let a=Ue(e);return y(a),n(a),i.slice(0,s)}},xe=(e,r,i)=>{let t=i||new Map,s=G(r);return(y,n)=>{let a=n||t,o=new DataView(y),l=0,u=o.getUint32(l);l+=4;for(let c=0;c<u;c++){let p=o.getUint32(l);l+=4;let m=a.get(p);m===void 0&&(m=ye(e),a.set(p,m));let f=o.getUint8(l);l+=1;for(let b=0;b<f;b++){let g=o.getUint8(l);l+=1;let R=r[g];if(le(R)){let F=o.getUint32(l);l+=4;let x=a.get(F);x===void 0&&(x=ye(e),a.set(F,x));let K=R(x);se(e,m,K),l=Oe(K,m,o,l)}else se(e,m,R)}}return s(y.slice(l),a),a}};import{addComponent as q,removeComponent as ue,addEntity as Fe,removeEntity as Be,observe as j,onAdd as H,onRemove as J,entityExists as je,isRelation as Ve,getRelationTargets as Pe,Wildcard as ce}from"bitecs";function ke(e,r,i,t){if(!e)return t;if(Array.isArray(e)){let s=e[r];return s!==void 0?(i.setFloat64(t,s),t+8):t}if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let n=e[y],a=n[r];a!==void 0&&(n instanceof Int8Array||D in n?(i.setInt8(t,a),t+=1):n instanceof Uint8Array||z in n?(i.setUint8(t,a),t+=1):n instanceof Int16Array||v in n?(i.setInt16(t,a),t+=2):n instanceof Uint16Array||T in n?(i.setUint16(t,a),t+=2):n instanceof Int32Array||I in n?(i.setInt32(t,a),t+=4):n instanceof Uint32Array||A in n?(i.setUint32(t,a),t+=4):n instanceof Float32Array||h in n?(i.setFloat32(t,a),t+=4):(i.setFloat64(t,a),t+=8))}}return t}function we(e,r,i,t){if(!e)return t;if(Array.isArray(e))return e[r]=i.getFloat64(t),t+8;if(typeof e=="object"){let s=Object.keys(e).sort();for(let y of s){let n=e[y];n instanceof Int8Array||D in n?(n[r]=i.getInt8(t),t+=1):n instanceof Uint8Array||z in n?(n[r]=i.getUint8(t),t+=1):n instanceof Int16Array||v in n?(n[r]=i.getInt16(t),t+=2):n instanceof Uint16Array||T in n?(n[r]=i.getUint16(t),t+=2):n instanceof Int32Array||I in n?(n[r]=i.getInt32(t),t+=4):n instanceof Uint32Array||A in n?(n[r]=i.getUint32(t),t+=4):n instanceof Float32Array||h in n?(n[r]=i.getFloat32(t),t+=4):(n[r]=i.getFloat64(t),t+=8)}}return t}var Me=(e,r,i,t=new ArrayBuffer(1024*1024*100))=>{let s=new DataView(t),y=0,n=[],a=new Map;return j(e,H(r),o=>{n.push([o,0,-1])}),j(e,J(r),o=>{n.push([o,1,-1]),a.delete(o)}),i.forEach((o,l)=>{Ve(o)?(j(e,H(r,o(ce)),u=>{let c=Pe(e,u,o);for(let p of c){a.has(u)||a.set(u,new Map),a.get(u).set(l,p);let m=o(p);n.push([u,4,l,p,m])}}),j(e,J(r,o(ce)),u=>{let c=a.get(u);if(c){let p=c.get(l);p!==void 0&&(n.push([u,5,l,p]),c.delete(l),c.size===0&&a.delete(u))}})):(j(e,H(r,o),u=>{n.push([u,2,l])}),j(e,J(r,o),u=>{n.push([u,3,l])}))}),()=>{y=0;for(let o=0;o<n.length;o++){let[l,u,c,p,m]=n[o];s.setUint32(y,l),y+=4,s.setUint8(y,u),y+=1,(u===2||u===3||u===4||u===5)&&(s.setUint8(y,c),y+=1,(u===4||u===5)&&(s.setUint32(y,p),y+=4,u===4&&m&&(y=ke(m,l,s,y))))}return n.length=0,t.slice(0,y)}},We=(e,r,i,t)=>{let s=t||new Map;return(y,n)=>{let a=n||s,o=new DataView(y),l=0;for(;l<y.byteLength;){let u=o.getUint32(l);l+=4;let c=o.getUint8(l);l+=1;let p=-1,m=-1;(c===2||c===3||c===4||c===5)&&(p=o.getUint8(l),l+=1,(c===4||c===5)&&(m=o.getUint32(l),l+=4));let f=i[p],b=a.get(u);if(c===0)b===void 0?(b=Fe(e),a.set(u,b),q(e,b,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(b!==void 0&&je(e,b)){if(c===1)Be(e,b),a.delete(u);else if(c===2)q(e,b,f);else if(c===3)ue(e,b,f);else if(c===4){let g=a.get(m);if(g!==void 0){let R=f(g);q(e,b,R),l=we(R,b,o,l)}}else if(c===5){let g=a.get(m);g!==void 0&&ue(e,b,f(g))}}}return a}};export{h as $f32,$ as $f64,v as $i16,I as $i32,D as $i8,B as $str,T as $u16,A as $u32,z as $u8,be as array,ve as createAoSDeserializer,De as createAoSSerializer,We as createObserverDeserializer,Me as createObserverSerializer,xe as createSnapshotDeserializer,Ee as createSnapshotSerializer,G as createSoADeserializer,N as createSoASerializer,W as f32,ne as f64,_ as i16,te as i32,Y as i8,re as str,Z as u16,ee as u32,X as u8};
//# sourceMappingURL=index.min.mjs.map
