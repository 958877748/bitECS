var g=Symbol("u8"),A=Symbol("i8"),d=Symbol("u16"),R=Symbol("i16"),b=Symbol("u32"),v=Symbol("i32"),U=Symbol("f32"),I=Symbol("f64"),D=t=>(n=[])=>Object.defineProperty(n,t,{value:!0,enumerable:!1,writable:!1,configurable:!1}),M=D(g),k=D(A),L=D(d),G=D(R),q=D(b),H=D(v),J=D(U),K=D(I),w={[g]:(t,n,a)=>(t.setUint8(n,a),1),[A]:(t,n,a)=>(t.setInt8(n,a),1),[d]:(t,n,a)=>(t.setUint16(n,a),2),[R]:(t,n,a)=>(t.setInt16(n,a),2),[b]:(t,n,a)=>(t.setUint32(n,a),4),[v]:(t,n,a)=>(t.setInt32(n,a),4),[U]:(t,n,a)=>(t.setFloat32(n,a),4),[I]:(t,n,a)=>(t.setFloat64(n,a),8)},T={[g]:(t,n)=>({value:t.getUint8(n),size:1}),[A]:(t,n)=>({value:t.getInt8(n),size:1}),[d]:(t,n)=>({value:t.getUint16(n),size:2}),[R]:(t,n)=>({value:t.getInt16(n),size:2}),[b]:(t,n)=>({value:t.getUint32(n),size:4}),[v]:(t,n)=>({value:t.getInt32(n),size:4}),[U]:(t,n)=>({value:t.getFloat32(n),size:4}),[I]:(t,n)=>({value:t.getFloat64(n),size:8})},N=t=>{let n=Object.keys(t),r=n.map(i=>{let o=t[i];for(let e of[g,A,d,R,b,v,U,I])if(e in o)return e;return I}).map(i=>w[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,o,e)=>{let l=0;l+=w[b](i,o+l,e);for(let s=0;s<n.length;s++)l+=r[s](i,o+l,t[n[s]][e]);return l}},Q=t=>{let n=Object.keys(t),r=n.map(i=>{let o=t[i];for(let e of[g,A,d,R,b,v,U,I])if(e in o)return e;return I}).map(i=>T[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,o,e)=>{let l=0,{value:s,size:m}=T[b](i,o+l);l+=m;let u=e?e.get(s)??s:s;for(let p=0;p<n.length;p++){let{value:y,size:c}=r[p](i,o+l);t[n[p]][u]=y,l+=c}return l}},h=(t,n=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(n),r=t.map(N);return i=>{let o=0;for(let e=0;e<i.length;e++){let l=i[e];for(let s=0;s<r.length;s++)o+=r[s](a,o,l)}return n.slice(0,o)}},E=t=>{let n=t.map(Q);return(a,r)=>{let i=new DataView(a),o=0;for(;o<a.byteLength;)for(let e=0;e<n.length;e++)o+=n[e](i,o,r)}};import{addComponent as B,hasComponent as X,getAllEntities as Y,addEntity as F,isRelation as V,getRelationTargets as Z}from"bitecs";var _=(t,n,a=new ArrayBuffer(1024*1024*100))=>{let r=new DataView(a),i=0,o=l=>{let s=l.length;r.setUint32(i,s),i+=4;for(let m=0;m<s;m++){let u=l[m],p=0;r.setUint32(i,u),i+=4;let y=i;i+=1;for(let c=0;c<n.length;c++){let f=n[c];if(V(f)){let C=Z(t,u,f);for(let S of C)r.setUint8(i,c),i+=1,r.setUint32(i,S),i+=4,p++}else X(t,u,f)&&(r.setUint8(i,c),i+=1,p++)}r.setUint8(y,p)}},e=l=>{let m=h(n,a.slice(i))(l);new Uint8Array(a).set(new Uint8Array(m),i),i+=m.byteLength};return()=>{i=0;let l=Y(t);return o(l),e(l),a.slice(0,i)}},ee=(t,n)=>{let a=E(n);return r=>{let i=new DataView(r),o=0,e=new Map,l=i.getUint32(o);o+=4;for(let s=0;s<l;s++){let m=i.getUint32(o);o+=4;let u=F(t);e.set(m,u);let p=i.getUint8(o);o+=1;for(let y=0;y<p;y++){let c=i.getUint8(o);o+=1;let f=n[c];if(V(f)){let C=i.getUint32(o);if(o+=4,!e.has(C)){let P=F(t);e.set(C,P)}let S=e.get(C);B(t,u,f(S))}else B(t,u,f)}}return a(r.slice(o),e),e}};import{addComponent as O,removeComponent as j,addEntity as te,removeEntity as ne,observe as z,onAdd as $,onRemove as x,entityExists as re,isRelation as ie,getRelationTargets as oe,Wildcard as W}from"bitecs";function ae(t,n,a,r){if(!t)return r;if(Array.isArray(t)){let i=t[n];return i!==void 0?(a.setFloat64(r,i),r+8):r}if(typeof t=="object"){let i=Object.keys(t).sort();for(let o of i){let e=t[o],l=e[n];l!==void 0&&(e instanceof Int8Array||A in e?(a.setInt8(r,l),r+=1):e instanceof Uint8Array||g in e?(a.setUint8(r,l),r+=1):e instanceof Int16Array||R in e?(a.setInt16(r,l),r+=2):e instanceof Uint16Array||d in e?(a.setUint16(r,l),r+=2):e instanceof Int32Array||v in e?(a.setInt32(r,l),r+=4):e instanceof Uint32Array||b in e?(a.setUint32(r,l),r+=4):e instanceof Float32Array||U in e?(a.setFloat32(r,l),r+=4):(a.setFloat64(r,l),r+=8))}}return r}function se(t,n,a,r){if(!t)return r;if(Array.isArray(t))return t[n]=a.getFloat64(r),r+8;if(typeof t=="object"){let i=Object.keys(t).sort();for(let o of i){let e=t[o];e instanceof Int8Array||A in e?(e[n]=a.getInt8(r),r+=1):e instanceof Uint8Array||g in e?(e[n]=a.getUint8(r),r+=1):e instanceof Int16Array||R in e?(e[n]=a.getInt16(r),r+=2):e instanceof Uint16Array||d in e?(e[n]=a.getUint16(r),r+=2):e instanceof Int32Array||v in e?(e[n]=a.getInt32(r),r+=4):e instanceof Uint32Array||b in e?(e[n]=a.getUint32(r),r+=4):e instanceof Float32Array||U in e?(e[n]=a.getFloat32(r),r+=4):(e[n]=a.getFloat64(r),r+=8)}}return r}var le=(t,n,a,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),o=0,e=[],l=new Map;return z(t,$(n),s=>{e.push([s,0,-1])}),z(t,x(n),s=>{e.push([s,1,-1]),l.delete(s)}),a.forEach((s,m)=>{ie(s)?(z(t,$(n,s(W)),u=>{let p=oe(t,u,s);for(let y of p){l.has(u)||l.set(u,new Map),l.get(u).set(m,y);let c=s(y);e.push([u,4,m,y,c])}}),z(t,x(n,s(W)),u=>{let p=l.get(u);if(p){let y=p.get(m);y!==void 0&&(e.push([u,5,m,y]),p.delete(m),p.size===0&&l.delete(u))}})):(z(t,$(n,s),u=>{e.push([u,2,m])}),z(t,x(n,s),u=>{e.push([u,3,m])}))}),()=>{o=0;for(let s=0;s<e.length;s++){let[m,u,p,y,c]=e[s];i.setUint32(o,m),o+=4,i.setUint8(o,u),o+=1,(u===2||u===3||u===4||u===5)&&(i.setUint8(o,p),o+=1,(u===4||u===5)&&(i.setUint32(o,y),o+=4,u===4&&c&&(o=ae(c,m,i,o))))}return e.length=0,r.slice(0,o)}},ue=(t,n,a,r=new Map)=>i=>{let o=new DataView(i),e=0;for(;e<i.byteLength;){let l=o.getUint32(e);e+=4;let s=o.getUint8(e);e+=1;let m=-1,u=-1;(s===2||s===3||s===4||s===5)&&(m=o.getUint8(e),e+=1,(s===4||s===5)&&(u=o.getUint32(e),e+=4));let p=a[m],y=r.get(l);if(s===0)if(y===void 0)y=te(t),r.set(l,y),O(t,y,n);else throw new Error(`Entity with ID ${l} already exists in the mapping.`);else if(y!==void 0&&re(t,y)){if(s===1)ne(t,y);else if(s===2)O(t,y,p);else if(s===3)j(t,y,p);else if(s===4){let c=r.get(u);if(c!==void 0){let f=p(c);O(t,y,f),e=se(f,y,o,e)}}else if(s===5){let c=r.get(u);c!==void 0&&j(t,y,p(c))}}}return r};export{ue as createObserverDeserializer,le as createObserverSerializer,ee as createSnapshotDeserializer,_ as createSnapshotSerializer,E as createSoADeserializer,h as createSoASerializer,J as f32,K as f64,G as i16,H as i32,k as i8,L as u16,q as u32,M as u8};
//# sourceMappingURL=index.min.mjs.map
