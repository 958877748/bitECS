var g=Symbol.for("bitecs-u8"),I=Symbol.for("bitecs-i8"),R=Symbol.for("bitecs-u16"),U=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),d=Symbol.for("bitecs-i32"),v=Symbol.for("bitecs-f32"),h=Symbol.for("bitecs-f64"),C=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),H=C(g),J=C(I),K=C(R),N=C(U),Q=C(A),X=C(d),Y=C(v),Z=C(h),T={[g]:(e,r,i)=>(e.setUint8(r,i),1),[I]:(e,r,i)=>(e.setInt8(r,i),1),[R]:(e,r,i)=>(e.setUint16(r,i),2),[U]:(e,r,i)=>(e.setInt16(r,i),2),[A]:(e,r,i)=>(e.setUint32(r,i),4),[d]:(e,r,i)=>(e.setInt32(r,i),4),[v]:(e,r,i)=>(e.setFloat32(r,i),4),[h]:(e,r,i)=>(e.setFloat64(r,i),8)},E={[g]:(e,r)=>({value:e.getUint8(r),size:1}),[I]:(e,r)=>({value:e.getInt8(r),size:1}),[R]:(e,r)=>({value:e.getUint16(r),size:2}),[U]:(e,r)=>({value:e.getInt16(r),size:2}),[A]:(e,r)=>({value:e.getUint32(r),size:4}),[d]:(e,r)=>({value:e.getInt32(r),size:4}),[v]:(e,r)=>({value:e.getFloat32(r),size:4}),[h]:(e,r)=>({value:e.getFloat64(r),size:8})};function O(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function x(e){for(let r of[g,I,R,U,A,d,v,h])if(r in e)return r;return e instanceof Int8Array?I:e instanceof Uint8Array?g:e instanceof Int16Array?U:e instanceof Uint16Array?R:e instanceof Int32Array?d:e instanceof Uint32Array?A:e instanceof Float32Array?v:h}var _=e=>{if(O(e)){let o=x(e),y=T[o];return(t,a,u)=>{let s=0;return s+=T[A](t,a,u),s+=y(t,a+s,e[u]),s}}let r=Object.keys(e),n=r.map(o=>{let y=e[o];if(!O(y))throw new Error(`Invalid array type for property ${o}`);return x(y)}).map(o=>T[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,y,t)=>{let a=0;a+=T[A](o,y+a,t);for(let u=0;u<r.length;u++)a+=n[u](o,y+a,e[r[u]][t]);return a}},ee=e=>{if(O(e)){let o=x(e),y=E[o];return(t,a,u)=>{let s=0,{value:l,size:c}=E[A](t,a);s+=c;let m=u?u.get(l)??l:l,{value:p,size:f}=y(t,a+s);return e[m]=p,s+f}}let r=Object.keys(e),n=r.map(o=>{let y=e[o];if(!O(y))throw new Error(`Invalid array type for property ${o}`);return x(y)}).map(o=>E[o]||(()=>{throw new Error("Unsupported or unannotated type")}));return(o,y,t)=>{let a=0,{value:u,size:s}=E[A](o,y+a);a+=s;let l=t?t.get(u)??u:u;for(let c=0;c<r.length;c++){let{value:m,size:p}=n[c](o,y+a);e[r[c]][l]=m,a+=p}return a}},B=(e,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),n=e.map(_);return o=>{let y=0;for(let t=0;t<o.length;t++){let a=o[t];for(let u=0;u<n.length;u++)y+=n[u](i,y,a)}return r.slice(0,y)}},F=e=>{let r=e.map(ee);return(i,n)=>{let o=new DataView(i),y=0;for(;y<i.byteLength;)for(let t=0;t<r.length;t++)y+=r[t](o,y,n)}};import{addComponent as w,hasComponent as te,getAllEntities as ne,addEntity as L,isRelation as V,getRelationTargets as re,Wildcard as ve,query as Ce}from"bitecs";function ie(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let o=e[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y],a=t[r];a!==void 0&&(t instanceof Int8Array||I in t?(i.setInt8(n,a),n+=1):t instanceof Uint8Array||g in t?(i.setUint8(n,a),n+=1):t instanceof Int16Array||U in t?(i.setInt16(n,a),n+=2):t instanceof Uint16Array||R in t?(i.setUint16(n,a),n+=2):t instanceof Int32Array||d in t?(i.setInt32(n,a),n+=4):t instanceof Uint32Array||A in t?(i.setUint32(n,a),n+=4):t instanceof Float32Array||v in t?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function oe(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y];t instanceof Int8Array||I in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||g in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||U in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||R in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||d in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||v in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var ae=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),o=0,y=a=>{let u=a.length;n.setUint32(o,u),o+=4;for(let s=0;s<u;s++){let l=a[s],c=0;n.setUint32(o,l),o+=4;let m=o;o+=1;for(let p=0;p<r.length;p++){let f=r[p];if(V(f)){let b=re(e,l,f);for(let D of b){n.setUint8(o,p),o+=1,n.setUint32(o,D),o+=4;let z=f(D);o=ie(z,l,n,o),c++}}else te(e,l,f)&&(n.setUint8(o,p),o+=1,c++)}n.setUint8(m,c)}},t=a=>{let s=B(r,i.slice(o))(a);new Uint8Array(i).set(new Uint8Array(s),o),o+=s.byteLength};return()=>{o=0;let a=ne(e);return y(a),t(a),i.slice(0,o)}},se=(e,r,i)=>{let n=i||new Map,o=F(r);return(y,t)=>{let a=t||n,u=new DataView(y),s=0,l=u.getUint32(s);s+=4;for(let c=0;c<l;c++){let m=u.getUint32(s);s+=4;let p=a.get(m);p===void 0&&(p=L(e),a.set(m,p));let f=u.getUint8(s);s+=1;for(let b=0;b<f;b++){let D=u.getUint8(s);s+=1;let z=r[D];if(V(z)){let k=u.getUint32(s);s+=4;let $=a.get(k);$===void 0&&($=L(e),a.set(k,$));let W=z($);w(e,p,W),s=oe(W,p,u,s)}else w(e,p,z)}}return o(y.slice(s),a),a}};import{addComponent as M,removeComponent as q,addEntity as ye,removeEntity as ue,observe as S,onAdd as P,onRemove as j,entityExists as le,isRelation as ce,getRelationTargets as pe,Wildcard as G}from"bitecs";function me(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let o=e[r];return o!==void 0?(i.setFloat64(n,o),n+8):n}if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y],a=t[r];a!==void 0&&(t instanceof Int8Array||I in t?(i.setInt8(n,a),n+=1):t instanceof Uint8Array||g in t?(i.setUint8(n,a),n+=1):t instanceof Int16Array||U in t?(i.setInt16(n,a),n+=2):t instanceof Uint16Array||R in t?(i.setUint16(n,a),n+=2):t instanceof Int32Array||d in t?(i.setInt32(n,a),n+=4):t instanceof Uint32Array||A in t?(i.setUint32(n,a),n+=4):t instanceof Float32Array||v in t?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function be(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let o=Object.keys(e).sort();for(let y of o){let t=e[y];t instanceof Int8Array||I in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||g in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||U in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||R in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||d in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||v in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var Ae=(e,r,i,n=new ArrayBuffer(1024*1024*100))=>{let o=new DataView(n),y=0,t=[],a=new Map;return S(e,P(r),u=>{t.push([u,0,-1])}),S(e,j(r),u=>{t.push([u,1,-1]),a.delete(u)}),i.forEach((u,s)=>{ce(u)?(S(e,P(r,u(G)),l=>{let c=pe(e,l,u);for(let m of c){a.has(l)||a.set(l,new Map),a.get(l).set(s,m);let p=u(m);t.push([l,4,s,m,p])}}),S(e,j(r,u(G)),l=>{let c=a.get(l);if(c){let m=c.get(s);m!==void 0&&(t.push([l,5,s,m]),c.delete(s),c.size===0&&a.delete(l))}})):(S(e,P(r,u),l=>{t.push([l,2,s])}),S(e,j(r,u),l=>{t.push([l,3,s])}))}),()=>{y=0;for(let u=0;u<t.length;u++){let[s,l,c,m,p]=t[u];o.setUint32(y,s),y+=4,o.setUint8(y,l),y+=1,(l===2||l===3||l===4||l===5)&&(o.setUint8(y,c),y+=1,(l===4||l===5)&&(o.setUint32(y,m),y+=4,l===4&&p&&(y=me(p,s,o,y))))}return t.length=0,n.slice(0,y)}},fe=(e,r,i,n)=>{let o=n||new Map;return(y,t)=>{let a=t||o,u=new DataView(y),s=0;for(;s<y.byteLength;){let l=u.getUint32(s);s+=4;let c=u.getUint8(s);s+=1;let m=-1,p=-1;(c===2||c===3||c===4||c===5)&&(m=u.getUint8(s),s+=1,(c===4||c===5)&&(p=u.getUint32(s),s+=4));let f=i[m],b=a.get(l);if(c===0)b===void 0&&(b=ye(e),a.set(l,b),M(e,b,r));else if(b!==void 0&&le(e,b)){if(c===1)ue(e,b);else if(c===2)M(e,b,f);else if(c===3)q(e,b,f);else if(c===4){let D=a.get(p);if(D!==void 0){let z=f(D);M(e,b,z),s=be(z,b,u,s)}}else if(c===5){let D=a.get(p);D!==void 0&&q(e,b,f(D))}}}return a}};export{fe as createObserverDeserializer,Ae as createObserverSerializer,se as createSnapshotDeserializer,ae as createSnapshotSerializer,F as createSoADeserializer,B as createSoASerializer,Y as f32,Z as f64,N as i16,X as i32,J as i8,K as u16,Q as u32,H as u8};
//# sourceMappingURL=index.min.mjs.map
