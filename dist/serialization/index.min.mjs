var g=Symbol.for("bitecs-u8"),I=Symbol.for("bitecs-i8"),R=Symbol.for("bitecs-u16"),U=Symbol.for("bitecs-i16"),b=Symbol.for("bitecs-u32"),z=Symbol.for("bitecs-i32"),d=Symbol.for("bitecs-f32"),h=Symbol.for("bitecs-f64"),P=Symbol.for("bitecs-arr"),T=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),X=T(g),Y=T(I),Z=T(R),_=T(U),ee=T(b),te=T(z),ne=T(d),re=T(h),S={[g]:(e,r,i)=>(e.setUint8(r,i),1),[I]:(e,r,i)=>(e.setInt8(r,i),1),[R]:(e,r,i)=>(e.setUint16(r,i),2),[U]:(e,r,i)=>(e.setInt16(r,i),2),[b]:(e,r,i)=>(e.setUint32(r,i),4),[z]:(e,r,i)=>(e.setInt32(r,i),4),[d]:(e,r,i)=>(e.setFloat32(r,i),4),[h]:(e,r,i)=>(e.setFloat64(r,i),8)},$={[g]:(e,r)=>({value:e.getUint8(r),size:1}),[I]:(e,r)=>({value:e.getInt8(r),size:1}),[R]:(e,r)=>({value:e.getUint16(r),size:2}),[U]:(e,r)=>({value:e.getInt16(r),size:2}),[b]:(e,r)=>({value:e.getUint32(r),size:4}),[z]:(e,r)=>({value:e.getInt32(r),size:4}),[d]:(e,r)=>({value:e.getFloat32(r),size:4}),[h]:(e,r)=>({value:e.getFloat64(r),size:8})},ie=(e=d)=>{let r=[];return Object.defineProperty(r,P,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function x(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function O(e){for(let r of[g,I,R,U,b,z,d,h])if(r in e)return r;return e instanceof Int8Array?I:e instanceof Uint8Array?g:e instanceof Int16Array?U:e instanceof Uint16Array?R:e instanceof Int32Array?z:e instanceof Uint32Array?b:e instanceof Float32Array?d:h}function B(e){return Array.isArray(e)&&P in e}function F(e){return e[P]}function q(e,r,i,t){let a=0,y=Array.isArray(r)?1:0;if(a+=S[g](i,t,y),!y)return a;a+=S[b](i,t+a,r.length);for(let n=0;n<r.length;n++){let o=r[n];B(e)?a+=q(F(e),o,i,t+a):typeof e=="symbol"&&(a+=S[e](i,t+a,o))}return a}function G(e,r,i){let t=0,a=$[g](r,i+t);if(t+=a.size,!a.value)return{size:t};let y=$[b](r,i+t);t+=y.size;let n=new Array(y.value);for(let o=0;o<n.length;o++)if(B(e)){let{value:l,size:s}=G(F(e),r,i+t);t+=s,Array.isArray(l)&&(n[o]=l)}else{let{value:l,size:s}=$[e](r,i+t);t+=s,n[o]=l}return{value:n,size:t}}var ae=e=>{if(x(e)){let a=O(e),y=S[a];return(n,o,l)=>{let s=0;return s+=S[b](n,o,l),s+=y(n,o+s,e[l]),s}}let r=Object.keys(e),t=r.map(a=>{let y=e[a];if(!x(y))throw new Error(`Invalid array type for property ${a}`);return O(y)}).map(a=>S[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,y,n)=>{let o=0;o+=S[b](a,y+o,n);for(let l=0;l<r.length;l++){let s=e[r[l]];B(s)?o+=q(F(s),s[n],a,y+o):o+=t[l](a,y+o,s[n])}return o}},oe=e=>{if(x(e)){let a=O(e),y=$[a];return(n,o,l)=>{let s=0,{value:u,size:c}=$[b](n,o);s+=c;let m=l?l.get(u)??u:u,{value:p,size:A}=y(n,o+s);return e[m]=p,s+A}}let r=Object.keys(e),t=r.map(a=>{let y=e[a];if(!x(y))throw new Error(`Invalid array type for property ${a}`);return O(y)}).map(a=>$[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,y,n)=>{let o=0,{value:l,size:s}=$[b](a,y+o);o+=s;let u=n?n.get(l)??l:l;for(let c=0;c<r.length;c++){let m=e[r[c]];if(B(m)){let{value:p,size:A}=G(F(m),a,y+o);Array.isArray(p)&&(m[u]=p),o+=A}else{let{value:p,size:A}=t[c](a,y+o);e[r[c]][u]=p,o+=A}}return o}},M=(e,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),t=e.map(ae);return a=>{let y=0;for(let n=0;n<a.length;n++){let o=a[n];for(let l=0;l<t.length;l++)y+=t[l](i,y,o)}return r.slice(0,y)}},j=e=>{let r=e.map(oe);return(i,t)=>{let a=new DataView(i),y=0;for(;y<i.byteLength;)for(let n=0;n<r.length;n++)y+=r[n](a,y,t)}};import{addComponent as H,hasComponent as se,getAllEntities as ye,addEntity as J,isRelation as K,getRelationTargets as le,Wildcard as he}from"bitecs";function ue(e,r,i,t){if(!e)return t;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(t,a),t+8):t}if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let n=e[y],o=n[r];o!==void 0&&(n instanceof Int8Array||I in n?(i.setInt8(t,o),t+=1):n instanceof Uint8Array||g in n?(i.setUint8(t,o),t+=1):n instanceof Int16Array||U in n?(i.setInt16(t,o),t+=2):n instanceof Uint16Array||R in n?(i.setUint16(t,o),t+=2):n instanceof Int32Array||z in n?(i.setInt32(t,o),t+=4):n instanceof Uint32Array||b in n?(i.setUint32(t,o),t+=4):n instanceof Float32Array||d in n?(i.setFloat32(t,o),t+=4):(i.setFloat64(t,o),t+=8))}}return t}function ce(e,r,i,t){if(!e)return t;if(Array.isArray(e))return e[r]=i.getFloat64(t),t+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let n=e[y];n instanceof Int8Array||I in n?(n[r]=i.getInt8(t),t+=1):n instanceof Uint8Array||g in n?(n[r]=i.getUint8(t),t+=1):n instanceof Int16Array||U in n?(n[r]=i.getInt16(t),t+=2):n instanceof Uint16Array||R in n?(n[r]=i.getUint16(t),t+=2):n instanceof Int32Array||z in n?(n[r]=i.getInt32(t),t+=4):n instanceof Uint32Array||b in n?(n[r]=i.getUint32(t),t+=4):n instanceof Float32Array||d in n?(n[r]=i.getFloat32(t),t+=4):(n[r]=i.getFloat64(t),t+=8)}}return t}var pe=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let t=new DataView(i),a=0,y=o=>{let l=o.length;t.setUint32(a,l),a+=4;for(let s=0;s<l;s++){let u=o[s],c=0;t.setUint32(a,u),a+=4;let m=a;a+=1;for(let p=0;p<r.length;p++){let A=r[p];if(K(A)){let f=le(e,u,A);for(let D of f){t.setUint8(a,p),a+=1,t.setUint32(a,D),a+=4;let v=A(D);a=ue(v,u,t,a),c++}}else se(e,u,A)&&(t.setUint8(a,p),a+=1,c++)}t.setUint8(m,c)}},n=o=>{let s=M(r,i.slice(a))(o);new Uint8Array(i).set(new Uint8Array(s),a),a+=s.byteLength};return()=>{a=0;let o=ye(e);return y(o),n(o),i.slice(0,a)}},me=(e,r,i)=>{let t=i||new Map,a=j(r);return(y,n)=>{let o=n||t,l=new DataView(y),s=0,u=l.getUint32(s);s+=4;for(let c=0;c<u;c++){let m=l.getUint32(s);s+=4;let p=o.get(m);p===void 0&&(p=J(e),o.set(m,p));let A=l.getUint8(s);s+=1;for(let f=0;f<A;f++){let D=l.getUint8(s);s+=1;let v=r[D];if(K(v)){let V=l.getUint32(s);s+=4;let E=o.get(V);E===void 0&&(E=J(e),o.set(V,E));let L=v(E);H(e,p,L),s=ce(L,p,l,s)}else H(e,p,v)}}return a(y.slice(s),o),o}};import{addComponent as k,removeComponent as N,addEntity as be,removeEntity as Ae,observe as C,onAdd as W,onRemove as w,entityExists as fe,isRelation as ge,getRelationTargets as de,Wildcard as Q}from"bitecs";function Ie(e,r,i,t){if(!e)return t;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(t,a),t+8):t}if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let n=e[y],o=n[r];o!==void 0&&(n instanceof Int8Array||I in n?(i.setInt8(t,o),t+=1):n instanceof Uint8Array||g in n?(i.setUint8(t,o),t+=1):n instanceof Int16Array||U in n?(i.setInt16(t,o),t+=2):n instanceof Uint16Array||R in n?(i.setUint16(t,o),t+=2):n instanceof Int32Array||z in n?(i.setInt32(t,o),t+=4):n instanceof Uint32Array||b in n?(i.setUint32(t,o),t+=4):n instanceof Float32Array||d in n?(i.setFloat32(t,o),t+=4):(i.setFloat64(t,o),t+=8))}}return t}function Re(e,r,i,t){if(!e)return t;if(Array.isArray(e))return e[r]=i.getFloat64(t),t+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let n=e[y];n instanceof Int8Array||I in n?(n[r]=i.getInt8(t),t+=1):n instanceof Uint8Array||g in n?(n[r]=i.getUint8(t),t+=1):n instanceof Int16Array||U in n?(n[r]=i.getInt16(t),t+=2):n instanceof Uint16Array||R in n?(n[r]=i.getUint16(t),t+=2):n instanceof Int32Array||z in n?(n[r]=i.getInt32(t),t+=4):n instanceof Uint32Array||b in n?(n[r]=i.getUint32(t),t+=4):n instanceof Float32Array||d in n?(n[r]=i.getFloat32(t),t+=4):(n[r]=i.getFloat64(t),t+=8)}}return t}var Ue=(e,r,i,t=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(t),y=0,n=[],o=new Map;return C(e,W(r),l=>{n.push([l,0,-1])}),C(e,w(r),l=>{n.push([l,1,-1]),o.delete(l)}),i.forEach((l,s)=>{ge(l)?(C(e,W(r,l(Q)),u=>{let c=de(e,u,l);for(let m of c){o.has(u)||o.set(u,new Map),o.get(u).set(s,m);let p=l(m);n.push([u,4,s,m,p])}}),C(e,w(r,l(Q)),u=>{let c=o.get(u);if(c){let m=c.get(s);m!==void 0&&(n.push([u,5,s,m]),c.delete(s),c.size===0&&o.delete(u))}})):(C(e,W(r,l),u=>{n.push([u,2,s])}),C(e,w(r,l),u=>{n.push([u,3,s])}))}),()=>{y=0;for(let l=0;l<n.length;l++){let[s,u,c,m,p]=n[l];a.setUint32(y,s),y+=4,a.setUint8(y,u),y+=1,(u===2||u===3||u===4||u===5)&&(a.setUint8(y,c),y+=1,(u===4||u===5)&&(a.setUint32(y,m),y+=4,u===4&&p&&(y=Ie(p,s,a,y))))}return n.length=0,t.slice(0,y)}},ze=(e,r,i,t)=>{let a=t||new Map;return(y,n)=>{let o=n||a,l=new DataView(y),s=0;for(;s<y.byteLength;){let u=l.getUint32(s);s+=4;let c=l.getUint8(s);s+=1;let m=-1,p=-1;(c===2||c===3||c===4||c===5)&&(m=l.getUint8(s),s+=1,(c===4||c===5)&&(p=l.getUint32(s),s+=4));let A=i[m],f=o.get(u);if(c===0)f===void 0?(f=be(e),o.set(u,f),k(e,f,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(f!==void 0&&fe(e,f)){if(c===1)Ae(e,f),o.delete(u);else if(c===2)k(e,f,A);else if(c===3)N(e,f,A);else if(c===4){let D=o.get(p);if(D!==void 0){let v=A(D);k(e,f,v),s=Re(v,f,l,s)}}else if(c===5){let D=o.get(p);D!==void 0&&N(e,f,A(D))}}}return o}};export{d as $f32,h as $f64,U as $i16,z as $i32,I as $i8,R as $u16,b as $u32,g as $u8,ie as array,ze as createObserverDeserializer,Ue as createObserverSerializer,me as createSnapshotDeserializer,pe as createSnapshotSerializer,j as createSoADeserializer,M as createSoASerializer,ne as f32,re as f64,_ as i16,te as i32,Y as i8,Z as u16,ee as u32,X as u8};
//# sourceMappingURL=index.min.mjs.map
