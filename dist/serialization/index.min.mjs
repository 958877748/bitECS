var g=Symbol.for("bitecs-u8"),T=Symbol.for("bitecs-i8"),I=Symbol.for("bitecs-u16"),R=Symbol.for("bitecs-i16"),b=Symbol.for("bitecs-u32"),U=Symbol.for("bitecs-i32"),d=Symbol.for("bitecs-f32"),h=Symbol.for("bitecs-f64"),E=Symbol.for("bitecs-arr"),v=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),H=v(g),J=v(T),K=v(I),N=v(R),Q=v(b),X=v(U),j=v(d),Y=v(h),ae=new Map([[H,g],[J,T],[K,I],[N,R],[Q,b],[X,U],[j,d],[Y,h]]),S={[g]:(e,r,i)=>(e.setUint8(r,i),1),[T]:(e,r,i)=>(e.setInt8(r,i),1),[I]:(e,r,i)=>(e.setUint16(r,i),2),[R]:(e,r,i)=>(e.setInt16(r,i),2),[b]:(e,r,i)=>(e.setUint32(r,i),4),[U]:(e,r,i)=>(e.setInt32(r,i),4),[d]:(e,r,i)=>(e.setFloat32(r,i),4),[h]:(e,r,i)=>(e.setFloat64(r,i),8)},$={[g]:(e,r)=>({value:e.getUint8(r),size:1}),[T]:(e,r)=>({value:e.getInt8(r),size:1}),[I]:(e,r)=>({value:e.getUint16(r),size:2}),[R]:(e,r)=>({value:e.getInt16(r),size:2}),[b]:(e,r)=>({value:e.getUint32(r),size:4}),[U]:(e,r)=>({value:e.getInt32(r),size:4}),[d]:(e,r)=>({value:e.getFloat32(r),size:4}),[h]:(e,r)=>({value:e.getFloat64(r),size:8})};function M(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let r=ae.get(e);if(r)return r;throw new Error(`Unknown type function: ${e}`)}return C(e)?M(e[E]):d}var oe=(e=j)=>{let r=[];return Object.defineProperty(r,E,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function O(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function B(e){if(C(e))return M(e[E]);for(let r of[g,T,I,R,b,U,d,h])if(r in e)return r;return e instanceof Int8Array?T:e instanceof Uint8Array?g:e instanceof Int16Array?R:e instanceof Uint16Array?I:e instanceof Int32Array?U:e instanceof Uint32Array?b:e instanceof Float32Array?d:h}function C(e){return Array.isArray(e)&&E in e}function P(e){return e[E]}function Z(e,r,i,n){let a=0,s=Array.isArray(r)?1:0;if(a+=S[g](i,n,s),!s)return a;a+=S[b](i,n+a,r.length);for(let t=0;t<r.length;t++){let o=r[t];if(C(e))a+=Z(P(e),o,i,n+a);else{let u=M(e);a+=S[u](i,n+a,o)}}return a}function _(e,r,i){let n=0,a=$[g](r,i+n);if(n+=a.size,!a.value)return{size:n};let s=$[b](r,i+n);n+=s.size;let t=new Array(s.value);for(let o=0;o<t.length;o++)if(C(e)){let{value:u,size:y}=_(P(e),r,i+n);n+=y,Array.isArray(u)&&(t[o]=u)}else{let u=M(e),{value:y,size:l}=$[u](r,i+n);n+=l,t[o]=y}return{value:t,size:n}}var ye=e=>{if(O(e)){let a=B(e),s=S[a];return(t,o,u)=>{let y=0;return y+=S[b](t,o,u),y+=s(t,o+y,e[u]),y}}let r=Object.keys(e),n=r.map(a=>{let s=e[a];if(!O(s))throw new Error(`Invalid array type for property ${a}`);return B(s)}).map(a=>S[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,s,t)=>{let o=0;o+=S[b](a,s+o,t);for(let u=0;u<r.length;u++){let y=e[r[u]];C(y)?o+=Z(P(y),y[t],a,s+o):o+=n[u](a,s+o,y[t])}return o}},se=e=>{if(O(e)){let a=B(e),s=$[a];return(t,o,u)=>{let y=0,{value:l,size:p}=$[b](t,o);y+=p;let m=u?u.get(l)??l:l,{value:c,size:A}=s(t,o+y);return e[m]=c,y+A}}let r=Object.keys(e),n=r.map(a=>{let s=e[a];if(!O(s))throw new Error(`Invalid array type for property ${a}`);return B(s)}).map(a=>$[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,s,t)=>{let o=0,{value:u,size:y}=$[b](a,s+o);o+=y;let l=t?t.get(u)??u:u;for(let p=0;p<r.length;p++){let m=e[r[p]];if(C(m)){let{value:c,size:A}=_(P(m),a,s+o);Array.isArray(c)&&(m[l]=c),o+=A}else{let{value:c,size:A}=n[p](a,s+o);e[r[p]][l]=c,o+=A}}return o}},k=(e,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),n=e.map(ye);return a=>{let s=0;for(let t=0;t<a.length;t++){let o=a[t];for(let u=0;u<n.length;u++)s+=n[u](i,s,o)}return r.slice(0,s)}},w=e=>{let r=e.map(se);return(i,n)=>{let a=new DataView(i),s=0;for(;s<i.byteLength;)for(let t=0;t<r.length;t++)s+=r[t](a,s,n)}};import{addComponent as ee,hasComponent as ue,getAllEntities as le,addEntity as ne,isRelation as te,getRelationTargets as pe,Wildcard as Fe}from"bitecs";function ce(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s],o=t[r];o!==void 0&&(t instanceof Int8Array||T in t?(i.setInt8(n,o),n+=1):t instanceof Uint8Array||g in t?(i.setUint8(n,o),n+=1):t instanceof Int16Array||R in t?(i.setInt16(n,o),n+=2):t instanceof Uint16Array||I in t?(i.setUint16(n,o),n+=2):t instanceof Int32Array||U in t?(i.setInt32(n,o),n+=4):t instanceof Uint32Array||b in t?(i.setUint32(n,o),n+=4):t instanceof Float32Array||d in t?(i.setFloat32(n,o),n+=4):(i.setFloat64(n,o),n+=8))}}return n}function me(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s];t instanceof Int8Array||T in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||g in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||R in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||I in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||U in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||b in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||d in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var be=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),a=0,s=o=>{let u=o.length;n.setUint32(a,u),a+=4;for(let y=0;y<u;y++){let l=o[y],p=0;n.setUint32(a,l),a+=4;let m=a;a+=1;for(let c=0;c<r.length;c++){let A=r[c];if(te(A)){let f=pe(e,l,A);for(let z of f){n.setUint8(a,c),a+=1,n.setUint32(a,z),a+=4;let D=A(z);a=ce(D,l,n,a),p++}}else ue(e,l,A)&&(n.setUint8(a,c),a+=1,p++)}n.setUint8(m,p)}},t=o=>{let y=k(r,i.slice(a))(o);new Uint8Array(i).set(new Uint8Array(y),a),a+=y.byteLength};return()=>{a=0;let o=le(e);return s(o),t(o),i.slice(0,a)}},Ae=(e,r,i)=>{let n=i||new Map,a=w(r);return(s,t)=>{let o=t||n,u=new DataView(s),y=0,l=u.getUint32(y);y+=4;for(let p=0;p<l;p++){let m=u.getUint32(y);y+=4;let c=o.get(m);c===void 0&&(c=ne(e),o.set(m,c));let A=u.getUint8(y);y+=1;for(let f=0;f<A;f++){let z=u.getUint8(y);y+=1;let D=r[z];if(te(D)){let q=u.getUint32(y);y+=4;let x=o.get(q);x===void 0&&(x=ne(e),o.set(q,x));let G=D(x);ee(e,c,G),y=me(G,c,u,y)}else ee(e,c,D)}}return a(s.slice(y),o),o}};import{addComponent as W,removeComponent as re,addEntity as fe,removeEntity as ge,observe as F,onAdd as V,onRemove as L,entityExists as de,isRelation as Te,getRelationTargets as Ie,Wildcard as ie}from"bitecs";function Re(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s],o=t[r];o!==void 0&&(t instanceof Int8Array||T in t?(i.setInt8(n,o),n+=1):t instanceof Uint8Array||g in t?(i.setUint8(n,o),n+=1):t instanceof Int16Array||R in t?(i.setInt16(n,o),n+=2):t instanceof Uint16Array||I in t?(i.setUint16(n,o),n+=2):t instanceof Int32Array||U in t?(i.setInt32(n,o),n+=4):t instanceof Uint32Array||b in t?(i.setUint32(n,o),n+=4):t instanceof Float32Array||d in t?(i.setFloat32(n,o),n+=4):(i.setFloat64(n,o),n+=8))}}return n}function Ue(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let s of a){let t=e[s];t instanceof Int8Array||T in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||g in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||R in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||I in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||U in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||b in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||d in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var ze=(e,r,i,n=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(n),s=0,t=[],o=new Map;return F(e,V(r),u=>{t.push([u,0,-1])}),F(e,L(r),u=>{t.push([u,1,-1]),o.delete(u)}),i.forEach((u,y)=>{Te(u)?(F(e,V(r,u(ie)),l=>{let p=Ie(e,l,u);for(let m of p){o.has(l)||o.set(l,new Map),o.get(l).set(y,m);let c=u(m);t.push([l,4,y,m,c])}}),F(e,L(r,u(ie)),l=>{let p=o.get(l);if(p){let m=p.get(y);m!==void 0&&(t.push([l,5,y,m]),p.delete(y),p.size===0&&o.delete(l))}})):(F(e,V(r,u),l=>{t.push([l,2,y])}),F(e,L(r,u),l=>{t.push([l,3,y])}))}),()=>{s=0;for(let u=0;u<t.length;u++){let[y,l,p,m,c]=t[u];a.setUint32(s,y),s+=4,a.setUint8(s,l),s+=1,(l===2||l===3||l===4||l===5)&&(a.setUint8(s,p),s+=1,(l===4||l===5)&&(a.setUint32(s,m),s+=4,l===4&&c&&(s=Re(c,y,a,s))))}return t.length=0,n.slice(0,s)}},De=(e,r,i,n)=>{let a=n||new Map;return(s,t)=>{let o=t||a,u=new DataView(s),y=0;for(;y<s.byteLength;){let l=u.getUint32(y);y+=4;let p=u.getUint8(y);y+=1;let m=-1,c=-1;(p===2||p===3||p===4||p===5)&&(m=u.getUint8(y),y+=1,(p===4||p===5)&&(c=u.getUint32(y),y+=4));let A=i[m],f=o.get(l);if(p===0)f===void 0?(f=fe(e),o.set(l,f),W(e,f,r)):console.warn(`Attempted to deserialize addEntity with ID ${l}, but it has already been deserialzied and exists in the mapping.`);else if(f!==void 0&&de(e,f)){if(p===1)ge(e,f),o.delete(l);else if(p===2)W(e,f,A);else if(p===3)re(e,f,A);else if(p===4){let z=o.get(c);if(z!==void 0){let D=A(z);W(e,f,D),y=Ue(D,f,u,y)}}else if(p===5){let z=o.get(c);z!==void 0&&re(e,f,A(z))}}}return o}};export{d as $f32,h as $f64,R as $i16,U as $i32,T as $i8,I as $u16,b as $u32,g as $u8,oe as array,De as createObserverDeserializer,ze as createObserverSerializer,Ae as createSnapshotDeserializer,be as createSnapshotSerializer,w as createSoADeserializer,k as createSoASerializer,j as f32,Y as f64,N as i16,X as i32,J as i8,K as u16,Q as u32,H as u8};
//# sourceMappingURL=index.min.mjs.map
