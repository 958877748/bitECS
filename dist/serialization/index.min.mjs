var v=Symbol("u8"),D=Symbol("i8"),w=Symbol("u16"),z=Symbol("i16"),b=Symbol("u32"),C=Symbol("i32"),S=Symbol("f32"),g=Symbol("f64"),c=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),j=c(v),L=c(D),G=c(w),q=c(z),H=c(b),J=c(C),K=c(S),N=c(g),O={[v]:(e,t,m)=>(e.setUint8(t,m),1),[D]:(e,t,m)=>(e.setInt8(t,m),1),[w]:(e,t,m)=>(e.setUint16(t,m),2),[z]:(e,t,m)=>(e.setInt16(t,m),2),[b]:(e,t,m)=>(e.setUint32(t,m),4),[C]:(e,t,m)=>(e.setInt32(t,m),4),[S]:(e,t,m)=>(e.setFloat32(t,m),4),[g]:(e,t,m)=>(e.setFloat64(t,m),8)},T={[v]:(e,t)=>({value:e.getUint8(t),size:1}),[D]:(e,t)=>({value:e.getInt8(t),size:1}),[w]:(e,t)=>({value:e.getUint16(t),size:2}),[z]:(e,t)=>({value:e.getInt16(t),size:2}),[b]:(e,t)=>({value:e.getUint32(t),size:4}),[C]:(e,t)=>({value:e.getInt32(t),size:4}),[S]:(e,t)=>({value:e.getFloat32(t),size:4}),[g]:(e,t)=>({value:e.getFloat64(t),size:8})},Q=e=>{let t=Object.keys(e),p=t.map(n=>{let i=e[n];for(let r of[v,D,w,z,b,C,S,g])if(r in i)return r;return g}).map(n=>O[n]||(()=>{throw new Error("Unsupported or unannotated type")}));return(n,i,r)=>{let s=0;s+=O[b](n,i+s,r);for(let o=0;o<t.length;o++)s+=p[o](n,i+s,e[t[o]][r]);return s}},X=e=>{let t=Object.keys(e),p=t.map(n=>{let i=e[n];for(let r of[v,D,w,z,b,C,S,g])if(r in i)return r;return g}).map(n=>T[n]||(()=>{throw new Error("Unsupported or unannotated type")}));return(n,i,r)=>{let s=0,{value:o,size:y}=T[b](n,i+s);s+=y;let a=r?r.get(o)??o:o;for(let u=0;u<t.length;u++){let{value:l,size:f}=p[u](n,i+s);e[t[u]][a]=l,s+=f}return s}},U=(e,t=new ArrayBuffer(1024*1024*100))=>{let m=new DataView(t),p=e.map(Q);return n=>{let i=0;for(let r=0;r<n.length;r++){let s=n[r];for(let o=0;o<p.length;o++)i+=p[o](m,i,s)}return t.slice(0,i)}},I=e=>{let t=e.map(X);return(m,p)=>{let n=new DataView(m),i=0;for(;i<m.byteLength;)for(let r=0;r<t.length;r++)i+=t[r](n,i,p)}};import{addComponent as $,hasComponent as Y,getAllEntities as Z,addEntity as B,isRelation as W,getRelationTargets as _}from"bitecs";var k=(e,t,m=new ArrayBuffer(1024*1024*100))=>{let p=new DataView(m),n=0,i=s=>{let o=s.length;p.setUint32(n,o),n+=4;for(let y=0;y<o;y++){let a=s[y],u=0;p.setUint32(n,a),n+=4;let l=n;n+=1;for(let f=0;f<t.length;f++){let d=t[f];if(W(d)){let A=_(e,a,d);for(let h of A)p.setUint8(n,f),n+=1,p.setUint32(n,h),n+=4,u++}else Y(e,a,d)&&(p.setUint8(n,f),n+=1,u++)}p.setUint8(l,u)}},r=s=>{let y=U(t,m.slice(n))(s);new Uint8Array(m).set(new Uint8Array(y),n),n+=y.byteLength};return()=>{n=0;let s=Z(e);return i(s),r(s),m.slice(0,n)}},ee=(e,t)=>{let m=I(t);return p=>{let n=new DataView(p),i=0,r=new Map,s=n.getUint32(i);i+=4;for(let o=0;o<s;o++){let y=n.getUint32(i);i+=4;let a=B(e);r.set(y,a);let u=n.getUint8(i);i+=1;for(let l=0;l<u;l++){let f=n.getUint8(i);i+=1;let d=t[f];if(W(d)){let A=n.getUint32(i);if(i+=4,!r.has(A)){let M=B(e);r.set(A,M)}let h=r.get(A);$(e,a,d(h))}else $(e,a,d)}}return m(p.slice(i),r),r}};import{addComponent as E,removeComponent as P,addEntity as te,removeEntity as ne,observe as R,onAdd as V,onRemove as x,entityExists as re,isRelation as oe,getRelationTargets as ie,Wildcard as F}from"bitecs";var ae=(e,t,m,p=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(p),i=0,r=[],s=new Map;return R(e,V(t),o=>{r.push([o,0,-1])}),R(e,x(t),o=>{r.push([o,1,-1]),s.delete(o)}),m.forEach((o,y)=>{oe(o)?(R(e,V(t,o(F)),a=>{let u=ie(e,a,o);for(let l of u)s.has(a)||s.set(a,new Map),s.get(a).set(y,l),r.push([a,4,y,l])}),R(e,x(t,o(F)),a=>{let u=s.get(a);if(u){let l=u.get(y);l!==void 0&&(r.push([a,5,y,l]),u.delete(y),u.size===0&&s.delete(a))}})):(R(e,V(t,o),a=>{r.push([a,2,y])}),R(e,x(t,o),a=>{r.push([a,3,y])}))}),()=>{i=0;for(let o=0;o<r.length;o++){let[y,a,u,l]=r[o];n.setUint32(i,y),i+=4,n.setUint8(i,a),i+=1,(a===2||a===3||a===4||a===5)&&(n.setUint8(i,u),i+=1,(a===4||a===5)&&(n.setUint32(i,l),i+=4))}return r.length=0,p.slice(0,i)}},se=(e,t,m,p=new Map)=>n=>{let i=new DataView(n),r=0;for(;r<n.byteLength;){let s=i.getUint32(r);r+=4;let o=i.getUint8(r);r+=1;let y=-1,a=-1;(o===2||o===3||o===4||o===5)&&(y=i.getUint8(r),r+=1,(o===4||o===5)&&(a=i.getUint32(r),r+=4));let u=m[y],l=p.get(s);if(o===0)if(l===void 0)l=te(e),p.set(s,l),E(e,l,t);else throw new Error(`Entity with ID ${s} already exists in the mapping.`);else if(l!==void 0&&re(e,l)){if(o===1)ne(e,l);else if(o===2)E(e,l,u);else if(o===3)P(e,l,u);else if(o===4){let f=p.get(a);f!==void 0&&E(e,l,u(f))}else if(o===5){let f=p.get(a);f!==void 0&&P(e,l,u(f))}}}return p};export{se as createObserverDeserializer,ae as createObserverSerializer,ee as createSnapshotDeserializer,k as createSnapshotSerializer,I as createSoADeserializer,U as createSoASerializer,K as f32,N as f64,q as i16,J as i32,L as i8,G as u16,H as u32,j as u8};
//# sourceMappingURL=index.min.mjs.map
