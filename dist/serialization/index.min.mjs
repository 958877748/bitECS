var z=Symbol.for("bitecs-u8"),D=Symbol.for("bitecs-i8"),T=Symbol.for("bitecs-u16"),I=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),U=Symbol.for("bitecs-i32"),h=Symbol.for("bitecs-f32"),$=Symbol.for("bitecs-f64"),k=Symbol.for("bitecs-arr"),F=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),Q=F(z),X=F(D),Y=F(T),Z=F(I),_=F(A),ee=F(U),W=F(h),te=F($),ue=new Map([[Q,z],[X,D],[Y,T],[Z,I],[_,A],[ee,U],[W,h],[te,$]]),d={[z]:(e,r,i)=>(e.setUint8(r,i),1),[D]:(e,r,i)=>(e.setInt8(r,i),1),[T]:(e,r,i)=>(e.setUint16(r,i),2),[I]:(e,r,i)=>(e.setInt16(r,i),2),[A]:(e,r,i)=>(e.setUint32(r,i),4),[U]:(e,r,i)=>(e.setInt32(r,i),4),[h]:(e,r,i)=>(e.setFloat32(r,i),4),[$]:(e,r,i)=>(e.setFloat64(r,i),8)},S={[z]:(e,r)=>({value:e.getUint8(r),size:1}),[D]:(e,r)=>({value:e.getInt8(r),size:1}),[T]:(e,r)=>({value:e.getUint16(r),size:2}),[I]:(e,r)=>({value:e.getInt16(r),size:2}),[A]:(e,r)=>({value:e.getUint32(r),size:4}),[U]:(e,r)=>({value:e.getInt32(r),size:4}),[h]:(e,r)=>({value:e.getFloat32(r),size:4}),[$]:(e,r)=>({value:e.getFloat64(r),size:8})};function V(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let r=ue.get(e);if(r)return r;throw new Error(`Unknown type function: ${e}`)}return C(e)?V(e[k]):h}var pe=(e=W)=>{let r=[];return Object.defineProperty(r,k,{value:e,enumerable:!1,writable:!1,configurable:!1}),r};function M(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function v(e){if(C(e))return V(e[k]);for(let r of[z,D,T,I,A,U,h,$])if(r in e)return r;return e instanceof Int8Array?D:e instanceof Uint8Array?z:e instanceof Int16Array?I:e instanceof Uint16Array?T:e instanceof Int32Array?U:e instanceof Uint32Array?A:e instanceof Float32Array?h:$}function C(e){return Array.isArray(e)&&k in e}function O(e){return e[k]}function j(e,r,i,n){let y=0,l=Array.isArray(r)?1:0;if(y+=d[z](i,n,l),!l)return y;y+=d[A](i,n+y,r.length);for(let t=0;t<r.length;t++){let a=r[t];if(C(e))y+=j(O(e),a,i,n+y);else{let o=V(e);y+=d[o](i,n+y,a)}}return y}function P(e,r,i){let n=0,y=S[z](r,i+n);if(n+=y.size,!y.value)return{size:n};let l=S[A](r,i+n);n+=l.size;let t=new Array(l.value);for(let a=0;a<t.length;a++)if(C(e)){let{value:o,size:s}=P(O(e),r,i+n);n+=s,Array.isArray(o)&&(t[a]=o)}else{let o=V(e),{value:s,size:u}=S[o](r,i+n);n+=u,t[a]=s}return{value:t,size:n}}var ce=e=>{let r=v(e);return r===h||r===$},me=(e,r)=>ce(e)?r:0,fe=(e,r)=>{let i=e.get(r);return i||(ArrayBuffer.isView(r)?i=new r.constructor(r.length):i=new Array(r.length).fill(0),e.set(r,i)),i},K=(e,r,i,n=1e-4)=>{let y=fe(e,r),l=r[i],t=me(r,n),a=t>0?Math.abs(y[i]-l)>t:y[i]!==l;return y[i]=l,a},be=(e,r=!1,i,n=1e-4)=>{if(M(e)){let a=v(e),o=d[a];return(s,u,p,c)=>{if(r&&i){if(!K(i,e,p,n))return 0;let m=0;return m+=d[A](s,u+m,p),m+=d[A](s,u+m,c),m+=o(s,u+m,e[p]),m}else{let m=0;return m+=d[A](s,u+m,p),m+=o(s,u+m,e[p]),m}}}let y=Object.keys(e),t=y.map(a=>{let o=e[a];if(!M(o))throw new Error(`Invalid array type for property ${a}`);return v(o)}).map(a=>d[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,o,s,u)=>{if(r&&i){let p=0;for(let f=0;f<y.length;f++){let b=e[y[f]];K(i,b,s,n)&&(p|=1<<f)}if(p===0)return 0;let c=0;c+=d[A](a,o+c,s),c+=d[A](a,o+c,u);let m=y.length<=8?d[z]:y.length<=16?d[T]:d[A];c+=m(a,o+c,p);for(let f=0;f<y.length;f++)if(p&1<<f){let b=e[y[f]];C(b)?c+=j(O(b),b[s],a,o+c):c+=t[f](a,o+c,b[s])}return c}else{let p=0;p+=d[A](a,o+p,s);for(let c=0;c<y.length;c++){let m=e[y[c]];C(m)?p+=j(O(m),m[s],a,o+p):p+=t[c](a,o+p,m[s])}return p}}},Ae=(e,r=!1)=>{if(M(e)){let l=v(e),t=S[l];return(a,o,s)=>{let u=0,{value:p,size:c}=S[A](a,o);u+=c;let m=s?s.get(p)??p:p;if(r){let{size:g}=S[A](a,o+u);u+=g}let{value:f,size:b}=t(a,o+u);return e[m]=f,u+b}}let i=Object.keys(e),y=i.map(l=>{let t=e[l];if(!M(t))throw new Error(`Invalid array type for property ${l}`);return v(t)}).map(l=>S[l]||(()=>{throw new Error("Unsupported or unannotated type")}));return(l,t,a)=>{let o=0,{value:s,size:u}=S[A](l,t+o);o+=u;let p=a?a.get(s)??s:s;if(r){let{size:c}=S[A](l,t+o);o+=c;let m=i.length<=8?S[z]:i.length<=16?S[T]:S[A],{value:f,size:b}=m(l,t+o);o+=b;for(let g=0;g<i.length;g++)if(f&1<<g){let R=e[i[g]];if(C(R)){let{value:B,size:E}=P(O(R),l,t+o);Array.isArray(B)&&(R[p]=B),o+=E}else{let{value:B,size:E}=y[g](l,t+o);e[i[g]][p]=B,o+=E}}}else for(let c=0;c<i.length;c++){let m=e[i[c]];if(C(m)){let{value:f,size:b}=P(O(m),l,t+o);Array.isArray(f)&&(m[p]=f),o+=b}else{let{value:f,size:b}=y[c](l,t+o);e[i[c]][p]=f,o+=b}}return o}},w=(e,r={})=>{let{diff:i=!1,buffer:n=new ArrayBuffer(1024*1024*100),epsilon:y=1e-4}=r,l=new DataView(n),t=i?new Map:void 0,a=e.map(o=>be(o,i,t,y));return o=>{let s=0;for(let u=0;u<o.length;u++){let p=o[u];for(let c=0;c<a.length;c++)s+=a[c](l,s,p,c)}return n.slice(0,s)}},N=(e,r={})=>{let{diff:i=!1}=r,n=e.map(y=>Ae(y,i));return(y,l)=>{let t=new DataView(y),a=0;for(;a<y.byteLength;)if(i){let{value:o,size:s}=S[A](t,a),{value:u,size:p}=S[A](t,a+s);a+=n[u](t,a,l)}else for(let o=0;o<n.length;o++)a+=n[o](t,a,l)}};var ge=e=>{let r=v(e);return r===h||r===$},ne=(e,r)=>ge(e)?r:0,ie=(e,r)=>{let i=e.get(r);return i||(i=[],e.set(r,i)),i},G=(e,r,i,n)=>{let y=ie(e,r),l=r[i],t=y[i];if(l===void 0)return!1;if(t===void 0)return!0;if(typeof l=="object"&&l!==null){let a=r;for(let o in l)if(a[o]){let s=ne(a[o],n);if(s>0?Math.abs(t[o]-l[o])>s:t[o]!==l[o])return!0}return!1}else{let a=ne(r,n);return a>0?Math.abs(t-l)>a:t!==l}},re=(e,r,i)=>{let n=ie(e,r),y=r[i];typeof y=="object"&&y!==null?n[i]={...y}:n[i]=y},de=(e,r,i,n=1e-4)=>{if(typeof e=="object"&&Object.keys(e).some(l=>isNaN(parseInt(l))&&typeof e[l]=="object")){let l=Object.keys(e).filter(o=>isNaN(parseInt(o))),a=l.map(o=>v(e[o])).map(o=>d[o]);return(o,s,u)=>{let p=e[u];if(p===void 0)return 0;if(r&&i){if(!G(i,e,u,n))return 0;re(i,e,u)}let c=0;for(let m=0;m<l.length;m++){let f=e[l[m]],b=p[l[m]];C(f)?c+=j(O(f),b,o,s+c):c+=a[m](o,s+c,b)}return c}}else{let l=v(e),t=d[l];return(a,o,s)=>{let u=e[s];if(u===void 0)return 0;if(r&&i){if(!G(i,e,s,n))return 0;re(i,e,s)}return t(a,o,u)}}},Se=e=>{if(typeof e=="object"&&Object.keys(e).some(i=>isNaN(parseInt(i))&&typeof e[i]=="object")){let i=Object.keys(e).filter(l=>isNaN(parseInt(l))),y=i.map(l=>v(e[l])).map(l=>S[l]);return(l,t,a)=>{let o=0,s={};for(let u=0;u<i.length;u++){let p=e[i[u]];if(C(p)){let{value:c,size:m}=P(O(p),l,t+o);Array.isArray(c)&&(s[i[u]]=c),o+=m}else{let{value:c,size:m}=y[u](l,t+o);s[i[u]]=c,o+=m}}return e[a]=s,o}}else{let i=v(e),n=S[i];return(y,l,t)=>{let{value:a,size:o}=n(y,l);return e[t]=a,o}}},ze=(e,r={})=>{let{diff:i=!1,buffer:n=new ArrayBuffer(1024*1024*100),epsilon:y=1e-4}=r,l=new DataView(n),t=i?new Map:void 0,a=e.map(o=>de(o,i,t,y));return o=>{let s=0;for(let u=0;u<o.length;u++){let p=o[u];if(i){let c=!1;for(let g=0;g<e.length;g++)if(t&&G(t,e[g],p,y)){c=!0;break}if(!c)continue;s+=d[A](l,s,p);let m=s,f=e.length<=8?d[z]:e.length<=16?d[T]:d[A];s+=f===d[z]?1:f===d[T]?2:4;let b=0;for(let g=0;g<a.length;g++){let R=a[g](l,s,p);R>0&&(b|=1<<g,s+=R)}f(l,m,b)}else{s+=d[A](l,s,p);for(let c=0;c<a.length;c++)s+=a[c](l,s,p)}}return n.slice(0,s)}},Te=(e,r={})=>{let{diff:i=!1}=r,n=e.map(y=>Se(y));return(y,l)=>{let t=new DataView(y),a=0;for(;a<y.byteLength;){let{value:o,size:s}=S[A](t,a);a+=s;let u=l?l.get(o)??o:o;if(i){let p=e.length<=8?S[z]:e.length<=16?S[T]:S[A],{value:c,size:m}=p(t,a);a+=m;for(let f=0;f<e.length;f++)c&1<<f&&(a+=n[f](t,a,u))}else for(let p=0;p<n.length;p++)a+=n[p](t,a,u)}}};import{addComponent as ae,hasComponent as he,getAllEntities as Re,addEntity as oe,isRelation as se,getRelationTargets as De,Wildcard as _e}from"bitecs";function Ie(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let y=e[r];return y!==void 0?(i.setFloat64(n,y),n+8):n}if(typeof e=="object"){let y=Object.keys(e).sort();for(let l of y){let t=e[l],a=t[r];a!==void 0&&(t instanceof Int8Array||D in t?(i.setInt8(n,a),n+=1):t instanceof Uint8Array||z in t?(i.setUint8(n,a),n+=1):t instanceof Int16Array||I in t?(i.setInt16(n,a),n+=2):t instanceof Uint16Array||T in t?(i.setUint16(n,a),n+=2):t instanceof Int32Array||U in t?(i.setInt32(n,a),n+=4):t instanceof Uint32Array||A in t?(i.setUint32(n,a),n+=4):t instanceof Float32Array||h in t?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function Ue(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let y=Object.keys(e).sort();for(let l of y){let t=e[l];t instanceof Int8Array||D in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||z in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||I in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||T in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||U in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||h in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var ve=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),y=0,l=a=>{let o=a.length;n.setUint32(y,o),y+=4;for(let s=0;s<o;s++){let u=a[s],p=0;n.setUint32(y,u),y+=4;let c=y;y+=1;for(let m=0;m<r.length;m++){let f=r[m];if(se(f)){let b=De(e,u,f);for(let g of b){n.setUint8(y,m),y+=1,n.setUint32(y,g),y+=4;let R=f(g);y=Ie(R,u,n,y),p++}}else he(e,u,f)&&(n.setUint8(y,m),y+=1,p++)}n.setUint8(c,p)}},t=a=>{let s=w(r,{buffer:i.slice(y)})(a);new Uint8Array(i).set(new Uint8Array(s),y),y+=s.byteLength};return()=>{y=0;let a=Re(e);return l(a),t(a),i.slice(0,y)}},Ce=(e,r,i)=>{let n=i||new Map,y=N(r);return(l,t)=>{let a=t||n,o=new DataView(l),s=0,u=o.getUint32(s);s+=4;for(let p=0;p<u;p++){let c=o.getUint32(s);s+=4;let m=a.get(c);m===void 0&&(m=oe(e),a.set(c,m));let f=o.getUint8(s);s+=1;for(let b=0;b<f;b++){let g=o.getUint8(s);s+=1;let R=r[g];if(se(R)){let B=o.getUint32(s);s+=4;let E=a.get(B);E===void 0&&(E=oe(e),a.set(B,E));let J=R(E);ae(e,m,J),s=Ue(J,m,o,s)}else ae(e,m,R)}}return y(l.slice(s),a),a}};import{addComponent as L,removeComponent as ye,addEntity as $e,removeEntity as Oe,observe as x,onAdd as q,onRemove as H,entityExists as Ee,isRelation as Fe,getRelationTargets as Be,Wildcard as le}from"bitecs";function xe(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let y=e[r];return y!==void 0?(i.setFloat64(n,y),n+8):n}if(typeof e=="object"){let y=Object.keys(e).sort();for(let l of y){let t=e[l],a=t[r];a!==void 0&&(t instanceof Int8Array||D in t?(i.setInt8(n,a),n+=1):t instanceof Uint8Array||z in t?(i.setUint8(n,a),n+=1):t instanceof Int16Array||I in t?(i.setInt16(n,a),n+=2):t instanceof Uint16Array||T in t?(i.setUint16(n,a),n+=2):t instanceof Int32Array||U in t?(i.setInt32(n,a),n+=4):t instanceof Uint32Array||A in t?(i.setUint32(n,a),n+=4):t instanceof Float32Array||h in t?(i.setFloat32(n,a),n+=4):(i.setFloat64(n,a),n+=8))}}return n}function je(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let y=Object.keys(e).sort();for(let l of y){let t=e[l];t instanceof Int8Array||D in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||z in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||I in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||T in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||U in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||h in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var Pe=(e,r,i,n=new ArrayBuffer(1024*1024*100))=>{let y=new DataView(n),l=0,t=[],a=new Map;return x(e,q(r),o=>{t.push([o,0,-1])}),x(e,H(r),o=>{t.push([o,1,-1]),a.delete(o)}),i.forEach((o,s)=>{Fe(o)?(x(e,q(r,o(le)),u=>{let p=Be(e,u,o);for(let c of p){a.has(u)||a.set(u,new Map),a.get(u).set(s,c);let m=o(c);t.push([u,4,s,c,m])}}),x(e,H(r,o(le)),u=>{let p=a.get(u);if(p){let c=p.get(s);c!==void 0&&(t.push([u,5,s,c]),p.delete(s),p.size===0&&a.delete(u))}})):(x(e,q(r,o),u=>{t.push([u,2,s])}),x(e,H(r,o),u=>{t.push([u,3,s])}))}),()=>{l=0;for(let o=0;o<t.length;o++){let[s,u,p,c,m]=t[o];y.setUint32(l,s),l+=4,y.setUint8(l,u),l+=1,(u===2||u===3||u===4||u===5)&&(y.setUint8(l,p),l+=1,(u===4||u===5)&&(y.setUint32(l,c),l+=4,u===4&&m&&(l=xe(m,s,y,l))))}return t.length=0,n.slice(0,l)}},ke=(e,r,i,n)=>{let y=n||new Map;return(l,t)=>{let a=t||y,o=new DataView(l),s=0;for(;s<l.byteLength;){let u=o.getUint32(s);s+=4;let p=o.getUint8(s);s+=1;let c=-1,m=-1;(p===2||p===3||p===4||p===5)&&(c=o.getUint8(s),s+=1,(p===4||p===5)&&(m=o.getUint32(s),s+=4));let f=i[c],b=a.get(u);if(p===0)b===void 0?(b=$e(e),a.set(u,b),L(e,b,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(b!==void 0&&Ee(e,b)){if(p===1)Oe(e,b),a.delete(u);else if(p===2)L(e,b,f);else if(p===3)ye(e,b,f);else if(p===4){let g=a.get(m);if(g!==void 0){let R=f(g);L(e,b,R),s=je(R,b,o,s)}}else if(p===5){let g=a.get(m);g!==void 0&&ye(e,b,f(g))}}}return a}};export{h as $f32,$ as $f64,I as $i16,U as $i32,D as $i8,T as $u16,A as $u32,z as $u8,pe as array,Te as createAoSDeserializer,ze as createAoSSerializer,ke as createObserverDeserializer,Pe as createObserverSerializer,Ce as createSnapshotDeserializer,ve as createSnapshotSerializer,N as createSoADeserializer,w as createSoASerializer,W as f32,te as f64,Z as i16,ee as i32,X as i8,Y as u16,_ as u32,Q as u8};
//# sourceMappingURL=index.min.mjs.map
