{
  "version": 3,
  "sources": ["../../src/serialization/index.ts", "../../src/serialization/SoASerializer.ts", "../../src/serialization/SnapshotSerializer.ts", "../../src/serialization/ObserverSerializer.ts"],
  "sourcesContent": ["\r\nexport {\r\n    createSoASerializer,\r\n    createSoADeserializer,\r\n    u8, i8, u16, i16, u32, i32, f32, f64, array,\r\n    $i8, $u16, $i16, $u32, $i32, $f32, $f64, $u8,\r\n    type PrimitiveBrand\r\n} from './SoASerializer'\r\n\r\nexport {\r\n    createSnapshotSerializer,\r\n    createSnapshotDeserializer,\r\n} from './SnapshotSerializer'\r\n\r\nexport {\r\n    createObserverSerializer,\r\n    createObserverDeserializer\r\n} from './ObserverSerializer';", "\r\n/**\r\n * Symbols representing different data types for serialization.\r\n */\r\nexport const $u8 = Symbol.for('bitecs-u8'), $i8 = Symbol.for('bitecs-i8'), $u16 = Symbol.for('bitecs-u16'), $i16 = Symbol.for('bitecs-i16'),\r\n    $u32 = Symbol.for('bitecs-u32'), $i32 = Symbol.for('bitecs-i32'), $f32 = Symbol.for('bitecs-f32'), $f64 = Symbol.for('bitecs-f64'),\r\n    $arr = Symbol.for('bitecs-arr')\r\n\r\n/**\r\n * Union type of all possible TypedArray types.\r\n */\r\nexport type TypedArray = \r\n    | Int8Array\r\n    | Uint8Array\r\n    | Int16Array\r\n    | Uint16Array\r\n    | Int32Array\r\n    | Uint32Array\r\n    | Float32Array\r\n    | Float64Array\r\n\r\n/**\r\n * Union type of all possible type symbols.\r\n */\r\nexport type TypeSymbol = typeof $u8 | typeof $i8 | typeof $u16 | typeof $i16 | typeof $u32 | typeof $i32 | typeof $f32 | typeof $f64\r\n\r\n/**\r\n * Type representing a primitive brand, which is either a number array with a symbol property or a TypedArray.\r\n */\r\nexport type PrimitiveBrand = (number[] & { [key: symbol]: true }) | TypedArray\r\n\r\n/**\r\n * Type representing a component reference, which is a record mapping string keys to either\r\n * a PrimitiveBrand (number array with type symbol) or TypedArray values.\r\n * Used to define the structure of components that can be serialized.\r\n */\r\ntype ComponentRef = Record<string, PrimitiveBrand | TypedArray>\r\n\r\n/**\r\n * Creates a function that tags an array with a type symbol for serialization.\r\n * @param {TypeSymbol} symbol - The type symbol to tag the array with.\r\n * @returns {Function} A function that tags an array with the given type symbol.\r\n */\r\nconst typeTagForSerialization = (symbol: TypeSymbol) => (a: number[] = []): PrimitiveBrand =>\r\n    Object.defineProperty(a, symbol, { value: true, enumerable: false, writable: false, configurable: false }) as PrimitiveBrand\r\n\r\n/**\r\n * Functions to create arrays tagged with specific type symbols.\r\n */\r\nexport const u8 = typeTagForSerialization($u8),     i8 = typeTagForSerialization($i8),\r\n            u16 = typeTagForSerialization($u16),    i16 = typeTagForSerialization($i16),\r\n            u32 = typeTagForSerialization($u32),    i32 = typeTagForSerialization($i32),\r\n            f32 = typeTagForSerialization($f32),    f64 = typeTagForSerialization($f64)\r\n\r\n/**\r\n * Object containing setter functions for each data type.\r\n */\r\nconst typeSetters = {\r\n    [$u8]: (view: DataView, offset: number, value: number) => { view.setUint8(offset, value); return 1; },\r\n    [$i8]: (view: DataView, offset: number, value: number) => { view.setInt8(offset, value); return 1; },\r\n    [$u16]: (view: DataView, offset: number, value: number) => { view.setUint16(offset, value); return 2; },\r\n    [$i16]: (view: DataView, offset: number, value: number) => { view.setInt16(offset, value); return 2; },\r\n    [$u32]: (view: DataView, offset: number, value: number) => { view.setUint32(offset, value); return 4; },\r\n    [$i32]: (view: DataView, offset: number, value: number) => { view.setInt32(offset, value); return 4; },\r\n    [$f32]: (view: DataView, offset: number, value: number) => { view.setFloat32(offset, value); return 4; },\r\n    [$f64]: (view: DataView, offset: number, value: number) => { view.setFloat64(offset, value); return 8; }\r\n}\r\n\r\n/**\r\n * Object containing getter functions for each data type.\r\n */\r\nconst typeGetters = {\r\n    [$u8]: (view: DataView, offset: number) => ({ value: view.getUint8(offset), size: 1 }),\r\n    [$i8]: (view: DataView, offset: number) => ({ value: view.getInt8(offset), size: 1 }),\r\n    [$u16]: (view: DataView, offset: number) => ({ value: view.getUint16(offset), size: 2 }),\r\n    [$i16]: (view: DataView, offset: number) => ({ value: view.getInt16(offset), size: 2 }),\r\n    [$u32]: (view: DataView, offset: number) => ({ value: view.getUint32(offset), size: 4 }),\r\n    [$i32]: (view: DataView, offset: number) => ({ value: view.getInt32(offset), size: 4 }),\r\n    [$f32]: (view: DataView, offset: number) => ({ value: view.getFloat32(offset), size: 4 }),\r\n    [$f64]: (view: DataView, offset: number) => ({ value: view.getFloat64(offset), size: 8 })\r\n}\r\n\r\nexport const array = <T extends any[] = []>(type: TypeSymbol = $f32)=>  {\r\n    const arr = [];\r\n\r\n    Object.defineProperty(arr, $arr, { value: type, enumerable: false, writable: false, configurable: false })\r\n\r\n    return arr as T[];\r\n}\r\n\r\n/**\r\n * Checks if a value is a TypedArray or branded array\r\n */\r\nfunction isTypedArrayOrBranded(arr: any): arr is PrimitiveBrand | TypedArray {\r\n    return arr && (\r\n        ArrayBuffer.isView(arr) || \r\n        (Array.isArray(arr) && typeof arr === 'object')\r\n    )\r\n}\r\n\r\n/**\r\n * Gets the type symbol for an array\r\n */\r\nfunction getTypeForArray(arr: PrimitiveBrand | TypedArray): TypeSymbol {\r\n    // Check for branded arrays first\r\n    for (const symbol of [$u8, $i8, $u16, $i16, $u32, $i32, $f32, $f64] as TypeSymbol[]) {\r\n        if (symbol in arr) return symbol\r\n    }\r\n    // Then check TypedArrays\r\n    if (arr instanceof Int8Array) return $i8\r\n    if (arr instanceof Uint8Array) return $u8\r\n    if (arr instanceof Int16Array) return $i16\r\n    if (arr instanceof Uint16Array) return $u16\r\n    if (arr instanceof Int32Array) return $i32\r\n    if (arr instanceof Uint32Array) return $u32\r\n    if (arr instanceof Float32Array) return $f32\r\n    return $f64\r\n}\r\n\r\n/**\r\n * Creates a serializer function for a component.\r\n * @param {ComponentRef} component - The component to create a serializer for.\r\n * @returns {Function} A function that serializes the component.\r\n */\r\nexport const createComponentSerializer = (component: ComponentRef | PrimitiveBrand | TypedArray) => {\r\n    // Handle direct array case\r\n    if (isTypedArrayOrBranded(component)) {\r\n        const type = getTypeForArray(component)\r\n        const setter = typeSetters[type]\r\n        return (view: DataView, offset: number, index: number) => {\r\n            let bytesWritten = 0\r\n            bytesWritten += typeSetters[$u32](view, offset, index)\r\n            bytesWritten += setter(view, offset + bytesWritten, component[index])\r\n            return bytesWritten\r\n        }\r\n    }\r\n\r\n    // Handle component case\r\n    const props = Object.keys(component)\r\n    const types = props.map(prop => {\r\n        const arr = component[prop]\r\n        if (!isTypedArrayOrBranded(arr)) {\r\n            throw new Error(`Invalid array type for property ${prop}`)\r\n        }\r\n        return getTypeForArray(arr)\r\n    })\r\n    const setters = types.map(type => typeSetters[type as keyof typeof typeSetters] || (() => { throw new Error(`Unsupported or unannotated type`); }))\r\n    return (view: DataView, offset: number, index: number) => {\r\n        let bytesWritten = 0\r\n        // Write index first\r\n        bytesWritten += typeSetters[$u32](view, offset + bytesWritten, index)\r\n        for (let i = 0; i < props.length; i++) {\r\n            const elementType: TypeSymbol = component[props[i]][$arr]\r\n            if (elementType !== undefined) {\r\n                const arr = component[props[i]][index] as any;\r\n                const length = arr.length;\r\n                bytesWritten += typeSetters[$u32](view, offset + bytesWritten, length)\r\n                for (let j = 0; j < length; j++) {\r\n                    bytesWritten += typeSetters[elementType](view, offset + bytesWritten, arr[j])\r\n                }\r\n            } else {\r\n                bytesWritten += setters[i](view, offset + bytesWritten, component[props[i]][index])\r\n            }\r\n        }\r\n        return bytesWritten\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a deserializer function for a component.\r\n * @param {ComponentRef} component - The component to create a deserializer for.\r\n * @returns {Function} A function that deserializes the component.\r\n */\r\nexport const createComponentDeserializer = (component: ComponentRef | PrimitiveBrand | TypedArray) => {\r\n    // Handle direct array case\r\n    if (isTypedArrayOrBranded(component)) {\r\n        const type = getTypeForArray(component)\r\n        const getter = typeGetters[type]\r\n        return (view: DataView, offset: number, entityIdMapping?: Map<number, number>) => {\r\n            let bytesRead = 0\r\n            const { value: originalIndex, size: indexSize } = typeGetters[$u32](view, offset)\r\n            bytesRead += indexSize\r\n            const index = entityIdMapping ? entityIdMapping.get(originalIndex) ?? originalIndex : originalIndex\r\n            const { value, size } = getter(view, offset + bytesRead)\r\n            component[index] = value\r\n            return bytesRead + size\r\n        }\r\n    }\r\n\r\n    // Handle component case\r\n    const props = Object.keys(component)\r\n    const types = props.map(prop => {\r\n        const arr = component[prop]\r\n        if (!isTypedArrayOrBranded(arr)) {\r\n            throw new Error(`Invalid array type for property ${prop}`)\r\n        }\r\n        return getTypeForArray(arr)\r\n    })\r\n    const getters = types.map(type => typeGetters[type as keyof typeof typeGetters] || (() => { throw new Error(`Unsupported or unannotated type`); }))\r\n    return (view: DataView, offset: number, entityIdMapping?: Map<number, number>) => {\r\n        let bytesRead = 0\r\n\r\n        const { value: originalIndex, size: indexSize } = typeGetters[$u32](view, offset + bytesRead)\r\n        bytesRead += indexSize\r\n        \r\n        const index = entityIdMapping ? entityIdMapping.get(originalIndex) ?? originalIndex : originalIndex\r\n        \r\n        for (let i = 0; i < props.length; i++) {\r\n            const elementType: TypeSymbol = component[props[i]][$arr]\r\n            if (elementType !== undefined) {\r\n                const { value, size } = typeGetters[$u32](view, offset + bytesRead)\r\n                const arr = new Array(value) as any;\r\n                bytesRead += size;\r\n                for (let j = 0; j < value; j++) {\r\n                    const { value, size } = typeGetters[elementType](view, offset + bytesRead)\r\n                    bytesRead += size\r\n                    arr[j] = value\r\n                }\r\n                component[props[i]][index] = arr\r\n            } else {\r\n                const { value, size } = getters[i](view, offset + bytesRead)\r\n                component[props[i]][index] = value\r\n                bytesRead += size\r\n            }\r\n        }\r\n        return bytesRead\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a serializer function for Structure of Arrays (SoA) data.\r\n * @param {ComponentRef[]} components - The components to serialize.\r\n * @param {ArrayBuffer} [buffer] - The buffer to use for serialization.\r\n * @returns {Function} A function that serializes the SoA data.\r\n */\r\nexport const createSoASerializer = (components: (ComponentRef | PrimitiveBrand | TypedArray)[], buffer: ArrayBuffer = new ArrayBuffer(1024 * 1024 * 100)) => {\r\n    const view = new DataView(buffer)\r\n    const componentSerializers = components.map(createComponentSerializer)\r\n    return (indices: number[] | readonly number[]): ArrayBuffer => {\r\n        let offset = 0\r\n        for (let i = 0; i < indices.length; i++) {\r\n            const index = indices[i]\r\n            for (let j = 0; j < componentSerializers.length; j++) {\r\n                offset += componentSerializers[j](view, offset, index)\r\n            }\r\n        }\r\n        return buffer.slice(0, offset)\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a deserializer function for Structure of Arrays (SoA) data.\r\n * @param {ComponentRef[]} components - The components to deserialize.\r\n * @returns {Function} A function that deserializes the SoA data.\r\n */\r\nexport const createSoADeserializer = (components: (ComponentRef | PrimitiveBrand | TypedArray)[]) => {\r\n    const componentDeserializers = components.map(createComponentDeserializer)\r\n    return (packet: ArrayBuffer, entityIdMapping?: Map<number, number>): void => {\r\n        const view = new DataView(packet)\r\n        let offset = 0\r\n        while (offset < packet.byteLength) {\r\n            for (let i = 0; i < componentDeserializers.length; i++) {\r\n                offset += componentDeserializers[i](view, offset, entityIdMapping)\r\n            }\r\n        }\r\n    }\r\n}\r\n", "import { createSoASerializer, createSoADeserializer, PrimitiveBrand } from './SoASerializer'\r\nimport {\r\n    addComponent,\r\n    hasComponent,\r\n    World,\r\n    getAllEntities,\r\n    addEntity,\r\n    isRelation,\r\n    getRelationTargets,\r\n    Wildcard,\r\n    Relation,\r\n    ComponentRef,\r\n    query\r\n} from 'bitecs'\r\nimport { $u8, $i8, $u16, $i16, $u32, $i32, $f32 } from './SoASerializer'\r\n\r\n/**\r\n * Serializes relation data for a specific entity\r\n */\r\nfunction serializeRelationData(data: any, eid: number, dataView: DataView, offset: number) {\r\n    if (!data) return offset\r\n    \r\n    // Handle array data (AoS) - defaults to f64\r\n    if (Array.isArray(data)) {\r\n        const value = data[eid]\r\n        if (value !== undefined) {\r\n            dataView.setFloat64(offset, value)\r\n            return offset + 8\r\n        }\r\n        return offset\r\n    }\r\n    \r\n    // Handle object data (SoA)\r\n    if (typeof data === 'object') {\r\n        const keys = Object.keys(data).sort()\r\n        for (const key of keys) {\r\n            const arr = data[key]\r\n            const value = arr[eid]\r\n            \r\n            if (value !== undefined) {\r\n                if (arr instanceof Int8Array || $i8 in arr) {\r\n                    dataView.setInt8(offset, value)\r\n                    offset += 1\r\n                } else if (arr instanceof Uint8Array || $u8 in arr) {\r\n                    dataView.setUint8(offset, value)\r\n                    offset += 1\r\n                } else if (arr instanceof Int16Array || $i16 in arr) {\r\n                    dataView.setInt16(offset, value)\r\n                    offset += 2\r\n                } else if (arr instanceof Uint16Array || $u16 in arr) {\r\n                    dataView.setUint16(offset, value)\r\n                    offset += 2\r\n                } else if (arr instanceof Int32Array || $i32 in arr) {\r\n                    dataView.setInt32(offset, value)\r\n                    offset += 4\r\n                } else if (arr instanceof Uint32Array || $u32 in arr) {\r\n                    dataView.setUint32(offset, value)\r\n                    offset += 4\r\n                } else if (arr instanceof Float32Array || $f32 in arr) {\r\n                    dataView.setFloat32(offset, value)\r\n                    offset += 4\r\n                } else {\r\n                    // Default to f64\r\n                    dataView.setFloat64(offset, value)\r\n                    offset += 8\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    return offset\r\n}\r\n\r\n/**\r\n * Deserializes relation data for a specific entity\r\n */\r\nfunction deserializeRelationData(data: any, eid: number, dataView: DataView, offset: number) {\r\n    if (!data) return offset\r\n    \r\n    // Handle array data (AoS) - defaults to f64\r\n    if (Array.isArray(data)) {\r\n        data[eid] = dataView.getFloat64(offset)\r\n        return offset + 8\r\n    }\r\n    \r\n    // Handle object data (SoA)\r\n    if (typeof data === 'object') {\r\n        const keys = Object.keys(data).sort()\r\n        for (const key of keys) {\r\n            const arr = data[key]\r\n            \r\n            if (arr instanceof Int8Array || $i8 in arr) {\r\n                arr[eid] = dataView.getInt8(offset)\r\n                offset += 1\r\n            } else if (arr instanceof Uint8Array || $u8 in arr) {\r\n                arr[eid] = dataView.getUint8(offset)\r\n                offset += 1\r\n            } else if (arr instanceof Int16Array || $i16 in arr) {\r\n                arr[eid] = dataView.getInt16(offset)\r\n                offset += 2\r\n            } else if (arr instanceof Uint16Array || $u16 in arr) {\r\n                arr[eid] = dataView.getUint16(offset)\r\n                offset += 2\r\n            } else if (arr instanceof Int32Array || $i32 in arr) {\r\n                arr[eid] = dataView.getInt32(offset)\r\n                offset += 4\r\n            } else if (arr instanceof Uint32Array || $u32 in arr) {\r\n                arr[eid] = dataView.getUint32(offset)\r\n                offset += 4\r\n            } else if (arr instanceof Float32Array || $f32 in arr) {\r\n                arr[eid] = dataView.getFloat32(offset)\r\n                offset += 4\r\n            } else {\r\n                // Default to f64\r\n                arr[eid] = dataView.getFloat64(offset)\r\n                offset += 8\r\n            }\r\n        }\r\n    }\r\n    \r\n    return offset\r\n}\r\n\r\n/**\r\n * Creates a snapshot serializer for the given world and components.\r\n * @param {World} world - The ECS world object.\r\n * @param {Record<string, PrimitiveBrand>[]} components - An array of component definitions.\r\n * @param {ArrayBuffer} [buffer=new ArrayBuffer(1024 * 1024 * 100)] - The buffer to use for serialization.\r\n * @returns {Function} A function that, when called, serializes the world state and returns a slice of the buffer.\r\n */\r\nexport const createSnapshotSerializer = (world: World, components: (Record<string, PrimitiveBrand> | ComponentRef)[], buffer: ArrayBuffer = new ArrayBuffer(1024 * 1024 * 100)) => {\r\n    const dataView = new DataView(buffer)\r\n    let offset = 0\r\n\r\n    /**\r\n     * Serializes entity-component relationships.\r\n     * @param {number[]} entities - An array of entity IDs.\r\n     */\r\n    const serializeEntityComponentRelationships = (entities: readonly number[]) => {\r\n        const entityCount = entities.length\r\n        \r\n        // Write entity count\r\n        dataView.setUint32(offset, entityCount)\r\n        offset += 4\r\n\r\n        // Serialize entity-component relationships\r\n        for (let i = 0; i < entityCount; i++) {\r\n            const entityId = entities[i]\r\n            let componentCount = 0\r\n            \r\n            dataView.setUint32(offset, entityId)\r\n            offset += 4\r\n            \r\n            const componentCountOffset = offset\r\n            offset += 1\r\n            \r\n            for (let j = 0; j < components.length; j++) {\r\n                const component = components[j]\r\n                if (isRelation(component)) {\r\n                    const targets = getRelationTargets(world, entityId, component as Relation<any>)\r\n                    for (const target of targets) {\r\n                        dataView.setUint8(offset, j)\r\n                        offset += 1\r\n                        dataView.setUint32(offset, target)\r\n                        offset += 4\r\n                        const relationData = (component as any)(target)\r\n                        offset = serializeRelationData(relationData, entityId, dataView, offset)\r\n                        componentCount++\r\n                    }\r\n                } else if (hasComponent(world, entityId, component)) {\r\n                    dataView.setUint8(offset, j)\r\n                    offset += 1\r\n                    componentCount++\r\n                }\r\n            }\r\n            \r\n            dataView.setUint8(componentCountOffset, componentCount)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Serializes component data for all entities.\r\n     * @param {number[]} entities - An array of entity IDs.\r\n     */\r\n    const serializeComponentData = (entities: readonly number[]) => {\r\n        const soaSerializer = createSoASerializer(components, buffer.slice(offset))\r\n        const componentData = soaSerializer(entities)\r\n        new Uint8Array(buffer).set(new Uint8Array(componentData), offset)\r\n        offset += componentData.byteLength\r\n    }\r\n\r\n    return () => {\r\n        offset = 0\r\n        const entities = getAllEntities(world)\r\n        serializeEntityComponentRelationships(entities)\r\n        serializeComponentData(entities)\r\n        return buffer.slice(0, offset)\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a snapshot deserializer for the given world and components.\r\n * @param {World} world - The ECS world object.\r\n * @param {Record<string, PrimitiveBrand>[]} components - An array of component definitions.\r\n * @returns {Function} A function that takes a serialized packet and deserializes it into the world, returning a map of packet entity IDs to world entity IDs.\r\n */\r\nexport const createSnapshotDeserializer = (world: World, components: (Record<string, PrimitiveBrand> | ComponentRef)[], constructorMapping?: Map<number, number>) => {\r\n    let entityIdMapping = constructorMapping || new Map<number, number>()\r\n    const soaDeserializer = createSoADeserializer(components)\r\n\r\n    return (packet: ArrayBuffer, overrideMapping?: Map<number, number>): Map<number, number> => {\r\n        const currentMapping = overrideMapping || entityIdMapping\r\n        const dataView = new DataView(packet)\r\n        let offset = 0\r\n\r\n        // Read entity count\r\n        const entityCount = dataView.getUint32(offset)\r\n        offset += 4\r\n\r\n        // Deserialize entity-component relationships\r\n        for (let entityIndex = 0; entityIndex < entityCount; entityIndex++) {\r\n            const packetEntityId = dataView.getUint32(offset)\r\n            offset += 4\r\n\r\n            let worldEntityId = currentMapping.get(packetEntityId)\r\n            if (worldEntityId === undefined) {\r\n                worldEntityId = addEntity(world)\r\n                currentMapping.set(packetEntityId, worldEntityId)\r\n            }\r\n\r\n            const componentCount = dataView.getUint8(offset)\r\n            offset += 1\r\n\r\n            for (let i = 0; i < componentCount; i++) {\r\n                const componentIndex = dataView.getUint8(offset)\r\n                offset += 1\r\n                const component = components[componentIndex]\r\n                \r\n                if (isRelation(component)) {\r\n                    const targetId = dataView.getUint32(offset)\r\n                    offset += 4\r\n                    let worldTargetId = currentMapping.get(targetId)\r\n                    if (worldTargetId === undefined) {\r\n                        worldTargetId = addEntity(world)\r\n                        currentMapping.set(targetId, worldTargetId)\r\n                    }\r\n                    const relationComponent = (component as (target: any) => any)(worldTargetId)\r\n                    addComponent(world, worldEntityId, relationComponent)\r\n                    offset = deserializeRelationData(relationComponent, worldEntityId, dataView, offset)\r\n                } else {\r\n                    addComponent(world, worldEntityId, component)\r\n                }\r\n            }\r\n        }\r\n\r\n        // Deserialize component data\r\n        soaDeserializer(packet.slice(offset), currentMapping)\r\n\r\n        return currentMapping\r\n    }\r\n}\r\n\r\n\r\nexport const test = (w:any) => {\r\n    return w === Wildcard\r\n}", "import {\r\n    addComponent,\r\n    removeComponent,\r\n    addEntity,\r\n    removeEntity,\r\n    observe,\r\n    onAdd,\r\n    onRemove,\r\n    World,\r\n    ComponentRef,\r\n    entityExists,\r\n    isRelation,\r\n    getRelationTargets,\r\n    Wildcard,\r\n    EntityId\r\n} from 'bitecs'\r\n\r\nenum OperationType {\r\n    AddEntity = 0,\r\n    RemoveEntity = 1,\r\n    AddComponent = 2,\r\n    RemoveComponent = 3,\r\n    AddRelation = 4,\r\n    RemoveRelation = 5,\r\n}\r\nimport { $u8, $i8, $u16, $i16, $u32, $i32, $f32 } from './SoASerializer'\r\n\r\n/**\r\n * Serializes relation data for a specific entity\r\n */\r\nfunction serializeRelationData(data: any, eid: number, dataView: DataView, offset: number) {\r\n    if (!data) return offset\r\n    \r\n    // Handle array data (AoS) - defaults to f64\r\n    if (Array.isArray(data)) {\r\n        const value = data[eid]\r\n        if (value !== undefined) {\r\n            dataView.setFloat64(offset, value)\r\n            return offset + 8\r\n        }\r\n        return offset\r\n    }\r\n    \r\n    // Handle object data (SoA)\r\n    if (typeof data === 'object') {\r\n        const keys = Object.keys(data).sort()\r\n        for (const key of keys) {\r\n            const arr = data[key]\r\n            const value = arr[eid]\r\n            \r\n            if (value !== undefined) {\r\n                if (arr instanceof Int8Array || $i8 in arr) {\r\n                    dataView.setInt8(offset, value)\r\n                    offset += 1\r\n                } else if (arr instanceof Uint8Array || $u8 in arr) {\r\n                    dataView.setUint8(offset, value)\r\n                    offset += 1\r\n                } else if (arr instanceof Int16Array || $i16 in arr) {\r\n                    dataView.setInt16(offset, value)\r\n                    offset += 2\r\n                } else if (arr instanceof Uint16Array || $u16 in arr) {\r\n                    dataView.setUint16(offset, value)\r\n                    offset += 2\r\n                } else if (arr instanceof Int32Array || $i32 in arr) {\r\n                    dataView.setInt32(offset, value)\r\n                    offset += 4\r\n                } else if (arr instanceof Uint32Array || $u32 in arr) {\r\n                    dataView.setUint32(offset, value)\r\n                    offset += 4\r\n                } else if (arr instanceof Float32Array || $f32 in arr) {\r\n                    dataView.setFloat32(offset, value)\r\n                    offset += 4\r\n                } else {\r\n                    // Default to f64\r\n                    dataView.setFloat64(offset, value)\r\n                    offset += 8\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    return offset\r\n}\r\n\r\n/**\r\n * Deserializes relation data for a specific entity\r\n */\r\nfunction deserializeRelationData(data: any, eid: number, dataView: DataView, offset: number) {\r\n    if (!data) return offset\r\n    \r\n    // Handle array data (AoS) - defaults to f64\r\n    if (Array.isArray(data)) {\r\n        data[eid] = dataView.getFloat64(offset)\r\n        return offset + 8\r\n    }\r\n    \r\n    // Handle object data (SoA)\r\n    if (typeof data === 'object') {\r\n        const keys = Object.keys(data).sort()\r\n        for (const key of keys) {\r\n            const arr = data[key]\r\n            \r\n            if (arr instanceof Int8Array || $i8 in arr) {\r\n                arr[eid] = dataView.getInt8(offset)\r\n                offset += 1\r\n            } else if (arr instanceof Uint8Array || $u8 in arr) {\r\n                arr[eid] = dataView.getUint8(offset)\r\n                offset += 1\r\n            } else if (arr instanceof Int16Array || $i16 in arr) {\r\n                arr[eid] = dataView.getInt16(offset)\r\n                offset += 2\r\n            } else if (arr instanceof Uint16Array || $u16 in arr) {\r\n                arr[eid] = dataView.getUint16(offset)\r\n                offset += 2\r\n            } else if (arr instanceof Int32Array || $i32 in arr) {\r\n                arr[eid] = dataView.getInt32(offset)\r\n                offset += 4\r\n            } else if (arr instanceof Uint32Array || $u32 in arr) {\r\n                arr[eid] = dataView.getUint32(offset)\r\n                offset += 4\r\n            } else if (arr instanceof Float32Array || $f32 in arr) {\r\n                arr[eid] = dataView.getFloat32(offset)\r\n                offset += 4\r\n            } else {\r\n                // Default to f64\r\n                arr[eid] = dataView.getFloat64(offset)\r\n                offset += 8\r\n            }\r\n        }\r\n    }\r\n    \r\n    return offset\r\n}\r\n\r\n/**\r\n * Creates a serializer for observing and serializing changes in networked entities.\r\n */\r\nexport const createObserverSerializer = (world: World, networkedTag: ComponentRef, components: ComponentRef[], buffer = new ArrayBuffer(1024 * 1024 * 100)) => {\r\n    const dataView = new DataView(buffer)\r\n    let offset = 0\r\n    const queue: [number, OperationType, number, number?, any?][] = []\r\n    const relationTargets = new Map<number, Map<number, number>>()\r\n    \r\n    observe(world, onAdd(networkedTag), (eid: EntityId) => {\r\n        queue.push([eid, OperationType.AddEntity, -1])\r\n    })\r\n\r\n    observe(world, onRemove(networkedTag), (eid: EntityId) => {\r\n        queue.push([eid, OperationType.RemoveEntity, -1])\r\n        relationTargets.delete(eid)\r\n    })\r\n\r\n    components.forEach((component, i) => {\r\n        if (isRelation(component)) {\r\n            observe(world, onAdd(networkedTag, component(Wildcard)), (eid: EntityId) => {\r\n                const targets = getRelationTargets(world, eid, component)\r\n                for (const target of targets) {\r\n                    if (!relationTargets.has(eid)) {\r\n                        relationTargets.set(eid, new Map())\r\n                    }\r\n                    relationTargets.get(eid).set(i, target)\r\n                    const relationData = component(target)\r\n                    queue.push([eid, OperationType.AddRelation, i, target, relationData])\r\n                }\r\n            })\r\n\r\n            observe(world, onRemove(networkedTag, component(Wildcard)), (eid: EntityId) => {\r\n                const targetMap = relationTargets.get(eid)\r\n                if (targetMap) {\r\n                    const target = targetMap.get(i)\r\n                    if (target !== undefined) {\r\n                        queue.push([eid, OperationType.RemoveRelation, i, target])\r\n                        targetMap.delete(i)\r\n                        if (targetMap.size === 0) {\r\n                            relationTargets.delete(eid)\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n        } else {\r\n            observe(world, onAdd(networkedTag, component), (eid: EntityId) => {\r\n                queue.push([eid, OperationType.AddComponent, i])\r\n            })\r\n\r\n            observe(world, onRemove(networkedTag, component), (eid: EntityId) => {\r\n                queue.push([eid, OperationType.RemoveComponent, i])\r\n            })\r\n        }\r\n    })\r\n    \r\n    return () => {\r\n        offset = 0\r\n        \r\n        for (let i = 0; i < queue.length; i++) {\r\n            const [entityId, type, componentId, targetId, relationData] = queue[i]\r\n            dataView.setUint32(offset, entityId)\r\n            offset += 4\r\n            dataView.setUint8(offset, type)\r\n            offset += 1\r\n            if (type === OperationType.AddComponent || \r\n                type === OperationType.RemoveComponent || \r\n                type === OperationType.AddRelation ||\r\n                type === OperationType.RemoveRelation) {\r\n                dataView.setUint8(offset, componentId)\r\n                offset += 1\r\n                \r\n                if (type === OperationType.AddRelation || type === OperationType.RemoveRelation) {\r\n                    dataView.setUint32(offset, targetId)\r\n                    offset += 4\r\n                    \r\n                    if (type === OperationType.AddRelation && relationData) {\r\n                        offset = serializeRelationData(relationData, entityId, dataView, offset)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        queue.length = 0\r\n\r\n        return buffer.slice(0, offset)\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a deserializer for applying serialized changes to a world.\r\n */\r\nexport const createObserverDeserializer = (world: World, networkedTag: ComponentRef, components: ComponentRef[], constructorMapping?: Map<number, number>) => {\r\n    let entityIdMapping = constructorMapping || new Map<number, number>()\r\n    \r\n    return (packet: ArrayBuffer, overrideMapping?: Map<number, number>) => {\r\n        // Allow overriding the mapping for this call\r\n        const currentMapping = overrideMapping || entityIdMapping\r\n        const dataView = new DataView(packet)\r\n        let offset = 0\r\n\r\n        while (offset < packet.byteLength) {\r\n            const packetEntityId = dataView.getUint32(offset)\r\n            offset += 4\r\n            const operationType = dataView.getUint8(offset)\r\n            offset += 1\r\n            let componentId = -1\r\n            let targetId = -1\r\n            \r\n            if (operationType === OperationType.AddComponent || \r\n                operationType === OperationType.RemoveComponent ||\r\n                operationType === OperationType.AddRelation ||\r\n                operationType === OperationType.RemoveRelation) {\r\n                componentId = dataView.getUint8(offset)\r\n                offset += 1\r\n                \r\n                if (operationType === OperationType.AddRelation || operationType === OperationType.RemoveRelation) {\r\n                    targetId = dataView.getUint32(offset)\r\n                    offset += 4\r\n                }\r\n            }\r\n\r\n            const component = components[componentId]\r\n            let worldEntityId = currentMapping.get(packetEntityId)\r\n\r\n            if (operationType === OperationType.AddEntity) {\r\n                if (worldEntityId === undefined) {\r\n                    worldEntityId = addEntity(world)\r\n                    currentMapping.set(packetEntityId, worldEntityId)\r\n                    addComponent(world, worldEntityId, networkedTag)\r\n                } else {\r\n                    // TODO: figure out if this should ignore, throw, warn, or if the observer serializer should maybe do a snapshot on first call?\r\n                    // throw new Error(`Entity with ID ${packetEntityId} already exists in the mapping.`)\r\n                    console.warn(`Attempted to deserialize addEntity with ID ${packetEntityId}, but it has already been deserialzied and exists in the mapping.`)\r\n                }\r\n            } else if (worldEntityId !== undefined && entityExists(world, worldEntityId)) {\r\n                if (operationType === OperationType.RemoveEntity) {\r\n                    removeEntity(world, worldEntityId)\r\n                    currentMapping.delete(packetEntityId)\r\n                } else if (operationType === OperationType.AddComponent) {\r\n                    addComponent(world, worldEntityId, component)\r\n                } else if (operationType === OperationType.RemoveComponent) {\r\n                    removeComponent(world, worldEntityId, component)\r\n                } else if (operationType === OperationType.AddRelation) {\r\n                    const worldTargetId = currentMapping.get(targetId)\r\n                    if (worldTargetId !== undefined) {\r\n                        const relationComponent = component(worldTargetId)\r\n                        addComponent(world, worldEntityId, relationComponent)\r\n                        offset = deserializeRelationData(relationComponent, worldEntityId, dataView, offset)\r\n                    }\r\n                } else if (operationType === OperationType.RemoveRelation) {\r\n                    const worldTargetId = currentMapping.get(targetId)\r\n                    if (worldTargetId !== undefined) {\r\n                        removeComponent(world, worldEntityId, component(worldTargetId))\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return currentMapping\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": ["value", "size", "import_bitecs", "serializeRelationData", "deserializeRelationData"]
}
