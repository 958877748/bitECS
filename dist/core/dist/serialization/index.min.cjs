var U=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var J=(e,t)=>{for(var a in t)U(e,a,{get:t[a],enumerable:!0})},K=(e,t,a,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of q(t))!H.call(e,n)&&n!==a&&U(e,n,{get:()=>t[n],enumerable:!(p=G(t,n))||p.enumerable});return e};var N=e=>K(U({},"__esModule",{value:!0}),e);var Y={};J(Y,{createObserverDeserializer:()=>L,createObserverSerializer:()=>j,createSnapshotDeserializer:()=>M,createSnapshotSerializer:()=>F,createSoADeserializer:()=>C,createSoASerializer:()=>h,f32:()=>P,f64:()=>W,i16:()=>T,i32:()=>B,i8:()=>x,u16:()=>O,u32:()=>$,u8:()=>V});module.exports=N(Y);var A=Symbol("u8"),v=Symbol("i8"),w=Symbol("u16"),D=Symbol("i16"),R=Symbol("u32"),z=Symbol("i32"),S=Symbol("f32"),g=Symbol("f64"),d=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),V=d(A),x=d(v),O=d(w),T=d(D),$=d(R),B=d(z),P=d(S),W=d(g),E={[A]:(e,t,a)=>(e.setUint8(t,a),1),[v]:(e,t,a)=>(e.setInt8(t,a),1),[w]:(e,t,a)=>(e.setUint16(t,a),2),[D]:(e,t,a)=>(e.setInt16(t,a),2),[R]:(e,t,a)=>(e.setUint32(t,a),4),[z]:(e,t,a)=>(e.setInt32(t,a),4),[S]:(e,t,a)=>(e.setFloat32(t,a),4),[g]:(e,t,a)=>(e.setFloat64(t,a),8)},I={[A]:(e,t)=>({value:e.getUint8(t),size:1}),[v]:(e,t)=>({value:e.getInt8(t),size:1}),[w]:(e,t)=>({value:e.getUint16(t),size:2}),[D]:(e,t)=>({value:e.getInt16(t),size:2}),[R]:(e,t)=>({value:e.getUint32(t),size:4}),[z]:(e,t)=>({value:e.getInt32(t),size:4}),[S]:(e,t)=>({value:e.getFloat32(t),size:4}),[g]:(e,t)=>({value:e.getFloat64(t),size:8})},Q=e=>{let t=Object.keys(e),p=t.map(n=>{let o=e[n];for(let i of[A,v,w,D,R,z,S,g])if(i in o)return i;return g}).map(n=>E[n]||(()=>{throw new Error("Unsupported or unannotated type")}));return(n,o,i)=>{let m=0;m+=E[R](n,o+m,i);for(let r=0;r<t.length;r++)m+=p[r](n,o+m,e[t[r]][i]);return m}},X=e=>{let t=Object.keys(e),p=t.map(n=>{let o=e[n];for(let i of[A,v,w,D,R,z,S,g])if(i in o)return i;return g}).map(n=>I[n]||(()=>{throw new Error("Unsupported or unannotated type")}));return(n,o,i)=>{let m=0,{value:r,size:y}=I[R](n,o+m);m+=y;let u=i?i.get(r)??r:r;for(let f=0;f<t.length;f++){let{value:l,size:c}=p[f](n,o+m);e[t[f]][u]=l,m+=c}return m}},h=(e,t=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(t),p=e.map(Q);return n=>{let o=0;for(let i=0;i<n.length;i++){let m=n[i];for(let r=0;r<p.length;r++)o+=p[r](a,o,m)}return t.slice(0,o)}},C=e=>{let t=e.map(X);return(a,p)=>{let n=new DataView(a),o=0;for(;o<a.byteLength;)for(let i=0;i<t.length;i++)o+=t[i](n,o,p)}};var b=require("bitecs"),F=(e,t,a=new ArrayBuffer(1024*1024*100))=>{let p=new DataView(a),n=0,o=m=>{let r=m.length;p.setUint32(n,r),n+=4;for(let y=0;y<r;y++){let u=m[y],f=0;p.setUint32(n,u),n+=4;let l=n;n+=1;for(let c=0;c<t.length;c++)(0,b.hasComponent)(e,u,t[c])&&(p.setUint8(n,c),n+=1,f++);p.setUint8(l,f)}},i=m=>{let y=h(t,a.slice(n))(m);new Uint8Array(a).set(new Uint8Array(y),n),n+=y.byteLength};return()=>{n=0;let m=(0,b.getAllEntities)(e);return o(m),i(m),a.slice(0,n)}},M=(e,t)=>{let a=C(t);return p=>{let n=new DataView(p),o=0,i=new Map,m=n.getUint32(o);o+=4;for(let r=0;r<m;r++){let y=n.getUint32(o);o+=4;let u=(0,b.addEntity)(e);i.set(y,u);let f=n.getUint8(o);o+=1;for(let l=0;l<f;l++){let c=n.getUint8(o);o+=1,(0,b.addComponent)(e,u,t[c])}}return a(p.slice(o),i),i}};var s=require("bitecs");var j=(e,t,a,p=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(p),o=0,i=[],m=new Map;return(0,s.observe)(e,(0,s.onAdd)(t),r=>{i.push([r,0,-1])}),(0,s.observe)(e,(0,s.onRemove)(t),r=>{i.push([r,1,-1]),m.delete(r)}),a.forEach((r,y)=>{(0,s.isRelation)(r)?((0,s.observe)(e,(0,s.onAdd)(t,r(s.Wildcard)),u=>{let f=(0,s.getRelationTargets)(e,u,r);for(let l of f)m.has(u)||m.set(u,new Map),m.get(u).set(y,l),i.push([u,4,y,l])}),(0,s.observe)(e,(0,s.onRemove)(t,r(s.Wildcard)),u=>{let f=m.get(u);if(f){let l=f.get(y);l!==void 0&&(i.push([u,5,y,l]),f.delete(y),f.size===0&&m.delete(u))}})):((0,s.observe)(e,(0,s.onAdd)(t,r),u=>{i.push([u,2,y])}),(0,s.observe)(e,(0,s.onRemove)(t,r),u=>{i.push([u,3,y])}))}),()=>{o=0;for(let r=0;r<i.length;r++){let[y,u,f,l]=i[r];n.setUint32(o,y),o+=4,n.setUint8(o,u),o+=1,(u===2||u===3||u===4||u===5)&&(n.setUint8(o,f),o+=1,(u===4||u===5)&&(n.setUint32(o,l),o+=4))}return i.length=0,p.slice(0,o)}},L=(e,t,a,p=new Map)=>n=>{let o=new DataView(n),i=0;for(;i<n.byteLength;){let m=o.getUint32(i);i+=4;let r=o.getUint8(i);i+=1;let y=-1,u=-1;(r===2||r===3||r===4||r===5)&&(y=o.getUint8(i),i+=1,(r===4||r===5)&&(u=o.getUint32(i),i+=4));let f=a[y],l=p.get(m);if(r===0)if(l===void 0)l=(0,s.addEntity)(e),p.set(m,l),(0,s.addComponent)(e,l,t);else throw new Error(`Entity with ID ${m} already exists in the mapping.`);else if(l!==void 0&&(0,s.entityExists)(e,l)){if(r===1)(0,s.removeEntity)(e,l);else if(r===2)(0,s.addComponent)(e,l,f);else if(r===3)(0,s.removeComponent)(e,l,f);else if(r===4){let c=p.get(u);c!==void 0&&(0,s.addComponent)(e,l,f(c))}else if(r===5){let c=p.get(u);c!==void 0&&(0,s.removeComponent)(e,l,f(c))}}}return p};
//# sourceMappingURL=index.min.cjs.map
