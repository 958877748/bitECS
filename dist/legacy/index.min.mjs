import{observe as B,onAdd as L,onRemove as M,query as G}from"../core";import{addComponent as N,hasComponent as H,removeComponent as J}from"../core";import{addComponent as w,removeComponent as Q,addEntity as P,removeEntity as F,observe as W,onAdd as S,onRemove as h}from"../core";var U=(e,t,r,i=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(i),o=0,n=[];return W(e,S(t),y=>{n.push([y,0,-1])}),W(e,h(t),y=>{n.push([y,1,-1])}),r.forEach((y,p)=>{W(e,S(t,y),s=>{n.push([s,2,p])}),W(e,h(t,y),s=>{n.push([s,3,p])})}),()=>{o=0;for(let y=0;y<n.length;y++){let[p,s,d]=n[y];a.setUint32(o,p),o+=4,a.setUint8(o,s),o+=1,a.setUint8(o,d),o+=1}return n.length=0,i.slice(0,o)}},v=(e,t,r)=>(i,a=new Map)=>{let o=new DataView(i),n=0;for(;n<i.byteLength;){let y=o.getUint32(n);n+=4;let p=o.getUint8(n);n+=1;let s=o.getUint8(n);n+=1;let d=r[s],u=a.get(y);u===void 0&&(u=P(e),a.set(y,u)),p===0?w(e,u,t):p===1?F(e,u):p===2?w(e,u,d):p===3&&Q(e,u,d)}return a};var c=Symbol("u8"),b=Symbol("i8"),A=Symbol("u16"),C=Symbol("i16"),f=Symbol("u32"),I=Symbol("i32"),x=Symbol("f32"),l=Symbol("f64"),m=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),ee=m(c),te=m(b),re=m(A),ne=m(C),oe=m(f),ie=m(I),ae=m(x),ye=m(l),z={[c]:(e,t,r)=>(e.setUint8(t,r),1),[b]:(e,t,r)=>(e.setInt8(t,r),1),[A]:(e,t,r)=>(e.setUint16(t,r),2),[C]:(e,t,r)=>(e.setInt16(t,r),2),[f]:(e,t,r)=>(e.setUint32(t,r),4),[I]:(e,t,r)=>(e.setInt32(t,r),4),[x]:(e,t,r)=>(e.setFloat32(t,r),4),[l]:(e,t,r)=>(e.setFloat64(t,r),8)},g={[c]:(e,t)=>({value:e.getUint8(t),size:1}),[b]:(e,t)=>({value:e.getInt8(t),size:1}),[A]:(e,t)=>({value:e.getUint16(t),size:2}),[C]:(e,t)=>({value:e.getInt16(t),size:2}),[f]:(e,t)=>({value:e.getUint32(t),size:4}),[I]:(e,t)=>({value:e.getInt32(t),size:4}),[x]:(e,t)=>({value:e.getFloat32(t),size:4}),[l]:(e,t)=>({value:e.getFloat64(t),size:8})},q=e=>{let t=Object.keys(e),i=t.map(a=>{let o=e[a];for(let n of[c,b,A,C,f,I,x,l])if(n in o)return n;return l}).map(a=>z[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,o,n)=>{let y=0;y+=z[f](a,o+y,n);for(let p=0;p<t.length;p++)y+=i[p](a,o+y,e[t[p]][n]);return y}},j=e=>{let t=Object.keys(e),i=t.map(a=>{let o=e[a];for(let n of[c,b,A,C,f,I,x,l])if(n in o)return n;return l}).map(a=>g[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,o,n)=>{let y=0,{value:p,size:s}=g[f](a,o+y);y+=s;let d=n?n.get(p)??p:p;for(let u=0;u<t.length;u++){let{value:$,size:k}=i[u](a,o+y);e[t[u]][d]=$,y+=k}return y}},D=(e,t=new ArrayBuffer(1024*1024*100))=>{let r=new DataView(t),i=e.map(q);return a=>{let o=0;for(let n=0;n<a.length;n++){let y=a[n];for(let p=0;p<i.length;p++)o+=i[p](r,o,y)}return t.slice(0,o)}},V=e=>{let t=e.map(j);return(r,i)=>{let a=new DataView(r),o=0;for(;o<r.byteLength;)for(let n=0;n<t.length;n++)o+=t[n](a,o,i)}};import{query as O}from"../core";function ce(e,t){let r=new WeakSet,i,a;return o=>{r.has(e)||(r.add(e),i=U(o,e[0],e),a=D(e));let n=i(),y=a(O(o,e)),p=new ArrayBuffer(n.byteLength+y.byteLength),s=new Uint8Array(p);return s.set(new Uint8Array(n),0),s.set(new Uint8Array(y),n.byteLength),p}}function be(e){let t=new WeakSet,r,i;return(a,o,n)=>{t.has(e)||(t.add(e),r=v(a,e[0],e),i=V(e));let y=r(o,n),p=o.slice(y);return i(p,n)}}var E=(i=>(i[i.REPLACE=0]="REPLACE",i[i.APPEND=1]="APPEND",i[i.MAP=2]="MAP",i))(E||{});var K=Symbol("$modifier");function T(e,t){let r=()=>[e,t];return r[K]=!0,r}var Te=e=>T(e,"not"),we=e=>T(e,"or"),Se=e=>T(e,"changed");function he(e){let t=r=>G(r,e);return t.components=e,t}function Ue(e){let t=[],r=new WeakSet;return i=>{r.has(i)||(B(i,L(...e.components),o=>t.push(o)),r.add(i));let a=t.slice();return t.length=0,a}}function ve(e){let t=[],r=new WeakSet;return i=>{r.has(i)||(B(i,M(...e.components),o=>t.push(o)),r.add(i));let a=t.slice();return t.length=0,a}}var ze=(e,t,r)=>N(e,r,t),ge=(e,t,r)=>H(e,r,t),De=(e,t,r)=>J(e,r,t),Ve={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},R={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},Re=(e,t=1e5)=>{let r=(i,a)=>{let o={};for(let n in i)if(Array.isArray(i[n])){let[y,p]=i[n];o[n]=Array.from({length:p},()=>new R[y](a))}else if(typeof i[n]=="object")o[n]=r(i[n],a);else{let y=i[n],p=R[y];if(p)o[n]=new p(a);else throw new Error(`Unsupported type: ${i[n]}`)}return o};return r(e,t)};export{K as $modifier,Se as Changed,E as DESERIALIZE_MODE,Te as Not,we as Or,Ve as Types,ze as addComponent,Re as defineComponent,be as defineDeserializer,he as defineQuery,ce as defineSerializer,Ue as enterQuery,ve as exitQuery,ge as hasComponent,De as removeComponent};
//# sourceMappingURL=index.min.mjs.map
