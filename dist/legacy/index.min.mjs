import{observe as V,onAdd as M,onRemove as q,query as j}from"../core";import{addComponent as G,hasComponent as H,removeComponent as N}from"../core";import{addComponent as S,removeComponent as k,addEntity as Q,removeEntity as F,observe as W,onAdd as w,onRemove as h}from"../core";var D=(e,t,r,a=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(a),o=0,n=[];return W(e,w(t),y=>{n.push([y,0,-1])}),W(e,h(t),y=>{n.push([y,1,-1])}),r.forEach((y,p)=>{W(e,w(t,y),s=>{n.push([s,2,p])}),W(e,h(t,y),s=>{n.push([s,3,p])})}),()=>{o=0;for(let y=0;y<n.length;y++){let[p,s,d]=n[y];i.setUint32(o,p),o+=4,i.setUint8(o,s),o+=1,i.setUint8(o,d),o+=1}return n.length=0,a.slice(0,o)}},U=(e,t,r)=>(a,i=new Map)=>{let o=new DataView(a),n=0;for(;n<a.byteLength;){let y=o.getUint32(n);n+=4;let p=o.getUint8(n);n+=1;let s=o.getUint8(n);n+=1;let d=r[s],u=i.get(y);u===void 0&&(u=Q(e),i.set(y,u)),p===0?S(e,u,t):p===1?F(e,u):p===2?S(e,u,d):p===3&&k(e,u,d)}return i};var c=Symbol("u8"),b=Symbol("i8"),A=Symbol("u16"),I=Symbol("i16"),f=Symbol("u32"),C=Symbol("i32"),x=Symbol("f32"),l=Symbol("f64"),m=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),_=m(c),ee=m(b),te=m(A),re=m(I),ne=m(f),oe=m(C),ie=m(x),ae=m(l),v={[c]:(e,t,r)=>(e.setUint8(t,r),1),[b]:(e,t,r)=>(e.setInt8(t,r),1),[A]:(e,t,r)=>(e.setUint16(t,r),2),[I]:(e,t,r)=>(e.setInt16(t,r),2),[f]:(e,t,r)=>(e.setUint32(t,r),4),[C]:(e,t,r)=>(e.setInt32(t,r),4),[x]:(e,t,r)=>(e.setFloat32(t,r),4),[l]:(e,t,r)=>(e.setFloat64(t,r),8)},z={[c]:(e,t)=>({value:e.getUint8(t),size:1}),[b]:(e,t)=>({value:e.getInt8(t),size:1}),[A]:(e,t)=>({value:e.getUint16(t),size:2}),[I]:(e,t)=>({value:e.getInt16(t),size:2}),[f]:(e,t)=>({value:e.getUint32(t),size:4}),[C]:(e,t)=>({value:e.getInt32(t),size:4}),[x]:(e,t)=>({value:e.getFloat32(t),size:4}),[l]:(e,t)=>({value:e.getFloat64(t),size:8})},O=e=>{let t=Object.keys(e),a=t.map(i=>{let o=e[i];for(let n of[c,b,A,I,f,C,x,l])if(n in o)return n;return l}).map(i=>v[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,o,n)=>{let y=0;y+=v[f](i,o+y,n);for(let p=0;p<t.length;p++)y+=a[p](i,o+y,e[t[p]][n]);return y}},P=e=>{let t=Object.keys(e),a=t.map(i=>{let o=e[i];for(let n of[c,b,A,I,f,C,x,l])if(n in o)return n;return l}).map(i=>z[i]||(()=>{throw new Error("Unsupported or unannotated type")}));return(i,o,n)=>{let y=0,{value:p,size:s}=z[f](i,o+y);y+=s;let d=n?n.get(p)??p:p;for(let u=0;u<t.length;u++){let{value:B,size:$}=a[u](i,o+y);e[t[u]][d]=B,y+=$}return y}},g=(e,t=new ArrayBuffer(1024*1024*100))=>{let r=new DataView(t),a=e.map(O);return i=>{let o=0;for(let n=0;n<i.length;n++){let y=i[n];for(let p=0;p<a.length;p++)o+=a[p](r,o,y)}return t.slice(0,o)}},R=e=>{let t=e.map(P);return(r,a)=>{let i=new DataView(r),o=0;for(;o<r.byteLength;)for(let n=0;n<t.length;n++)o+=t[n](i,o,a)}};import{query as L}from"../core";function de(e,t){let r=new WeakSet,a,i;return o=>{r.has(e)||(r.add(e),a=D(o,e[0],e),i=g(e));let n=a(),y=i(L(o,e)),p=new ArrayBuffer(n.byteLength+y.byteLength),s=new Uint8Array(p);return s.set(new Uint8Array(n),0),s.set(new Uint8Array(y),n.byteLength),p}}function ce(e){let t=new WeakSet,r,a;return(i,o,n)=>{t.has(e)||(t.add(e),r=U(i,e[0],e),a=R(e));let y=r(o,n),p=o.slice(y);return a(p,n)}}var J=Symbol("$modifier");function T(e,t){let r=()=>[e,t];return r[J]=!0,r}var We=e=>T(e,"not"),Te=e=>T(e,"or"),Se=e=>T(e,"changed");function we(e){let t=r=>j(r,e);return t.components=e,t}function he(e){let t=[],r=new WeakSet;return a=>{r.has(a)||(V(a,M(...e.components),o=>t.push(o)),r.add(a));let i=t.slice();return t.length=0,i}}function De(e){let t=[],r=new WeakSet;return a=>{r.has(a)||(V(a,q(...e.terms),o=>t.push(o)),r.add(a));let i=t.slice();return t.length=0,i}}var Ue=(e,t,r)=>G(e,r,t),ve=(e,t,r)=>H(e,r,t),ze=(e,t,r)=>N(e,r,t),ge={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},E={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},Re=(e,t=1e5)=>{let r=(a,i)=>{let o={};for(let n in a)if(Array.isArray(a[n])){let[y,p]=a[n];o[n]=Array.from({length:p},()=>new E[y](i))}else if(typeof a[n]=="object")o[n]=r(a[n],i);else{let y=a[n],p=E[y];if(p)o[n]=new p(i);else throw new Error(`Unsupported type: ${a[n]}`)}return o};return r(e,t)};export{J as $modifier,Se as Changed,We as Not,Te as Or,ge as Types,Ue as addComponent,Re as defineComponent,ce as defineDeserializer,we as defineQuery,de as defineSerializer,he as enterQuery,De as exitQuery,ve as hasComponent,ze as removeComponent};
//# sourceMappingURL=index.min.mjs.map
